<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Home Delivery KPIs</title>
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- React and ReactDOM -->
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
  <!-- Chart.js only (no react-chartjs-2) -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script>
    // Global Chart.js configuration to ensure all text is green
    document.addEventListener('DOMContentLoaded', function () {
      if (typeof window.Chart !== 'undefined') {
        window.Chart.defaults.color = '#1f6a4a';
        window.Chart.defaults.plugins.legend.labels.color = '#1f6a4a';
        window.Chart.defaults.scales.category.ticks.color = '#1f6a4a';
        window.Chart.defaults.scales.linear.ticks.color = '#1f6a4a';
      }
    });
  </script>
  <!-- PapaParse for CSV parsing -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <!-- xlsx.js for Excel file parsing -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <!-- Add Heroicons CDN in <head> -->
  <script src="https://unpkg.com/@heroicons/vue@2.0.18/dist/heroicons.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <!-- OGL CDN for Threads.js -->
  <script type="module">
    import * as ogl from "https://cdn.jsdelivr.net/npm/ogl@0.0.49/dist/ogl.mjs";
    window.Renderer = ogl.Renderer;
    window.Program = ogl.Program;
    window.Mesh = ogl.Mesh;
    window.Triangle = ogl.Triangle;
    window.Color = ogl.Color;
  </script>
  <style>
    @font-face {
      font-family: 'Euclid Circular B';
      src: url('font/Euclid Circular B Light.ttf') format('truetype');
      font-weight: 300;
      font-style: normal;
    }

    @font-face {
      font-family: 'Euclid Circular B';
      src: url('font/Euclid Circular B Regular.ttf') format('truetype');
      font-weight: 400;
      font-style: normal;
    }

    @font-face {
      font-family: 'Euclid Circular B';
      src: url('font/Euclid Circular B Medium.ttf') format('truetype');
      font-weight: 500;
      font-style: normal;
    }

    @font-face {
      font-family: 'Euclid Circular B';
      src: url('font/Euclid Circular B SemiBold.ttf') format('truetype');
      font-weight: 600;
      font-style: normal;
    }

    @font-face {
      font-family: 'Euclid Circular B';
      src: url('font/Euclid Circular B Bold.ttf') format('truetype');
      font-weight: 700;
      font-style: normal;
    }

    body,
    html,
    .primary-text,
    .secondary-text,
    .card,
    .table-header,
    .table-row,
    .btn-primary,
    .btn-secondary,
    .font-bold,
    .font-semibold,
    .font-medium,
    .font-light {
      font-family: 'Euclid Circular B', Arial, sans-serif !important;
    }

    :root {
      --primaryMain: #1f6a4a;
      --primaryHover: #2e9e6e;
      --primarySurface: #184c36;
      --primaryBorder: #295c47;
      --primaryFocus: #184c36;
      --secondaryMain: #ff9d18;
      --secondaryHover: #e58400;
      --secondarySurface: #2a3c33;
      --secondaryFocus: #3a2a1a;
      --neutral: #103525;
      --white: #fff;
      --text: #103525;
      --textSecondary: #103525;
      --border: #295c47;
      --lightBackground: #f8f9fa;
    }

    html,
    body {
      font-family: 'Euclid Circular B', Arial, sans-serif;
      background: var(--lightBackground);
      color: var(--text);
      min-height: 100vh;
      margin: 0;
      padding: 0;
    }

    #root {
      width: 100vw;
      max-width: none;
      margin: 0;
      padding: 0;
    }

    .app-grid {
      display: flex;
      flex-direction: row;
      width: 100vw;
      min-height: 100vh;
    }

    .main-content {
      width: calc(100vw - 340px);
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      background: var(--lightBackground);
      transition: all 0.3s ease;
      overflow-x: hidden;
    }

    @media (min-width: 901px) {
      .main-content {
        width: calc(100vw - 340px);
      }
    }

    @media (max-width: 1200px) and (min-width: 901px) {
      .main-content {
        width: calc(100vw - 300px);
      }
    }

    @media (max-width: 1024px) and (min-width: 901px) {
      .main-content {
        width: calc(100vw - 280px);
      }
    }

    .dashboard-section {
      padding: 2rem;
      flex: 1;
      min-width: 0;
      width: 100%;
      max-width: 100vw;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      gap: 2rem;
    }

    .sidebar {
      background: var(--white);
      box-shadow: 2px 0 16px 0 rgba(31, 106, 74, 0.10);
      display: flex;
      flex-direction: column;
      padding: 2.5rem 1.5rem 1.5rem 1.5rem;
      min-height: 100vh;
      width: 340px;
      min-width: 260px;
      max-width: 400px;
      transition: background 0.3s, width 0.3s;
      border-right: 2px solid var(--border);
    }

    .sidebar.collapsed {
      width: 64px;
      min-width: 64px;
      padding: 1.5rem 0.5rem 1rem 0.5rem;
    }

    .sidebar .logo {
      font-weight: 700;
      font-size: 1.3rem;
      margin-bottom: 2rem;
      letter-spacing: 1px;
      color: var(--secondaryMain);
    }

    .sidebar nav {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
    }

    .sidebar nav button,
    .sidebar nav a {
      background: none;
      border: none;
      color: var(--text);
      font-size: 1rem;
      padding: 0.5rem 0.75rem;
      border-radius: 0.5rem;
      text-align: left;
      cursor: pointer;
      transition: background 0.2s, color 0.2s;
      outline: none;
    }

    .sidebar nav button.active,
    .sidebar nav a.active,
    .sidebar nav button:hover,
    .sidebar nav a:hover {
      background: var(--secondaryMain);
      color: var(--neutral);
    }

    .sidebar .sidebar-toggle {
      margin-top: 2rem;
      background: var(--secondaryMain);
      color: var(--neutral);
      border: none;
      border-radius: 0.5rem;
      padding: 0.5rem 0.75rem;
      cursor: pointer;
      font-size: 1.1rem;
      transition: background 0.2s;
    }

    .sidebar .sidebar-toggle:hover {
      background: var(--secondaryHover);
    }

    .navbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1rem 2rem;
      background: var(--secondaryMain);
      color: var(--white);
      box-shadow: 0 2px 12px 0 rgba(31, 106, 74, 0.08);
      position: sticky;
      top: 0;
      z-index: 1000;
    }

    .navbar .theme-toggle {
      background: var(--secondaryMain);
      color: var(--neutral);
      border: 2px solid var(--secondaryMain);
      border-radius: 0.5rem;
      padding: 0.5rem 1rem;
      cursor: pointer;
      font-size: 1rem;
      transition: background 0.2s, color 0.2s;
    }

    .navbar .theme-toggle:hover {
      background: var(--secondaryHover);
      color: var(--white);
    }

    .dashboard-section {
      padding: 2rem;
      flex: 1;
      min-width: 0;
      width: 100%;
      max-width: 100vw;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      gap: 2rem;
    }

    .card {
      background: var(--white);
      border-radius: 1rem;
      box-shadow: 0 4px 20px 0 rgba(31, 106, 74, 0.15);
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      transition: box-shadow 0.3s, transform 0.3s;
      color: var(--text);
      border: 2px solid var(--secondaryMain);
    }

    .card:hover {
      box-shadow: 0 8px 32px 0 rgba(255, 157, 24, 0.18);
      transform: translateY(-2px);
    }

    .dashboard-grid {
      display: flex;
      gap: 1.5rem;
      width: 100%;
      flex-wrap: wrap;
      justify-content: space-between;
    }

    .dashboard-grid>div {
      flex: 1 1 48%;
      min-width: 320px;
      max-width: none;
    }

    @media (max-width: 1023px) {
      .app-grid {
        flex-direction: column;
      }

      .dashboard-grid {
        flex-direction: column;
      }

      .dashboard-grid>div {
        max-width: 100%;
        min-width: 0;
      }
    }

    @media (max-width: 639px) {
      .dashboard-section {
        padding: 0.5rem;
      }

      .navbar {
        padding: 0.5rem 1rem;
      }

      .card {
        padding: 0.75rem;
      }

      .dashboard-grid {
        gap: 0.75rem;
      }

      .sidebar {
        width: 100vw !important;
        min-width: 0 !important;
        max-width: 100vw !important;
        flex-direction: column !important;
        padding: 1rem 0.5rem 1rem 0.5rem !important;
        border-right: none;
        border-bottom: 2px solid var(--border);
      }

      .sidebar-filters-header {
        font-size: 1.2rem;
        margin-bottom: 1rem;
      }

      .filters-form {
        gap: 1.2rem !important;
      }

      .filters-row {
        flex-direction: column !important;
        gap: 0.7rem !important;
        width: 100% !important;
      }

      .filters-row>div {
        width: 100% !important;
        min-width: 0 !important;
      }

      .btn-primary,
      .btn-secondary {
        width: 100% !important;
        max-width: none !important;
        margin-bottom: 0.5rem;
      }

      .filters-form .filters-row:last-child {
        flex-direction: column !important;
        gap: 0.7rem !important;
        align-items: stretch !important;
      }

      .filters-file-label,
      .filters-input,
      .filters-row input[type='date'],
      .filters-row select {
        width: 100% !important;
        min-width: 0 !important;
      }

      .filters-row .flex {
        width: 100% !important;
      }
    }

    .sticky-header {
      position: sticky;
      top: 0;
      background: var(--white);
      z-index: 2;
    }

    .table-container {
      overflow-x: auto;
      width: 100%;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 1.1rem;
      background: var(--white);
      color: var(--text);
      border-radius: 0.5rem;
      overflow: hidden;
      box-shadow: 0 4px 12px 0 rgba(31, 106, 74, 0.15);
      border: 2px solid var(--secondaryMain);
    }

    th,
    td {
      padding: 1rem 0.75rem;
      text-align: left;
      border-bottom: 2px solid var(--secondaryMain);
      font-weight: 600;
    }

    th {
      background: rgba(31, 106, 74, 0.1);
      color: var(--text);
      font-weight: 600;
      cursor: pointer;
      user-select: none;
      position: sticky;
      top: 0;
      z-index: 1;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    tr:nth-child(even) {
      background: var(--white);
    }

    tr:nth-child(odd) {
      background: rgba(248, 249, 250, 0.5);
    }

    tr[tabindex='0']:focus,
    tr:hover {
      background: var(--secondaryMain);
      color: var(--neutral);
    }

    .pagination {
      display: flex;
      gap: 0.5rem;
      align-items: center;
      margin-top: 1rem;
      justify-content: flex-end;
    }

    .pagination button {
      background: var(--secondaryMain);
      color: var(--neutral);
      border: none;
      border-radius: 0.4rem;
      padding: 0.4rem 0.8rem;
      cursor: pointer;
      font-size: 1rem;
      transition: background 0.2s, color 0.2s;
    }

    .pagination button:disabled {
      background: var(--primarySurface);
      color: var(--textSecondary);
      cursor: not-allowed;
    }

    .pagination-btn {
      background: var(--secondaryMain);
      color: var(--neutral);
      border: none;
      border-radius: 0.4rem;
      padding: 0.4rem 0.8rem;
      cursor: pointer;
      font-size: 1rem;
      transition: background 0.2s, color 0.2s;
      min-width: 40px;
    }

    .pagination-btn:hover:not(:disabled) {
      background: var(--secondaryHover);
      color: var(--white);
    }

    .pagination-btn:disabled {
      background: var(--primarySurface);
      color: var(--textSecondary);
      cursor: not-allowed;
    }

    .pagination-btn.active {
      background: var(--primaryMain);
      color: var(--white);
      font-weight: bold;
    }

    .export-btn {
      background: var(--secondaryMain);
      color: var(--neutral);
      border: 1.5px solid var(--secondaryMain);
      border-radius: 0.4rem;
      padding: 0.4rem 1rem;
      cursor: pointer;
      font-size: 1rem;
      margin-left: 1rem;
      transition: background 0.2s, color 0.2s;
    }

    .export-btn:hover {
      background: var(--secondaryHover);
      color: var(--white);
    }

    .spinner {
      border: 4px solid var(--primarySurface);
      border-top: 4px solid var(--secondaryMain);
      border-radius: 50%;
      width: 32px;
      height: 32px;
      animation: spin 1s linear infinite;
      margin: 0 auto;
    }

    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }

      100% {
        transform: rotate(360deg);
      }
    }

    .gradient-header {
      background: var(--secondaryMain);
      color: var(--neutral);
      padding: 1.5rem 2rem;
      border-radius: 1rem 1rem 0 0;
      font-size: 1.5rem;
      font-weight: 700;
      letter-spacing: 1px;
      margin-bottom: 1.5rem;
      box-shadow: 0 2px 12px 0 rgba(255, 157, 24, 0.08);
    }

    .kpi-cards {
      display: flex;
      gap: 1.5rem;
      flex-wrap: wrap;
      margin-bottom: 1.5rem;
    }

    .kpi-card {
      flex: 1 1 180px;
      background: var(--white);
      color: var(--text);
      border-radius: 0.75rem;
      box-shadow: 0 6px 25px 0 rgba(31, 106, 74, 0.20);
      border: 3px solid var(--secondaryMain);
      padding: 1.2rem 1rem;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      min-width: 180px;
      transition: box-shadow 0.2s, background 0.2s, border 0.2s, transform 0.2s;
    }

    .kpi-card:hover {
      box-shadow: 0 8px 32px 0 rgba(255, 157, 24, 0.18);
      background: var(--secondaryMain);
      color: var(--neutral);
      border-color: var(--secondaryHover);
      transform: translateY(-2px);
    }

    .kpi-label {
      font-size: 1.1rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
      color: var(--text);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .kpi-value {
      font-size: 2rem;
      font-weight: 800;
      margin-bottom: 0.25rem;
      color: var(--primaryMain);
    }

    .kpi-desc {
      font-size: 0.95rem;
      color: var(--secondaryMain);
      font-weight: 600;
    }

    .date-picker {
      display: flex;
      gap: 0.5rem;
      align-items: center;
      margin-bottom: 1rem;
    }

    .date-picker input[type='date'] {
      border: 1px solid var(--secondaryMain);
      border-radius: 0.4rem;
      padding: 0.4rem 0.7rem;
      font-size: 1rem;
      background: var(--primarySurface);
      color: var(--text);
      transition: border 0.2s;
    }

    .date-picker input[type='date']:focus {
      border: 1.5px solid var(--secondaryMain);
      outline: none;
    }

    .vehicle-mapping {
      display: flex;
      gap: 1rem;
      align-items: center;
      margin-bottom: 1rem;
    }

    .vehicle-mapping select,
    .vehicle-mapping input {
      border: 1px solid var(--secondaryMain);
      border-radius: 0.4rem;
      padding: 0.4rem 0.7rem;
      font-size: 1rem;
      background: var(--primarySurface);
      color: var(--text);
      transition: border 0.2s;
    }

    .vehicle-mapping select:focus,
    .vehicle-mapping input:focus {
      border: 1.5px solid var(--secondaryMain);
      outline: none;
    }

    .theme-light {
      background: var(--neutral);
      color: var(--text);
    }

    .theme-dark {
      background: var(--neutral);
      color: var(--text);
    }

    .visually-hidden {
      position: absolute;
      left: -10000px;
      top: auto;
      width: 1px;
      height: 1px;
      overflow: hidden;
    }

    /* Modern Filters Section Styles */
    .filters-modern {
      background: var(--primaryFocus);
      border: 1.5px solid var(--secondaryMain);
      border-radius: 1.2rem;
      box-shadow: 0 2px 12px 0 rgba(255, 157, 24, 0.10);
    }

    .filters-form {
      width: 100%;
      display: flex;
      flex-direction: column;
      gap: 2.2rem;
    }

    .filters-row {
      width: 100%;
      display: flex;
      gap: 1.2rem;
      margin-bottom: 0.2rem;
      min-width: 0;
    }

    .filters-row>div {
      flex: 1 1 0;
      min-width: 0;
    }

    .filters-input[type='date'],
    .filters-row input[type='date'] {
      width: 100%;
      min-width: 0;
      box-sizing: border-box;
    }

    .filters-label {
      display: block;
      font-weight: 600;
      margin-bottom: 0.45rem;
      color: var(--textSecondary);
      font-size: 1.08rem;
      letter-spacing: 0.01em;
    }

    .filters-input {
      width: 100%;
      padding: 0.65rem 1rem;
      border-radius: 0.7rem;
      border: 2px solid var(--secondaryMain);
      background: var(--neutral);
      color: var(--text);
      font-size: 1.08rem;
      outline: none;
      transition: border 0.2s, box-shadow 0.2s;
      margin-bottom: 0.1rem;
    }

    .filters-input:focus {
      border-color: var(--secondaryHover);
      box-shadow: 0 0 0 2px rgba(229, 132, 0, 0.2);
    }

    /* Custom file input */
    .filters-input-file {
      display: none;
    }

    .filters-file-label {
      display: inline-block;
      width: 100%;
      padding: 0.65rem 1rem;
      border-radius: 0.7rem;
      border: 2px solid var(--secondaryMain);
      background: var(--neutral);
      color: var(--textSecondary);
      font-size: 1.08rem;
      font-weight: 600;
      cursor: pointer;
      text-align: left;
      transition: border 0.2s, background 0.2s, color 0.2s;
      margin-bottom: 0.1rem;
    }

    .filters-file-label:hover,
    .filters-file-label:focus {
      background: var(--primarySurface);
      color: var(--white);
      border-color: var(--secondaryHover);
    }

    .filters-file-name {
      display: block;
      color: var(--textSecondary);
      font-size: 0.98rem;
      margin-top: 0.2rem;
      margin-bottom: 0.1rem;
      word-break: break-all;
    }

    .filters-form .filters-row:last-child {
      justify-content: flex-end;
      gap: 1.2rem;
      margin-top: 0.5rem;
    }

    .btn-primary,
    .btn-secondary {
      width: 100%;
      max-width: 180px;
      margin: 0;
      font-size: 1.13rem;
      font-weight: 700;
      border-radius: 0.7rem;
    }

    .btn-primary {
      background: var(--secondaryMain);
      color: var(--neutral);
      border: none;
      padding: 0.7rem 1.3rem;
      box-shadow: 0 1px 4px 0 rgba(255, 157, 24, 0.10);
      transition: background 0.2s, color 0.2s;
    }

    .btn-primary:hover,
    .btn-primary:focus {
      background: var(--secondaryHover);
      color: var(--white);
    }

    .btn-secondary {
      background: var(--primarySurface);
      color: var(--textSecondary);
      border: 2px solid var(--secondaryMain);
      padding: 0.7rem 1.3rem;
      transition: background 0.2s, color 0.2s, border 0.2s;
    }

    .btn-secondary:hover,
    .btn-secondary:focus {
      background: var(--secondaryMain);
      color: var(--neutral);
      border-color: var(--secondaryHover);
    }

    @media (min-width: 400px) {
      .filters-form .filters-row:last-child {
        flex-direction: row;
      }

      .btn-primary,
      .btn-secondary {
        width: auto;
      }
    }

    .sidebar-filters-header {
      font-weight: 800;
      font-size: 1.5rem;
      margin-bottom: 2.2rem;
      letter-spacing: 1px;
      color: var(--secondaryMain);
    }

    @media (max-width: 900px) {
      .app-grid {
        flex-direction: column !important;
        width: 100vw;
      }

      .sidebar {
        width: 100vw !important;
        min-width: 0 !important;
        max-width: 100vw !important;
        border-right: none !important;
        border-bottom: 2px solid var(--border) !important;
      }

      .main-content {
        width: 100vw !important;
        max-width: 100vw !important;
        margin: 0 !important;
      }
    }

    .tab-btn {
      display: flex;
      align-items: center;
      width: 100%;
      text-align: left;
      padding: 0.75rem 1rem;
      margin: 0.25rem 0;
      border-radius: 0.5rem;
      background: transparent;
      color: var(--text);
      font-size: 1.08rem;
      font-weight: 500;
      border: none;
      outline: none;
      transition: background 0.15s, color 0.15s, box-shadow 0.15s;
      cursor: pointer;
      position: relative;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .tab-btn:hover {
      background: rgba(255, 157, 24, 0.10);
      color: var(--secondaryMain);
    }

    .tab-btn.selected {
      background: rgba(255, 157, 24, 0.18);
      color: var(--secondaryMain);
      box-shadow: 0 2px 8px 0 rgba(255, 157, 24, 0.08);
    }

    .tab-btn.selected::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0.5rem;
      bottom: 0.5rem;
      width: 5px;
      border-radius: 4px;
      background: var(--secondaryMain);
    }

    #filtersModal.hidden {
      display: none;
    }

    #filtersModal {
      animation: fadeIn 0.2s;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
      }

      to {
        opacity: 1;
      }
    }

    #sidebar {
      box-shadow: 2px 0 8px rgba(0, 0, 0, 0.08);
      background: var(--white);
    }

    @media (min-width: 768px) {
      #sidebar {
        transform: translateX(0) !important;
        position: static !important;
      }
    }

    .tab-btn i {
      min-width: 1.25em;
      margin-right: 0.75em;
      text-align: center;
      color: var(--secondaryMain);
      opacity: 0.85;
      font-size: 1.15em;
    }

    .card.flip-in {
      opacity: 0;
      transform: rotateY(90deg);
      animation: flipIn 0.7s cubic-bezier(.68, -0.55, .27, 1.55) forwards;
      backface-visibility: hidden;
    }

    @keyframes flipIn {
      to {
        opacity: 1;
        transform: none;
      }
    }

    .home-image-shadow {
      box-shadow:
        0 12px 48px 0 rgba(31, 106, 74, 0.40),
        /* deep green shadow */
        0 0 0 8px rgba(255, 157, 24, 0.10),
        /* orange glow ring */
        0 2px 16px 0 rgba(255, 157, 24, 0.18),
        /* orange drop shadow */
        0 1.5px 8px 0 rgba(255, 157, 24, 0.18);
      /* extra orange */
    }

    .subtitle-custom {
      color: var(--neutral) !important;
      font-weight: 800 !important;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1) !important;
    }
  </style>
</head>

<body class="bg-[var(--lightBackground)] min-h-screen">
  <!-- NAVBAR WITH FILTER BUTTON AND HAMBURGER -->
  <nav class="navbar flex items-center justify-between px-6 py-4 bg-[var(--secondaryMain)] w-full">
    <div class="flex items-center gap-4">
      <button id="sidebarToggle" class="md:hidden mr-2 text-2xl text-white">&#9776;</button>
      <span className="text-3xl font-bold text-white">Home Delivery KPIs</span>
    </div>
  </nav>

  <!-- Replace the main content and sidebar with a React root -->
  <div id="dashboard-root"></div>

  <!-- FILTERS MODAL (hidden by default) -->
  <div id="filtersModal" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40 hidden">
    <div class="bg-[var(--white)] rounded-lg p-6 w-full max-w-md relative">
      <button id="closeFiltersBtn" class="absolute top-2 right-2 text-xl">&times;</button>
      <h2 className="text-xl font-bold mb-4 text-[var(--secondaryMain)]">Filters</h2>
      <form class="filters-form flex flex-col gap-4">
        <div class="flex gap-4">
          <div class="flex flex-col w-1/2">
            <label class="font-semibold mb-1">Start Date</label>
            <input type="date"
              class="rounded-md px-3 py-2 border border-[var(--secondaryMain)] bg-transparent text-white" />
          </div>
          <div class="flex flex-col w-1/2">
            <label class="font-semibold mb-1">End Date</label>
            <input type="date"
              class="rounded-md px-3 py-2 border border-[var(--secondaryMain)] bg-transparent text-white" />
          </div>
        </div>
        <div class="flex flex-col">
          <label class="font-semibold mb-1">Vehicle Type</label>
          <select class="rounded-md px-3 py-2 border border-[var(--secondaryMain)] bg-transparent text-white">
            <option>All</option>
            <!-- Add more options as needed -->
          </select>
        </div>
        <div class="flex flex-col">
          <label class="font-semibold mb-1">Upload</label>
          <div
            class="border-2 border-dashed border-[var(--secondaryMain)] rounded-md p-6 text-center text-[var(--secondaryMain)] cursor-pointer">
            Drop a file here to upload, or <a href="#" class="underline font-semibold">click here to browse</a>
          </div>
        </div>
        <button type="button" class="btn-primary mt-2">Clear Filters</button>
      </form>
    </div>
  </div>

  <script type="text/babel">
    const tabList = [
      { key: 'home', label: 'Home', icon: <i className="fa-solid fa-house mr-3" /> },
      { key: 'overview', label: 'Overview', icon: <i className="fa-solid fa-chart-bar mr-3" /> },
      { key: 'pnl', label: 'PnL', icon: <i className="fa-solid fa-file-invoice-dollar mr-3" /> },
      { key: 'revenue', label: 'Revenue', icon: <i className="fa-solid fa-coins mr-3" /> },
      { key: 'firstmile', label: 'First Mile', icon: <i className="fa-solid fa-truck-fast mr-3" /> },
      { key: 'sortcenter', label: 'Sort Center', icon: <i className="fa-solid fa-building mr-3" /> },
      { key: 'scgap', label: 'SC Gap Analysis', icon: <i className="fa-solid fa-magnifying-glass-chart mr-3" /> },
      { key: 'linehaul', label: 'Line Haul', icon: <i className="fa-solid fa-truck mr-3" /> },
      { key: 'lhgap', label: 'LH Gap Analysis', icon: <i className="fa-solid fa-magnifying-glass-chart mr-3" /> },
      { key: 'pps', label: 'PPS', icon: <i className="fa-solid fa-clipboard-list mr-3" /> },
      { key: 'tpl', label: '3PL', icon: <i className="fa-solid fa-warehouse mr-3" /> },
      { key: 'mv', label: 'M&V', icon: <i className="fa-solid fa-chart-line mr-3" /> },
      { key: 'hb', label: 'H&B', icon: <i className="fa-solid fa-box mr-3" /> },
      { key: 'volumes', label: 'Volumes', icon: <i className="fa-solid fa-chart-bar mr-3" /> },
      { key: 'customersvolumes', label: 'Customers Volumes', icon: <i className="fa-solid fa-users mr-3" /> },
      { key: 'settings', label: 'Settings', icon: <i className="fa-solid fa-gear mr-3" /> },
    ];

    // Insert this before the Dashboard function
    // Delivered Volume Value function - reads from "DSHB" sheet column G across multiple files
    function DeliveredVolumeValue({ files }) {
      const [delivered, setDelivered] = React.useState(null);
      const [loading, setLoading] = React.useState(false);
      const [error, setError] = React.useState("");
      const [sourceFile, setSourceFile] = React.useState("");
      const target = 592049;

      let variance = undefined;
      let varianceColor = undefined;
      if (delivered !== null && target) {
        const rawVar = ((delivered - target) / target) * 100;
        variance = rawVar.toFixed(1) + '%';
        varianceColor = rawVar >= 0 ? '#1f6a4a' : '#8B0000';
      }

      React.useEffect(() => {
        if (!files || files.length === 0) {
          setDelivered(null);
          setError("");
          setSourceFile("");
          return;
        }

        setLoading(true);
        setError("");

        findDataFromSheet(files, 'DSHB', 6) // Column G = index 6
          .then(result => {
            if (result) {
              setDelivered(result.sum);
              setSourceFile(result.fileName);
              setError("");
            } else {
              setDelivered(null);
              setSourceFile("");
              setError("No 'DSHB' sheet found in uploaded files");
            }
          })
          .catch(err => {
            setError("Error reading files: " + err.message);
            setDelivered(null);
            setSourceFile("");
          })
          .finally(() => {
            setLoading(false);
          });
      }, [files]);

      return (
        <KpiCardTwoTone
          label="Delivered Volume"
          icon="fa-truck"
          value={loading ? '...' : (delivered !== null ? delivered.toLocaleString() : undefined)}
          target={delivered !== null ? target.toLocaleString() : ''}
          variance={delivered !== null ? <span style={{ color: varianceColor, fontWeight: 800 }}>{variance}</span> : ''}
        />
      );
    }

    // Utility function to find and read data from a specific sheet across multiple files
    async function findDataFromSheet(files, sheetName, columnIndex = 0) {
      if (!files || files.length === 0) return null;

      for (const file of files) {
        try {
          const result = await new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.onload = (evt) => {
              try {
                const data = new Uint8Array(evt.target.result);
                const workbook = window.XLSX.read(data, { type: 'array' });

                // Check if the sheet exists in this file
                if (workbook.Sheets[sheetName]) {
                  const sheet = workbook.Sheets[sheetName];
                  const csv = window.XLSX.utils.sheet_to_csv(sheet);

                  window.Papa.parse(csv, {
                    header: true,
                    skipEmptyLines: true,
                    complete: (results) => {
                      try {
                        const keys = Object.keys(results.data[0] || {});
                        const targetKey = keys[columnIndex] || keys.find(key =>
                          key.trim().toUpperCase() === String.fromCharCode(65 + columnIndex)
                        );

                        let sum = 0;
                        for (const row of results.data) {
                          const val = row[targetKey];
                          if (val !== undefined && val !== null && val !== "") {
                            const num = Number(val.toString().replace(/,/g, ''));
                            if (!isNaN(num)) sum += num;
                          }
                        }
                        resolve({ sum, fileName: file.name, sheetName });
                      } catch (e) {
                        reject(e);
                      }
                    },
                    error: reject
                  });
                } else {
                  resolve(null); // Sheet not found in this file
                }
              } catch (e) {
                reject(e);
              }
            };
            reader.onerror = reject;
            reader.readAsArrayBuffer(file);
          });

          if (result) {
            return result; // Found the sheet, return the data
          }
        } catch (e) {
          console.warn(`Error reading file ${file.name}:`, e);
          continue; // Try next file
        }
      }
      return null; // Sheet not found in any file
    }

    // Sort Center Volume Value function - reads from "SC VOL" sheet column B (Volume) across multiple files
    function SortCenterVolumeValue({ files }) {
      const [volume, setVolume] = React.useState(null);
      const [loading, setLoading] = React.useState(false);
      const [error, setError] = React.useState("");
      const [sourceFile, setSourceFile] = React.useState("");
      const target = 150000; // Updated target for Sort Center volumes

      let variance = undefined;
      let varianceColor = undefined;
      if (volume !== null && target) {
        const rawVar = ((volume - target) / target) * 100;
        variance = rawVar.toFixed(1) + '%';
        varianceColor = rawVar >= 0 ? '#1f6a4a' : '#8B0000';
      }

      React.useEffect(() => {
        if (!files || files.length === 0) {
          setVolume(null);
          setError("");
          setSourceFile("");
          return;
        }

        setLoading(true);
        setError("");

        findDataFromSheet(files, 'SC VOL', 1) // Column B (Volume) = index 1
          .then(result => {
            if (result) {
              setVolume(result.sum);
              setSourceFile(result.fileName);
              setError("");
            } else {
              setVolume(null);
              setSourceFile("");
              setError("No 'SC VOL' sheet found in uploaded files");
            }
          })
          .catch(err => {
            setError("Error reading files: " + err.message);
            setVolume(null);
            setSourceFile("");
          })
          .finally(() => {
            setLoading(false);
          });
      }, [files]);

      return (
        <KpiCardSingleTone
          label="Sort Center Volume"
          icon="fa-truck"
          value={loading ? '...' : (volume !== null ? volume.toLocaleString() : undefined)}
        />
      );
    }



    // First Mile Volume Value function - reads from "DSHB" sheet column AY (Total) across multiple files
    function FirstMileVolumeValue({ files }) {
      const [volume, setVolume] = React.useState(null);
      const [loading, setLoading] = React.useState(false);
      const [error, setError] = React.useState("");
      const [sourceFile, setSourceFile] = React.useState("");
      const target = 20000;

      let variance = undefined;
      let varianceColor = undefined;
      if (volume !== null && target) {
        const rawVar = ((volume - target) / target) * 100;
        variance = rawVar.toFixed(1) + '%';
        varianceColor = rawVar >= 0 ? '#1f6a4a' : '#8B0000';
      }

      React.useEffect(() => {
        if (!files || files.length === 0) {
          setVolume(null);
          setError("");
          setSourceFile("");
          return;
        }

        setLoading(true);
        setError("");

        findDataFromSheet(files, 'FM VOL', 1) // Column B (Volume) = index 1
          .then(result => {
            if (result) {
              setVolume(result.sum);
              setSourceFile(result.fileName);
              setError("");
            } else {
              setVolume(null);
              setSourceFile("");
              setError("No 'FM VOL' sheet found in uploaded files");
            }
          })
          .catch(err => {
            setError("Error reading files: " + err.message);
            setVolume(null);
            setSourceFile("");
          })
          .finally(() => {
            setLoading(false);
          });
      }, [files]);

      return (
        <KpiCardSingleTone
          label="First Mile Volume"
          icon="fa-truck"
          value={loading ? '...' : (volume !== null ? volume.toLocaleString() : undefined)}
        />
      );
    }

    // First Mile Volume Chart component - reads daily data from "FM VOL" sheet
    function FirstMileVolumeChart({ files }) {
      const chartRef = React.useRef(null);
      const [chartData, setChartData] = React.useState(null);
      const [loading, setLoading] = React.useState(false);
      const [error, setError] = React.useState("");

      React.useEffect(() => {
        if (!files || files.length === 0) {
          setChartData(null);
          setError("");
          return;
        }

        setLoading(true);
        setError("");

        // Read data from FM VOL sheet
        const processFiles = async () => {
          try {
            for (const file of files) {
              const result = await new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = (evt) => {
                  try {
                    const data = new Uint8Array(evt.target.result);
                    const workbook = window.XLSX.read(data, { type: 'array' });

                    if (workbook.Sheets['FM VOL']) {
                      const sheet = workbook.Sheets['FM VOL'];
                      const csv = window.XLSX.utils.sheet_to_csv(sheet);

                      window.Papa.parse(csv, {
                        header: true,
                        skipEmptyLines: true,
                        complete: (results) => {
                          const chartData = {
                            labels: [],
                            volumes: []
                          };

                          results.data.forEach(row => {
                            if (row.Date && row.Volume) {
                              // Format date for display
                              const date = new Date(row.Date);
                              const formattedDate = date.toLocaleDateString('en-US', {
                                month: 'short',
                                day: 'numeric'
                              });
                              chartData.labels.push(formattedDate);
                              chartData.volumes.push(Number(row.Volume) || 0);
                            }
                          });

                          resolve(chartData);
                        },
                        error: (error) => reject(error)
                      });
                    } else {
                      resolve(null);
                    }
                  } catch (err) {
                    reject(err);
                  }
                };
                reader.onerror = reject;
                reader.readAsArrayBuffer(file);
              });

              if (result) {
                setChartData(result);
                setError("");
                break;
              }
            }
          } catch (err) {
            setError("Error reading files: " + err.message);
            setChartData(null);
          } finally {
            setLoading(false);
          }
        };

        processFiles();
      }, [files]);

      React.useEffect(() => {
        if (!chartData || !chartRef.current) return;

        // Clean up previous chart
        if (chartRef.current._chartInstance) {
          chartRef.current._chartInstance.destroy();
        }

        // Get colors
        const rootStyle = getComputedStyle(document.documentElement);
        const orange = rootStyle.getPropertyValue('--secondaryMain').trim() || '#ff9d18';
        const orangeFill = 'rgba(255,157,24,0.15)';
        const green = rootStyle.getPropertyValue('--primaryMain').trim() || '#1f6a4a';
        const fontFamily = `'Euclid Circular B', 'Inter', 'sans-serif'`;

        // Create chart
        chartRef.current._chartInstance = new window.Chart(chartRef.current.getContext('2d'), {
          type: 'line',
          data: {
            labels: chartData.labels,
            datasets: [{
              label: 'First Mile Volume',
              data: chartData.volumes,
              fill: true,
              backgroundColor: orangeFill,
              borderColor: orange,
              borderWidth: 3,
              pointBackgroundColor: green,
              pointBorderColor: orange,
              pointRadius: 4,
              pointHoverRadius: 6,
              tension: 0.3,
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: { display: false },
              tooltip: {
                callbacks: {
                  label: ctx => `Volume: ${ctx.parsed.y.toLocaleString()}`
                },
                backgroundColor: '#222',
                titleColor: '#fff',
                bodyColor: '#fff',
                borderColor: '#fff',
                borderWidth: 1,
              }
            },
            scales: {
              x: {
                grid: { color: '#295c47', drawOnChartArea: false },
                ticks: { color: '#fff', font: { family: fontFamily } }
              },
              y: {
                beginAtZero: true,
                grid: { color: '#295c47' },
                ticks: {
                  color: '#fff',
                  font: { family: fontFamily },
                  callback: function (value) {
                    return value.toLocaleString();
                  }
                }
              }
            }
          }
        });

        return () => {
          if (chartRef.current && chartRef.current._chartInstance) {
            chartRef.current._chartInstance.destroy();
          }
        };
      }, [chartData]);

      if (loading) {
        return (
          <div className="h-72 flex items-center justify-center">
            <div className="spinner"></div>
          </div>
        );
      }

      if (error) {
        return (
          <div className="h-72 flex items-center justify-center">
            <div className="text-red-400 text-center">
              <p className="font-semibold">Error loading chart data</p>
              <p className="text-sm">{error}</p>
            </div>
          </div>
        );
      }

      return (
        <div className="h-72 flex items-center justify-center">
          <canvas ref={chartRef} width="700" height="250"></canvas>
        </div>
      );
    }

    // First Mile Volumes per Hub Chart component - reads hub data from "FM VOL" sheet
    function FirstMileVolumesPerHubChart({ files }) {
      const chartRef = React.useRef(null);
      const [chartData, setChartData] = React.useState(null);
      const [loading, setLoading] = React.useState(false);
      const [error, setError] = React.useState("");

      React.useEffect(() => {
        if (!files || files.length === 0) {
          setChartData(null);
          setError("");
          return;
        }

        setLoading(true);
        setError("");

        // Read hub data from FM VOL sheet
        const processFiles = async () => {
          try {
            for (const file of files) {
              const result = await new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = (evt) => {
                  try {
                    const data = new Uint8Array(evt.target.result);
                    const workbook = window.XLSX.read(data, { type: 'array' });

                    if (workbook.Sheets['FM VOL']) {
                      const sheet = workbook.Sheets['FM VOL'];
                      const csv = window.XLSX.utils.sheet_to_csv(sheet);

                      window.Papa.parse(csv, {
                        header: true,
                        skipEmptyLines: true,
                        complete: (results) => {
                          const hubData = {
                            labels: [],
                            volumes: []
                          };

                          // Hub columns in order: RUH, JED, DMM, MED, KAM, QAS
                          const hubColumns = ['RUH', 'JED', 'DMM', 'MED', 'KAM', 'QAS'];

                          hubColumns.forEach(hub => {
                            let total = 0;
                            results.data.forEach(row => {
                              if (row[hub]) {
                                const value = Number(row[hub]) || 0;
                                total += value;
                              }
                            });

                            // Only include hubs with non-zero values for better visualization
                            if (total > 0) {
                              hubData.labels.push(hub);
                              hubData.volumes.push(total);
                            }
                          });

                          // Sort by volume (descending) to match the design
                          const combined = hubData.labels.map((label, index) => ({
                            label,
                            volume: hubData.volumes[index]
                          }));

                          combined.sort((a, b) => b.volume - a.volume);

                          hubData.labels = combined.map(item => item.label);
                          hubData.volumes = combined.map(item => item.volume);

                          resolve(hubData);
                        },
                        error: (error) => reject(error)
                      });
                    } else {
                      resolve(null);
                    }
                  } catch (err) {
                    reject(err);
                  }
                };
                reader.onerror = reject;
                reader.readAsArrayBuffer(file);
              });

              if (result) {
                setChartData(result);
                setError("");
                break;
              }
            }
          } catch (err) {
            setError("Error reading files: " + err.message);
            setChartData(null);
          } finally {
            setLoading(false);
          }
        };

        processFiles();
      }, [files]);

      React.useEffect(() => {
        if (!chartData || !chartRef.current) return;

        // Clean up previous chart
        if (chartRef.current._chartInstance) {
          chartRef.current._chartInstance.destroy();
        }

        // Get colors
        const rootStyle = getComputedStyle(document.documentElement);
        const orange = rootStyle.getPropertyValue('--secondaryMain').trim() || '#ff9d18';
        const fontFamily = `'Euclid Circular B', 'Inter', 'sans-serif'`;

        // Create horizontal bar chart
        chartRef.current._chartInstance = new window.Chart(chartRef.current.getContext('2d'), {
          type: 'bar',
          data: {
            labels: chartData.labels,
            datasets: [{
              label: 'First Mile Volume',
              data: chartData.volumes,
              backgroundColor: orange,
              borderColor: orange,
              borderWidth: 1,
              barThickness: 40,
            }]
          },
          options: {
            indexAxis: 'y', // This makes it horizontal
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: { display: false },
              tooltip: {
                callbacks: {
                  label: ctx => `Volume: ${ctx.parsed.x.toLocaleString()}`
                },
                backgroundColor: '#222',
                titleColor: '#fff',
                bodyColor: '#fff',
                borderColor: '#fff',
                borderWidth: 1,
              }
            },
            scales: {
              x: {
                beginAtZero: true,
                grid: { color: '#295c47' },
                ticks: {
                  color: '#fff',
                  font: { family: fontFamily },
                  callback: function (value) {
                    return value.toLocaleString();
                  }
                },
                title: {
                  display: true,
                  text: 'First Mile Volume',
                  color: '#fff',
                  font: { family: fontFamily, size: 12 }
                }
              },
              y: {
                grid: { color: '#295c47', drawOnChartArea: false },
                ticks: {
                  color: '#fff',
                  font: { family: fontFamily, size: 12 }
                },
                title: {
                  display: true,
                  text: 'Current Hub Code',
                  color: '#fff',
                  font: { family: fontFamily, size: 12 }
                }
              }
            }
          }
        });

        return () => {
          if (chartRef.current && chartRef.current._chartInstance) {
            chartRef.current._chartInstance.destroy();
          }
        };
      }, [chartData]);

      if (loading) {
        return (
          <div className="h-72 flex items-center justify-center">
            <div className="spinner"></div>
          </div>
        );
      }

      if (error) {
        return (
          <div className="h-72 flex items-center justify-center">
            <div className="text-red-400 text-center">
              <p className="font-semibold">Error loading chart data</p>
              <p className="text-sm">{error}</p>
            </div>
          </div>
        );
      }

      return (
        <div className="h-72 flex items-center justify-center">
          <canvas ref={chartRef} width="700" height="250"></canvas>
        </div>
      );
    }

    // Sort Center Volume Chart component - reads daily data from "SC VOL" sheet
    function SortCenterVolumeChart({ files }) {
      const chartRef = React.useRef(null);
      const [chartData, setChartData] = React.useState(null);
      const [loading, setLoading] = React.useState(false);
      const [error, setError] = React.useState("");

      React.useEffect(() => {
        if (!files || files.length === 0) {
          setChartData(null);
          setError("");
          return;
        }

        setLoading(true);
        setError("");

        // Read data from SC VOL sheet
        const processFiles = async () => {
          try {
            for (const file of files) {
              const result = await new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = (evt) => {
                  try {
                    const data = new Uint8Array(evt.target.result);
                    const workbook = window.XLSX.read(data, { type: 'array' });

                    if (workbook.Sheets['SC VOL']) {
                      const sheet = workbook.Sheets['SC VOL'];
                      const csv = window.XLSX.utils.sheet_to_csv(sheet);

                      window.Papa.parse(csv, {
                        header: true,
                        skipEmptyLines: true,
                        complete: (results) => {
                          const chartData = {
                            labels: [],
                            volumes: []
                          };

                          results.data.forEach(row => {
                            if (row.Date && row.Volume) {
                              // Format date for display
                              const date = new Date(row.Date);
                              const formattedDate = date.toLocaleDateString('en-US', {
                                month: 'short',
                                day: 'numeric'
                              });
                              chartData.labels.push(formattedDate);
                              chartData.volumes.push(Number(row.Volume) || 0);
                            }
                          });

                          resolve(chartData);
                        },
                        error: (error) => reject(error)
                      });
                    } else {
                      resolve(null);
                    }
                  } catch (err) {
                    reject(err);
                  }
                };
                reader.onerror = reject;
                reader.readAsArrayBuffer(file);
              });

              if (result) {
                setChartData(result);
                setError("");
                break;
              }
            }
          } catch (err) {
            setError("Error reading files: " + err.message);
            setChartData(null);
          } finally {
            setLoading(false);
          }
        };

        processFiles();
      }, [files]);

      React.useEffect(() => {
        if (!chartData || !chartRef.current) return;

        // Clean up previous chart
        if (chartRef.current._chartInstance) {
          chartRef.current._chartInstance.destroy();
        }

        // Get colors
        const rootStyle = getComputedStyle(document.documentElement);
        const orange = rootStyle.getPropertyValue('--secondaryMain').trim() || '#ff9d18';
        const orangeFill = 'rgba(255,157,24,0.15)';
        const green = rootStyle.getPropertyValue('--primaryMain').trim() || '#1f6a4a';
        const fontFamily = `'Euclid Circular B', 'Inter', 'sans-serif'`;

        // Create chart
        chartRef.current._chartInstance = new window.Chart(chartRef.current.getContext('2d'), {
          type: 'line',
          data: {
            labels: chartData.labels,
            datasets: [{
              label: 'Sort Center Volume',
              data: chartData.volumes,
              fill: true,
              backgroundColor: orangeFill,
              borderColor: orange,
              borderWidth: 3,
              pointBackgroundColor: green,
              pointBorderColor: orange,
              pointRadius: 4,
              pointHoverRadius: 6,
              tension: 0.3,
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: { display: false },
              tooltip: {
                callbacks: {
                  label: ctx => `Volume: ${ctx.parsed.y.toLocaleString()}`
                },
                backgroundColor: '#222',
                titleColor: '#fff',
                bodyColor: '#fff',
                borderColor: '#fff',
                borderWidth: 1,
              }
            },
            scales: {
              x: {
                grid: { color: '#295c47', drawOnChartArea: false },
                ticks: { color: '#fff', font: { family: fontFamily } }
              },
              y: {
                beginAtZero: true,
                grid: { color: '#295c47' },
                ticks: {
                  color: '#fff',
                  font: { family: fontFamily },
                  callback: function (value) {
                    return value.toLocaleString();
                  }
                }
              }
            }
          }
        });

        return () => {
          if (chartRef.current && chartRef.current._chartInstance) {
            chartRef.current._chartInstance.destroy();
          }
        };
      }, [chartData]);

      if (loading) {
        return (
          <div className="h-72 flex items-center justify-center">
            <div className="spinner"></div>
          </div>
        );
      }

      if (error) {
        return (
          <div className="h-72 flex items-center justify-center">
            <div className="text-red-400 text-center">
              <p className="font-semibold">Error loading chart data</p>
              <p className="text-sm">{error}</p>
            </div>
          </div>
        );
      }

      return (
        <div className="h-72 flex items-center justify-center">
          <canvas ref={chartRef} width="700" height="250"></canvas>
        </div>
      );
    }

    // Sort Center Volumes per Hub Chart component - reads hub data from "SC VOL" sheet
    function SortCenterVolumesPerHubChart({ files }) {
      const chartRef = React.useRef(null);
      const [chartData, setChartData] = React.useState(null);
      const [loading, setLoading] = React.useState(false);
      const [error, setError] = React.useState("");

      React.useEffect(() => {
        if (!files || files.length === 0) {
          setChartData(null);
          setError("");
          return;
        }

        setLoading(true);
        setError("");

        // Read hub data from SC VOL sheet
        const processFiles = async () => {
          try {
            for (const file of files) {
              const result = await new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = (evt) => {
                  try {
                    const data = new Uint8Array(evt.target.result);
                    const workbook = window.XLSX.read(data, { type: 'array' });

                    if (workbook.Sheets['SC VOL']) {
                      const sheet = workbook.Sheets['SC VOL'];
                      const csv = window.XLSX.utils.sheet_to_csv(sheet);

                      window.Papa.parse(csv, {
                        header: true,
                        skipEmptyLines: true,
                        complete: (results) => {
                          const hubData = {
                            labels: [],
                            volumes: []
                          };

                          // Hub columns in order: RUH, JED, DMM, MED, KAM, QAS
                          const hubColumns = ['RUH', 'JED', 'DMM', 'MED', 'KAM', 'QAS'];

                          hubColumns.forEach(hub => {
                            let total = 0;
                            results.data.forEach(row => {
                              if (row[hub]) {
                                const value = Number(row[hub]) || 0;
                                total += value;
                              }
                            });

                            // Only include hubs with non-zero values for better visualization
                            if (total > 0) {
                              hubData.labels.push(hub);
                              hubData.volumes.push(total);
                            }
                          });

                          // Sort by volume (descending) to match the design
                          const combined = hubData.labels.map((label, index) => ({
                            label,
                            volume: hubData.volumes[index]
                          }));

                          combined.sort((a, b) => b.volume - a.volume);

                          hubData.labels = combined.map(item => item.label);
                          hubData.volumes = combined.map(item => item.volume);

                          resolve(hubData);
                        },
                        error: (error) => reject(error)
                      });
                    } else {
                      resolve(null);
                    }
                  } catch (err) {
                    reject(err);
                  }
                };
                reader.onerror = reject;
                reader.readAsArrayBuffer(file);
              });

              if (result) {
                setChartData(result);
                setError("");
                break;
              }
            }
          } catch (err) {
            setError("Error reading files: " + err.message);
            setChartData(null);
          } finally {
            setLoading(false);
          }
        };

        processFiles();
      }, [files]);

      React.useEffect(() => {
        if (!chartData || !chartRef.current) return;

        // Clean up previous chart
        if (chartRef.current._chartInstance) {
          chartRef.current._chartInstance.destroy();
        }

        // Get colors
        const rootStyle = getComputedStyle(document.documentElement);
        const orange = rootStyle.getPropertyValue('--secondaryMain').trim() || '#ff9d18';
        const fontFamily = `'Euclid Circular B', 'Inter', 'sans-serif'`;

        // Create horizontal bar chart
        chartRef.current._chartInstance = new window.Chart(chartRef.current.getContext('2d'), {
          type: 'bar',
          data: {
            labels: chartData.labels,
            datasets: [{
              label: 'Sort Center Volume',
              data: chartData.volumes,
              backgroundColor: orange,
              borderColor: orange,
              borderWidth: 1,
              barThickness: 40,
            }]
          },
          options: {
            indexAxis: 'y', // This makes it horizontal
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: { display: false },
              tooltip: {
                callbacks: {
                  label: ctx => `Volume: ${ctx.parsed.x.toLocaleString()}`
                },
                backgroundColor: '#222',
                titleColor: '#fff',
                bodyColor: '#fff',
                borderColor: '#fff',
                borderWidth: 1,
              }
            },
            scales: {
              x: {
                beginAtZero: true,
                grid: { color: '#295c47' },
                ticks: {
                  color: '#fff',
                  font: { family: fontFamily },
                  callback: function (value) {
                    return value.toLocaleString();
                  }
                },
                title: {
                  display: true,
                  text: 'Sort Center Volume',
                  color: '#fff',
                  font: { family: fontFamily, size: 12 }
                }
              },
              y: {
                grid: { color: '#295c47', drawOnChartArea: false },
                ticks: {
                  color: '#fff',
                  font: { family: fontFamily, size: 12 }
                },
                title: {
                  display: true,
                  text: 'Current Hub Code',
                  color: '#fff',
                  font: { family: fontFamily, size: 12 }
                }
              }
            }
          }
        });

        return () => {
          if (chartRef.current && chartRef.current._chartInstance) {
            chartRef.current._chartInstance.destroy();
          }
        };
      }, [chartData]);

      if (loading) {
        return (
          <div className="h-72 flex items-center justify-center">
            <div className="spinner"></div>
          </div>
        );
      }

      if (error) {
        return (
          <div className="h-72 flex items-center justify-center">
            <div className="text-red-400 text-center">
              <p className="font-semibold">Error loading chart data</p>
              <p className="text-sm">{error}</p>
            </div>
          </div>
        );
      }

      return (
        <div className="h-72 flex items-center justify-center">
          <canvas ref={chartRef} width="700" height="250"></canvas>
        </div>
      );
    }

    // Line Haul Volume Value function - reads from "DSHB" sheet column AY (Total) across multiple files
    function LineHaulVolumeValue({ files }) {
      const [volume, setVolume] = React.useState(null);
      const [loading, setLoading] = React.useState(false);
      const [error, setError] = React.useState("");
      const [sourceFile, setSourceFile] = React.useState("");
      const target = 85000; // Typical line haul target

      let variance = undefined;
      let varianceColor = undefined;
      if (volume !== null && target) {
        const rawVar = ((volume - target) / target) * 100;
        variance = rawVar.toFixed(1) + '%';
        varianceColor = rawVar >= 0 ? '#1f6a4a' : '#8B0000';
      }

      React.useEffect(() => {
        if (!files || files.length === 0) {
          setVolume(null);
          setError("");
          setSourceFile("");
          return;
        }

        setLoading(true);
        setError("");

        findDataFromSheet(files, 'DSHB', 50) // Column AY = index 50 (AY is the 51st column)
          .then(result => {
            if (result) {
              setVolume(result.sum);
              setSourceFile(result.fileName);
              setError("");
            } else {
              setVolume(null);
              setSourceFile("");
              setError("No 'DSHB' sheet found in uploaded files");
            }
          })
          .catch(err => {
            setError("Error reading files: " + err.message);
            setVolume(null);
            setSourceFile("");
          })
          .finally(() => {
            setLoading(false);
          });
      }, [files]);

      return (
        <KpiCardSingleTone
          label="Line Haul Volume"
          icon="fa-truck"
          value={loading ? '...' : (volume !== null ? volume.toLocaleString() : undefined)}
        />
      );
    }

    // Top 5 Customers by Volume Component
    function Top5CustomersByVolume({ files }) {
      const [customers, setCustomers] = React.useState([]);
      const [loading, setLoading] = React.useState(false);
      const [error, setError] = React.useState("");

      React.useEffect(() => {
        if (!files || files.length === 0) {
          setCustomers([]);
          setError("");
          return;
        }
        const file = files[0];
        setLoading(true);
        setError("");

        function processCustomerData(results) {
          try {
            const data = results.data;
            if (!data || data.length === 0) {
              setError("No data found in file");
              setCustomers([]);
              setLoading(false);
              return;
            }

            // Find column indices for Customer (C) and Revenue (H)
            const headers = Object.keys(data[0]);
            let customerCol = headers[2]; // Column C (0-indexed)
            let volumeCol = headers[7]; // Column H (0-indexed)

            // Try to find columns by name if they exist
            for (const key of headers) {
              const keyUpper = key.trim().toUpperCase();
              if (keyUpper.includes('CUSTOMER') || keyUpper === 'C') {
                customerCol = key;
              }
              if (keyUpper.includes('REV') || keyUpper === 'H') {
                volumeCol = key;
              }
            }

            // Group customers and sum their volumes
            const customerMap = new Map();

            for (const row of data) {
              const customerName = row[customerCol];
              const volumeValue = row[volumeCol];

              if (customerName && volumeValue !== undefined && volumeValue !== null && volumeValue !== "") {
                const volume = Number(volumeValue.toString().replace(/,/g, ''));
                if (!isNaN(volume)) {
                  const existing = customerMap.get(customerName) || 0;
                  customerMap.set(customerName, existing + volume);
                }
              }
            }

            // Convert to array and sort by volume (descending)
            const sortedCustomers = Array.from(customerMap.entries())
              .map(([name, volume]) => ({ name, volume }))
              .sort((a, b) => b.volume - a.volume)
              .slice(0, 5); // Get top 5

            setCustomers(sortedCustomers);
          } catch (e) {
            setError("Error processing data: " + e.message);
            setCustomers([]);
          }
          setLoading(false);
        }

        if (file.name.endsWith('.csv')) {
          window.Papa.parse(file, {
            header: true,
            skipEmptyLines: true,
            complete: processCustomerData,
            error: (err) => {
              setError("Error reading CSV: " + err.message);
              setCustomers([]);
              setLoading(false);
            }
          });
        } else {
          const reader = new FileReader();
          reader.onload = (evt) => {
            try {
              const data = new Uint8Array(evt.target.result);
              const workbook = window.XLSX.read(data, { type: 'array' });

              // Try to find the right sheet (first sheet if DSHB doesn't exist)
              let sheetName = workbook.SheetNames[0];
              if (workbook.Sheets['DSHB']) {
                sheetName = 'DSHB';
              }

              const sheet = workbook.Sheets[sheetName];
              if (!sheet) {
                setError("No valid sheet found.");
                setCustomers([]);
                setLoading(false);
                return;
              }

              const csv = window.XLSX.utils.sheet_to_csv(sheet);
              window.Papa.parse(csv, {
                header: true,
                skipEmptyLines: true,
                complete: processCustomerData,
                error: (err) => {
                  setError("Error processing Excel: " + err.message);
                  setCustomers([]);
                  setLoading(false);
                }
              });
            } catch (e) {
              setError("Error reading Excel: " + e.message);
              setCustomers([]);
              setLoading(false);
            }
          };
          reader.readAsArrayBuffer(file);
        }
      }, [files]);

      if (loading) {
        return (
          <div className="card">
            <h3 className="text-xl font-bold mb-4 text-[var(--secondaryMain)]">Top 5 Customers by Volume</h3>
            <div className="flex justify-center items-center h-32">
              <div className="spinner"></div>
            </div>
          </div>
        );
      }

      if (error) {
        return (
          <div className="card">
            <h3 className="text-xl font-bold mb-4 text-[var(--secondaryMain)]">Top 5 Customers by Volume</h3>
            <div className="text-red-400 text-center p-4">
              {error}
            </div>
          </div>
        );
      }

      if (customers.length === 0) {
        return (
          <div className="card">
            <h3 className="text-xl font-bold mb-4 text-[var(--secondaryMain)]">Top 5 Customers by Volume</h3>
            <div className="text-[var(--textSecondary)] text-center p-8">
              Upload an Excel file to see top customers by volume
            </div>
          </div>
        );
      }

      // Find the maximum volume for scaling the bars
      const maxVolume = Math.max(...customers.map(c => c.volume));

      return (
        <div className="card">
          <h3 className="text-xl font-bold mb-6 text-[var(--secondaryMain)]">Top 5 Customers by Volume</h3>
          <div className="space-y-4">
            {customers.map((customer, index) => {
              const barWidth = (customer.volume / maxVolume) * 100;
              return (
                <div key={index} className="flex items-center gap-4">
                  <div className="w-32 text-sm font-medium text-[var(--text)] truncate" title={customer.name}>
                    {customer.name}
                  </div>
                  <div className="flex-1 relative">
                    <div className="w-full bg-[var(--white)] rounded-full h-8 relative overflow-hidden">
                      <div
                        className="bg-[var(--secondaryMain)] h-full rounded-full transition-all duration-700 ease-out"
                        style={{ width: `${barWidth}%` }}
                      ></div>
                      <div className="absolute inset-0 flex items-center justify-end pr-3">
                        <span className="text-sm font-bold text-[var(--neutral)]">
                          {customer.volume.toLocaleString()}
                        </span>
                      </div>
                    </div>
                  </div>
                </div>
              );
            })}
          </div>
        </div>
      );
    }

    // RTO Volume Value function - reads from "DSHB" sheet column H across multiple files
    function RTOVolumeValue({ files }) {
      const [rtoVolume, setRtoVolume] = React.useState(null);
      const [loading, setLoading] = React.useState(false);
      const [error, setError] = React.useState("");
      const [sourceFile, setSourceFile] = React.useState("");
      const target = 2000;

      let variance = undefined;
      let varianceColor = undefined;
      if (rtoVolume !== null && target) {
        const rawVar = ((rtoVolume - target) / target) * 100;
        variance = rawVar.toFixed(1) + '%';
        varianceColor = rawVar >= 0 ? '#1f6a4a' : '#8B0000';
      }

      React.useEffect(() => {
        if (!files || files.length === 0) {
          setRtoVolume(null);
          setError("");
          setSourceFile("");
          return;
        }

        setLoading(true);
        setError("");

        findDataFromSheet(files, 'DSHB', 7) // Column H = index 7
          .then(result => {
            if (result) {
              setRtoVolume(result.sum);
              setSourceFile(result.fileName);
              setError("");
            } else {
              setRtoVolume(null);
              setSourceFile("");
              setError("No 'DSHB' sheet found in uploaded files");
            }
          })
          .catch(err => {
            setError("Error reading files: " + err.message);
            setRtoVolume(null);
            setSourceFile("");
          })
          .finally(() => {
            setLoading(false);
          });
      }, [files]);

      return (
        <KpiCardSingleTone
          label="RTO Volume"
          icon="fa-arrow-rotate-left"
          value={loading ? '...' : (rtoVolume !== null ? rtoVolume.toLocaleString() : undefined)}
        />
      );
    }

    // Place this before the Dashboard function
    // Total Revenue Value function - reads from "DSHB" sheet column AR across multiple files
    function TotalRevenueValue({ files }) {
      const [revenue, setRevenue] = React.useState(null);
      const [loading, setLoading] = React.useState(false);
      const [error, setError] = React.useState("");
      const [sourceFile, setSourceFile] = React.useState("");
      const target = 8855000;

      let variance = undefined;
      let varianceColor = undefined;
      if (revenue !== null && target) {
        const rawVar = ((revenue - target) / target) * 100;
        variance = rawVar.toFixed(1) + '%';
        varianceColor = rawVar >= 0 ? '#1f6a4a' : '#8B0000';
      }

      React.useEffect(() => {
        if (!files || files.length === 0) {
          setRevenue(null);
          setError("");
          setSourceFile("");
          return;
        }

        setLoading(true);
        setError("");

        findDataFromSheet(files, 'DSHB', 43) // Column AR = index 43
          .then(result => {
            if (result) {
              setRevenue(result.sum);
              setSourceFile(result.fileName);
              setError("");
            } else {
              setRevenue(null);
              setSourceFile("");
              setError("No 'DSHB' sheet found in uploaded files");
            }
          })
          .catch(err => {
            setError("Error reading files: " + err.message);
            setRevenue(null);
            setSourceFile("");
          })
          .finally(() => {
            setLoading(false);
          });
      }, [files]);

      return (
        <KpiCardTwoTone
          label="Total Revenue"
          icon="fa-sack-dollar"
          value={loading ? '...' : (revenue !== null ? revenue.toLocaleString() : undefined)}
          target={revenue !== null ? target.toLocaleString() : ''}
          variance={revenue !== null ? <span style={{ color: varianceColor, fontWeight: 800 }}>{variance}</span> : ''}
        />
      );
    }

    // Parcel RPS Value function - reads from column P of "Parcel" sheet (single cell)
    function ParcelRpsValue({ files }) {
      const [parcelRps, setParcelRps] = React.useState(null);
      const [loading, setLoading] = React.useState(false);
      const [error, setError] = React.useState("");
      const target = 15; // Set appropriate target for Parcel RPS
      let variance = undefined;
      let varianceColor = undefined;
      if (parcelRps !== null && target) {
        const rawVar = ((parcelRps - target) / target) * 100;
        variance = rawVar.toFixed(1) + '%';
        varianceColor = rawVar >= 0 ? '#1f6a4a' : '#8B0000';
      }

      React.useEffect(() => {
        if (!files || files.length === 0) {
          setParcelRps(null);
          setError("");
          return;
        }
        const file = files[0];
        setLoading(true);
        setError("");

        function getPFromPapa(results) {
          try {
            let pKey = 'P';
            // Try to find column P in different ways
            const headers = Object.keys(results.data[0] || {});

            // Method 1: Look for exact 'P' column
            if (headers.includes('P')) {
              pKey = 'P';
            } else if (headers[15]) {
              // Method 2: Use index 15 (P = 15th column, 0-indexed)
              pKey = headers[15];
            } else {
              // Method 3: Look for any key that contains 'P'
              pKey = headers.find(h => h.trim().toUpperCase() === 'P') || headers[15] || 'P';
            }

            // Search through all rows for the RPS value
            for (const row of results.data) {
              const val = row[pKey];
              if (val !== undefined && val !== null && val !== "") {
                const cleanVal = val.toString().replace(/,/g, '').trim();
                const num = Number(cleanVal);
                if (!isNaN(num) && num > 0) {
                  setParcelRps(num);
                  setLoading(false);
                  return;
                }
              }
            }

            // If no value found, set to null
            setParcelRps(null);
          } catch (e) {
            setError("Error parsing CSV: " + e.message);
            setParcelRps(null);
          }
          setLoading(false);
        }

        if (file.name.endsWith('.csv')) {
          window.Papa.parse(file, {
            header: true,
            skipEmptyLines: true,
            complete: getPFromPapa,
            error: (err) => {
              setError("Error reading CSV: " + err.message);
              setParcelRps(null);
              setLoading(false);
            }
          });
        } else {
          const reader = new FileReader();
          reader.onload = (evt) => {
            try {
              const data = new Uint8Array(evt.target.result);
              const workbook = window.XLSX.read(data, { type: 'array' });

              // Debug: Log available sheet names
              console.log("Available sheets:", workbook.SheetNames);

              // Try different variations of the sheet name
              let sheet = null;
              const possibleNames = ['Parcel', 'PARCEL', 'parcel', 'Parcels', 'PARCELS', 'parcels'];

              for (const name of possibleNames) {
                if (workbook.Sheets[name]) {
                  sheet = workbook.Sheets[name];
                  console.log("Found Parcel sheet with name:", name);
                  break;
                }
              }

              if (!sheet) {
                setError("No 'Parcel' sheet found. Available sheets: " + workbook.SheetNames.join(', '));
                setParcelRps(null);
                setLoading(false);
                return;
              }

              // Try to read directly from specific cells in column P
              let foundValue = null;

              // Check common cell positions in column P (P1, P2, P3, etc.)
              for (let row = 1; row <= 20; row++) {
                const cellAddress = 'P' + row;
                const cell = sheet[cellAddress];
                if (cell && cell.v !== undefined && cell.v !== null && cell.v !== "") {
                  const val = cell.v;
                  if (typeof val === 'number' && val > 0) {
                    foundValue = val;
                    break;
                  } else if (typeof val === 'string') {
                    const num = Number(val.toString().replace(/,/g, ''));
                    if (!isNaN(num) && num > 0) {
                      foundValue = num;
                      break;
                    }
                  }
                }
              }

              setParcelRps(foundValue);
              setLoading(false);
            } catch (e) {
              setError("Error reading Excel: " + e.message);
              setParcelRps(null);
              setLoading(false);
            }
          };
          reader.readAsArrayBuffer(file);
        }
      }, [files]);

      return (
        <KpiCardTwoTone
          label="Parcel RPS"
          icon="fa-box"
          value={loading ? '...' : (parcelRps !== null ? parcelRps.toFixed(2) : undefined)}
          target={parcelRps !== null ? target.toFixed(2) : ''}
          variance={parcelRps !== null ? <span style={{ color: varianceColor, fontWeight: 800 }}>{variance}</span> : ''}
        />
      );
    }

    // H&B RPS Value function - reads from column P of "HnB" sheet (single cell)
    function HnBRpsValue({ files }) {
      const [hnbRps, setHnbRps] = React.useState(null);
      const [loading, setLoading] = React.useState(false);
      const [error, setError] = React.useState("");
      const target = 12; // Set appropriate target for H&B RPS
      let variance = undefined;
      let varianceColor = undefined;
      if (hnbRps !== null && target) {
        const rawVar = ((hnbRps - target) / target) * 100;
        variance = rawVar.toFixed(1) + '%';
        varianceColor = rawVar >= 0 ? '#1f6a4a' : '#8B0000';
      }

      React.useEffect(() => {
        if (!files || files.length === 0) {
          setHnbRps(null);
          setError("");
          return;
        }
        const file = files[0];
        setLoading(true);
        setError("");

        function getPFromPapa(results) {
          try {
            let pKey = 'P';
            // Try to find column P in different ways
            const headers = Object.keys(results.data[0] || {});

            // Method 1: Look for exact 'P' column
            if (headers.includes('P')) {
              pKey = 'P';
            } else if (headers[15]) {
              // Method 2: Use index 15 (P = 15th column, 0-indexed)
              pKey = headers[15];
            } else {
              // Method 3: Look for any key that contains 'P'
              pKey = headers.find(h => h.trim().toUpperCase() === 'P') || headers[15] || 'P';
            }

            // Search through all rows for the RPS value
            for (const row of results.data) {
              const val = row[pKey];
              if (val !== undefined && val !== null && val !== "") {
                const cleanVal = val.toString().replace(/,/g, '').trim();
                const num = Number(cleanVal);
                if (!isNaN(num) && num > 0) {
                  setHnbRps(num);
                  setLoading(false);
                  return;
                }
              }
            }

            // If no value found, set to null
            setHnbRps(null);
          } catch (e) {
            setError("Error parsing CSV: " + e.message);
            setHnbRps(null);
          }
          setLoading(false);
        }

        if (file.name.endsWith('.csv')) {
          window.Papa.parse(file, {
            header: true,
            skipEmptyLines: true,
            complete: getPFromPapa,
            error: (err) => {
              setError("Error reading CSV: " + err.message);
              setHnbRps(null);
              setLoading(false);
            }
          });
        } else {
          const reader = new FileReader();
          reader.onload = (evt) => {
            try {
              const data = new Uint8Array(evt.target.result);
              const workbook = window.XLSX.read(data, { type: 'array' });

              // Debug: Log available sheet names
              console.log("Available sheets for HnB:", workbook.SheetNames);

              // Try different variations of the sheet name
              let sheet = null;
              const possibleNames = ['HnB', 'H&B', 'HB', 'H and B', 'H & B', 'hnb', 'h&b', 'hb'];

              for (const name of possibleNames) {
                if (workbook.Sheets[name]) {
                  sheet = workbook.Sheets[name];
                  console.log("Found H&B sheet with name:", name);
                  break;
                }
              }

              if (!sheet) {
                setError("No 'H&B' sheet found. Available sheets: " + workbook.SheetNames.join(', '));
                setHnbRps(null);
                setLoading(false);
                return;
              }

              // Try to read directly from specific cells in column P
              let foundValue = null;

              // Check common cell positions in column P (P1, P2, P3, etc.)
              for (let row = 1; row <= 20; row++) {
                const cellAddress = 'P' + row;
                const cell = sheet[cellAddress];
                if (cell && cell.v !== undefined && cell.v !== null && cell.v !== "") {
                  const val = cell.v;
                  if (typeof val === 'number' && val > 0) {
                    foundValue = val;
                    break;
                  } else if (typeof val === 'string') {
                    const num = Number(val.toString().replace(/,/g, ''));
                    if (!isNaN(num) && num > 0) {
                      foundValue = num;
                      break;
                    }
                  }
                }
              }

              setHnbRps(foundValue);
              setLoading(false);
            } catch (e) {
              setError("Error reading Excel: " + e.message);
              setHnbRps(null);
              setLoading(false);
            }
          };
          reader.readAsArrayBuffer(file);
        }
      }, [files]);

      return (
        <KpiCardTwoTone
          label="H&B RPS"
          icon="fa-heart-pulse"
          value={loading ? '...' : (hnbRps !== null ? hnbRps.toFixed(2) : undefined)}
          target={hnbRps !== null ? target.toFixed(2) : ''}
          variance={hnbRps !== null ? <span style={{ color: varianceColor, fontWeight: 800 }}>{variance}</span> : ''}
        />
      );
    }

    // Highest 10 Customers Bar Chart component
    function Highest10CustomersChart({ files }) {
      const [chartData, setChartData] = React.useState([]);
      const [loading, setLoading] = React.useState(false);
      const [error, setError] = React.useState("");
      const chartRef = React.useRef(null);
      const chartInstance = React.useRef(null);

      React.useEffect(() => {
        if (!files || files.length === 0) {
          setChartData([]);
          setError("");
          return;
        }
        const file = files[0];
        setLoading(true);
        setError("");

        function parseCustomerData(results) {
          try {
            const data = [];
            const headers = Object.keys(results.data[0] || {});

            // Find customer name (column C) and total revenue (column N)
            let customerKey = null;
            let totalKey = null;

            // Try by column position: C=2, N=13 (0-indexed)
            for (const key of headers) {
              const upperKey = key.trim().toUpperCase();
              if (upperKey === 'C') customerKey = key;
              if (upperKey === 'N') totalKey = key;
            }

            // Fallback to position-based access
            if (!customerKey && headers[2]) customerKey = headers[2];
            if (!totalKey && headers[13]) totalKey = headers[13];

            // Process each row
            for (let i = 0; i < results.data.length; i++) {
              const row = results.data[i];
              const rowValues = Object.values(row);

              const customer = rowValues[2] || row[customerKey]; // Column C
              const total = rowValues[13] || row[totalKey];      // Column N

              // Only include rows with valid customer names
              if (customer && customer.toString().trim() !== "" &&
                customer.toString().trim().toLowerCase() !== "customer name" &&
                customer.toString().trim().toLowerCase() !== "customer") {

                const parseNum = (val) => {
                  if (val === undefined || val === null || val === "") return 0;
                  const str = val.toString().replace(/,/g, '').trim();
                  const num = Number(str);
                  return isNaN(num) ? 0 : num;
                };

                const totalVal = parseNum(total);

                if (totalVal > 0) {
                  data.push({
                    customer: customer.toString().trim(),
                    revenue: totalVal
                  });
                }
              }
            }

            // Sort by revenue and take top 10
            data.sort((a, b) => b.revenue - a.revenue);
            const top10 = data.slice(0, 10);
            setChartData(top10);
          } catch (e) {
            setError("Error parsing customer data: " + e.message);
            setChartData([]);
          }
          setLoading(false);
        }

        if (file.name.endsWith('.csv')) {
          window.Papa.parse(file, {
            header: true,
            skipEmptyLines: true,
            complete: parseCustomerData,
            error: (err) => {
              setError("Error reading CSV: " + err.message);
              setChartData([]);
              setLoading(false);
            }
          });
        } else {
          const reader = new FileReader();
          reader.onload = (evt) => {
            try {
              const data = new Uint8Array(evt.target.result);
              const workbook = window.XLSX.read(data, { type: 'array' });

              let sheet = null;
              const possibleNames = ['Rev.', 'Rev', 'Revenue', 'REVENUE', 'rev.', 'rev'];

              for (const name of possibleNames) {
                if (workbook.Sheets[name]) {
                  sheet = workbook.Sheets[name];
                  break;
                }
              }

              if (!sheet) {
                setError("No 'Rev.' sheet found. Available sheets: " + workbook.SheetNames.join(', '));
                setChartData([]);
                setLoading(false);
                return;
              }

              const csv = window.XLSX.utils.sheet_to_csv(sheet);
              window.Papa.parse(csv, {
                header: true,
                skipEmptyLines: true,
                complete: parseCustomerData,
                error: (err) => {
                  setError("Error reading Excel: " + err.message);
                  setChartData([]);
                  setLoading(false);
                }
              });
            } catch (e) {
              setError("Error reading Excel: " + e.message);
              setChartData([]);
              setLoading(false);
            }
          };
          reader.readAsArrayBuffer(file);
        }
      }, [files]);

      // Create chart when data changes
      React.useEffect(() => {
        if (chartData.length > 0 && chartRef.current) {
          // Destroy existing chart
          if (chartInstance.current) {
            chartInstance.current.destroy();
          }

          const ctx = chartRef.current.getContext('2d');
          chartInstance.current = new window.Chart(ctx, {
            type: 'bar',
            data: {
              labels: chartData.map(item => item.customer),
              datasets: [{
                label: 'Revenue',
                data: chartData.map(item => item.revenue),
                backgroundColor: '#1f6a4a',
                borderColor: '#184c36',
                borderWidth: 1,
                borderRadius: 4,
                borderSkipped: false,
              }]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                legend: {
                  display: false
                },
                title: {
                  display: false
                },
                tooltip: {
                  backgroundColor: 'rgba(0, 0, 0, 0.8)',
                  titleColor: '#ffffff',
                  bodyColor: '#ffffff',
                  bodyFont: {
                    family: 'Euclid Circular B',
                    weight: 'bold'
                  },
                  padding: 10,
                  cornerRadius: 4,
                  displayColors: false
                }
              },
              scales: {
                y: {
                  beginAtZero: true,
                  ticks: {
                    color: '#184c36',
                    font: {
                      family: 'Euclid Circular B',
                      size: 12,
                      weight: 'bold'
                    },
                    callback: function (value) {
                      return value.toLocaleString();
                    }
                  },
                  grid: {
                    color: 'rgba(31, 106, 74, 0.1)'
                  },
                  title: {
                    display: true,
                    text: 'Sum of Total',
                    color: '#184c36',
                    font: {
                      family: 'Euclid Circular B',
                      size: 14,
                      weight: 'bold'
                    }
                  }
                },
                x: {
                  ticks: {
                    color: '#184c36',
                    maxRotation: 45,
                    minRotation: 45,
                    font: {
                      family: 'Euclid Circular B',
                      size: 12,
                      weight: 'bold'
                    }
                  },
                  grid: {
                    color: 'rgba(31, 106, 74, 0.1)'
                  },
                  title: {
                    display: true,
                    text: 'Customer Name',
                    color: '#184c36',
                    font: {
                      family: 'Euclid Circular B',
                      size: 14,
                      weight: 'bold'
                    }
                  }
                }
              },
              layout: {
                padding: 20
              }
            }
          });
        }

        return () => {
          if (chartInstance.current) {
            chartInstance.current.destroy();
          }
        };
      }, [chartData]);

      if (loading) {
        return (
          <div className="text-center py-8">
            <div className="spinner mx-auto mb-4"></div>
            <p>Loading customer data...</p>
          </div>
        );
      }

      if (error) {
        return (
          <div className="text-center py-8 text-red-400">
            <p>Error: {error}</p>
          </div>
        );
      }

      return (
        <div className="w-full h-96 bg-[var(--white)] border-2 border-[var(--secondaryMain)] rounded-2xl p-6">
          <canvas ref={chartRef} className="w-full h-full"></canvas>
        </div>
      );
    }

    // Top 5 Volume by Customer Chart component - reads from "Rev." sheet columns C (customer) and H (volume)
    function Top5VolumeByCustomerChart({ files }) {
      const [chartData, setChartData] = React.useState([]);
      const [loading, setLoading] = React.useState(false);
      const [error, setError] = React.useState("");
      const chartRef = React.useRef(null);
      const chartInstance = React.useRef(null);

      React.useEffect(() => {
        if (!files || files.length === 0) {
          setChartData([]);
          setError("");
          return;
        }
        const file = files[0];
        setLoading(true);
        setError("");

        function parseVolumeData(results) {
          try {
            const data = [];
            const headers = Object.keys(results.data[0] || {});

            // Find customer name (column C) and volume (column H)
            let customerKey = null;
            let volumeKey = null;

            // Try by column position: C=2, H=7 (0-indexed)
            for (const key of headers) {
              const upperKey = key.trim().toUpperCase();
              if (upperKey === 'C') customerKey = key;
              if (upperKey === 'H') volumeKey = key;
            }

            // Fallback to position-based access
            if (!customerKey && headers[2]) customerKey = headers[2];
            if (!volumeKey && headers[7]) volumeKey = headers[7];

            // Process each row
            for (let i = 0; i < results.data.length; i++) {
              const row = results.data[i];
              const rowValues = Object.values(row);

              const customer = rowValues[2] || row[customerKey]; // Column C
              const volume = rowValues[7] || row[volumeKey];     // Column H

              // Only include rows with valid customer names
              if (customer && customer.toString().trim() !== "" &&
                customer.toString().trim().toLowerCase() !== "customer name" &&
                customer.toString().trim().toLowerCase() !== "customer") {

                const parseNum = (val) => {
                  if (val === undefined || val === null || val === "") return 0;
                  const str = val.toString().replace(/,/g, '').trim();
                  const num = Number(str);
                  return isNaN(num) ? 0 : num;
                };

                const volumeVal = parseNum(volume);

                if (volumeVal > 0) {
                  data.push({
                    customer: customer.toString().trim(),
                    volume: volumeVal
                  });
                }
              }
            }

            // Sort by volume and take top 5
            data.sort((a, b) => b.volume - a.volume);
            const top5 = data.slice(0, 5);
            setChartData(top5);
          } catch (e) {
            setError("Error parsing volume data: " + e.message);
            setChartData([]);
          }
          setLoading(false);
        }

        if (file.name.endsWith('.csv')) {
          window.Papa.parse(file, {
            header: true,
            skipEmptyLines: true,
            complete: parseVolumeData,
            error: (err) => {
              setError("Error reading CSV: " + err.message);
              setChartData([]);
              setLoading(false);
            }
          });
        } else {
          const reader = new FileReader();
          reader.onload = (evt) => {
            try {
              const data = new Uint8Array(evt.target.result);
              const workbook = window.XLSX.read(data, { type: 'array' });

              let sheet = null;
              const possibleNames = ['Rev.', 'Rev', 'Revenue', 'REVENUE', 'rev.', 'rev'];

              for (const name of possibleNames) {
                if (workbook.Sheets[name]) {
                  sheet = workbook.Sheets[name];
                  break;
                }
              }

              if (!sheet) {
                setError("No 'Rev.' sheet found. Available sheets: " + workbook.SheetNames.join(', '));
                setChartData([]);
                setLoading(false);
                return;
              }

              const csv = window.XLSX.utils.sheet_to_csv(sheet);
              window.Papa.parse(csv, {
                header: true,
                skipEmptyLines: true,
                complete: parseVolumeData,
                error: (err) => {
                  setError("Error reading Excel: " + err.message);
                  setChartData([]);
                  setLoading(false);
                }
              });
            } catch (e) {
              setError("Error reading Excel: " + e.message);
              setChartData([]);
              setLoading(false);
            }
          };
          reader.readAsArrayBuffer(file);
        }
      }, [files]);

      // Create chart when data changes
      React.useEffect(() => {
        if (chartData.length > 0 && chartRef.current) {
          // Destroy existing chart
          if (chartInstance.current) {
            chartInstance.current.destroy();
          }

          const ctx = chartRef.current.getContext('2d');
          chartInstance.current = new window.Chart(ctx, {
            type: 'bar',
            data: {
              labels: chartData.map(item => item.customer),
              datasets: [{
                label: 'Volume',
                data: chartData.map(item => item.volume),
                backgroundColor: '#1f6a4a',
                borderColor: '#184c36',
                borderWidth: 1,
                borderRadius: 4,
                borderSkipped: false,
              }]
            },
            options: {
              indexAxis: 'y', // This makes it horizontal
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                legend: {
                  display: false
                },
                title: {
                  display: false
                },
                tooltip: {
                  backgroundColor: 'rgba(0, 0, 0, 0.8)',
                  titleColor: '#ffffff',
                  bodyColor: '#ffffff',
                  bodyFont: {
                    family: 'Euclid Circular B',
                    weight: 'bold'
                  },
                  padding: 10,
                  cornerRadius: 4,
                  displayColors: false
                }
              },
              scales: {
                y: {
                  ticks: {
                    color: '#184c36',
                    font: {
                      family: 'Euclid Circular B',
                      size: 12,
                      weight: 'bold'
                    }
                  },
                  grid: {
                    color: 'rgba(31, 106, 74, 0.1)'
                  },
                  title: {
                    display: true,
                    text: 'Customer Name',
                    color: '#184c36',
                    font: {
                      family: 'Euclid Circular B',
                      size: 14,
                      weight: 'bold'
                    }
                  }
                },
                x: {
                  beginAtZero: true,
                  ticks: {
                    color: '#184c36',
                    font: {
                      family: 'Euclid Circular B',
                      size: 12,
                      weight: 'bold'
                    },
                    callback: function (value) {
                      return value.toLocaleString();
                    }
                  },
                  grid: {
                    color: 'rgba(31, 106, 74, 0.1)'
                  },
                  title: {
                    display: true,
                    text: 'Delivery Count',
                    color: '#184c36',
                    font: {
                      family: 'Euclid Circular B',
                      size: 14,
                      weight: 'bold'
                    }
                  }
                }
              },
              layout: {
                padding: 20
              }
            }
          });
        }

        return () => {
          if (chartInstance.current) {
            chartInstance.current.destroy();
          }
        };
      }, [chartData]);

      if (loading) {
        return (
          <div className="text-center py-8">
            <div className="spinner mx-auto mb-4"></div>
            <p>Loading volume data...</p>
          </div>
        );
      }

      if (error) {
        return (
          <div className="text-center py-8 text-red-400">
            <p>Error: {error}</p>
          </div>
        );
      }

      return (
        <div className="w-full h-96 bg-[var(--white)] border-2 border-[var(--secondaryMain)] rounded-2xl p-6">
          <canvas ref={chartRef} className="w-full h-full"></canvas>
        </div>
      );
    }

    // Revenue per Tier component - reads from "Rev." sheet columns C,J,K,L,M,N
    function RevenuePerTierTable({ files }) {
      const [revenueData, setRevenueData] = React.useState([]);
      const [loading, setLoading] = React.useState(false);
      const [error, setError] = React.useState("");
      const [sortConfig, setSortConfig] = React.useState({ key: 'total', direction: 'desc' });

      // Sorting function
      const handleSort = (key) => {
        let direction = 'asc';
        if (sortConfig.key === key && sortConfig.direction === 'asc') {
          direction = 'desc';
        }
        setSortConfig({ key, direction });
      };

      // Sort the data based on current sort config
      const sortedData = React.useMemo(() => {
        if (!revenueData.length) return [];

        const sorted = [...revenueData].sort((a, b) => {
          if (sortConfig.key === 'customer') {
            // String sorting for customer names
            const aVal = a[sortConfig.key].toLowerCase();
            const bVal = b[sortConfig.key].toLowerCase();
            if (sortConfig.direction === 'asc') {
              return aVal < bVal ? -1 : aVal > bVal ? 1 : 0;
            } else {
              return aVal > bVal ? -1 : aVal < bVal ? 1 : 0;
            }
          } else {
            // Numeric sorting for tier values
            const aVal = a[sortConfig.key];
            const bVal = b[sortConfig.key];
            if (sortConfig.direction === 'asc') {
              return aVal - bVal;
            } else {
              return bVal - aVal;
            }
          }
        });

        return sorted;
      }, [revenueData, sortConfig]);



      // Get sort indicator for column headers
      const getSortIndicator = (columnKey) => {
        if (sortConfig.key !== columnKey) {
          return ''; // No indicator when not sorted
        }
        return sortConfig.direction === 'asc' ? ' ' : ' ';
      };

      React.useEffect(() => {
        if (!files || files.length === 0) {
          setRevenueData([]);
          setError("");
          return;
        }
        const file = files[0];
        setLoading(true);
        setError("");

        function parseRevenueData(results) {
          try {
            const data = [];
            const headers = Object.keys(results.data[0] || {});

            // Debug: Log headers to understand the structure
            console.log("Headers found:", headers);

            // Find the column keys - try multiple approaches
            let customerKey = null;
            let tier0Key = null;
            let tier1Key = null;
            let tier2Key = null;
            let tier3Key = null;
            let totalKey = null;

            // Method 1: Try exact column letters
            for (const key of headers) {
              const upperKey = key.trim().toUpperCase();
              if (upperKey === 'C') customerKey = key;
              if (upperKey === 'J') tier0Key = key;
              if (upperKey === 'K') tier1Key = key;
              if (upperKey === 'L') tier2Key = key;
              if (upperKey === 'M') tier3Key = key;
              if (upperKey === 'N') totalKey = key;
            }

            // Method 2: Try by index if exact letters not found
            if (!customerKey && headers[2]) customerKey = headers[2];
            if (!tier0Key && headers[9]) tier0Key = headers[9];
            if (!tier1Key && headers[10]) tier1Key = headers[10];
            if (!tier2Key && headers[11]) tier2Key = headers[11];
            if (!tier3Key && headers[12]) tier3Key = headers[12];
            if (!totalKey && headers[13]) totalKey = headers[13];

            // Method 3: Try by content matching
            for (const key of headers) {
              const upperKey = key.trim().toUpperCase();
              if (!customerKey && (upperKey.includes('CUSTOMER') || upperKey.includes('NAME'))) customerKey = key;
              if (!tier0Key && upperKey.includes('TIER 0')) tier0Key = key;
              if (!tier1Key && upperKey.includes('TIER 1')) tier1Key = key;
              if (!tier2Key && upperKey.includes('TIER 2')) tier2Key = key;
              if (!tier3Key && upperKey.includes('TIER 3')) tier3Key = key;
              if (!totalKey && (upperKey.includes('TOTAL') || upperKey.includes('SUM'))) totalKey = key;
            }

            console.log("Column mappings:", { customerKey, tier0Key, tier1Key, tier2Key, tier3Key, totalKey });

            // Process each row
            for (let i = 0; i < results.data.length; i++) {
              const row = results.data[i];

              // Get all values as array to access by position
              const rowValues = Object.values(row);

              // Access by column position (0-indexed): C=2, J=9, K=10, L=11, M=12, N=13
              const customer = rowValues[2] || row[customerKey]; // Column C
              const tier0 = rowValues[9] || row[tier0Key];       // Column J
              const tier1 = rowValues[10] || row[tier1Key];      // Column K
              const tier2 = rowValues[11] || row[tier2Key];      // Column L
              const tier3 = rowValues[12] || row[tier3Key];      // Column M
              const total = rowValues[13] || row[totalKey];      // Column N

              // Debug first few rows
              if (i < 3) {
                console.log(`Row ${i}:`, { customer, tier0, tier1, tier2, tier3, total });
              }

              // Only include rows with valid customer names (skip headers)
              if (customer && customer.toString().trim() !== "" &&
                customer.toString().trim().toLowerCase() !== "customer name" &&
                customer.toString().trim().toLowerCase() !== "customer") {

                const parseNum = (val) => {
                  if (val === undefined || val === null || val === "") return 0;
                  const str = val.toString().replace(/,/g, '').trim();
                  const num = Number(str);
                  return isNaN(num) ? 0 : num;
                };

                const tier0Val = parseNum(tier0);
                const tier1Val = parseNum(tier1);
                const tier2Val = parseNum(tier2);
                const tier3Val = parseNum(tier3);
                const totalVal = parseNum(total) || (tier0Val + tier1Val + tier2Val + tier3Val);

                data.push({
                  customer: customer.toString().trim(),
                  tier0: tier0Val,
                  tier1: tier1Val,
                  tier2: tier2Val,
                  tier3: tier3Val,
                  total: totalVal
                });
              }
            }

            console.log("Total customers parsed:", data.length);

            // Sort by total revenue in descending order to get highest first
            data.sort((a, b) => b.total - a.total);

            // Show all customers (sorted by revenue)
            setRevenueData(data);
          } catch (e) {
            setError("Error parsing revenue data: " + e.message);
            setRevenueData([]);
          }
          setLoading(false);
        }

        if (file.name.endsWith('.csv')) {
          window.Papa.parse(file, {
            header: true,
            skipEmptyLines: true,
            complete: parseRevenueData,
            error: (err) => {
              setError("Error reading CSV: " + err.message);
              setRevenueData([]);
              setLoading(false);
            }
          });
        } else {
          const reader = new FileReader();
          reader.onload = (evt) => {
            try {
              const data = new Uint8Array(evt.target.result);
              const workbook = window.XLSX.read(data, { type: 'array' });

              // Try different variations of the sheet name
              let sheet = null;
              const possibleNames = ['Rev.', 'Rev', 'Revenue', 'REVENUE', 'rev.', 'rev'];

              for (const name of possibleNames) {
                if (workbook.Sheets[name]) {
                  sheet = workbook.Sheets[name];
                  console.log("Found Revenue sheet with name:", name);
                  break;
                }
              }

              if (!sheet) {
                setError("No 'Rev.' sheet found. Available sheets: " + workbook.SheetNames.join(', '));
                setRevenueData([]);
                setLoading(false);
                return;
              }

              const csv = window.XLSX.utils.sheet_to_csv(sheet);
              window.Papa.parse(csv, {
                header: true,
                skipEmptyLines: true,
                complete: parseRevenueData,
                error: (err) => {
                  setError("Error reading Excel: " + err.message);
                  setRevenueData([]);
                  setLoading(false);
                }
              });
            } catch (e) {
              setError("Error reading Excel: " + e.message);
              setRevenueData([]);
              setLoading(false);
            }
          };
          reader.readAsArrayBuffer(file);
        }
      }, [files]);

      if (loading) {
        return (
          <div className="text-center py-8">
            <div className="spinner mx-auto mb-4"></div>
            <p>Loading revenue data...</p>
          </div>
        );
      }

      if (error) {
        return (
          <div className="text-center py-8 text-red-400">
            <p>Error: {error}</p>
          </div>
        );
      }

      return (
        <div className="overflow-x-auto">
          <div className="max-h-80 overflow-y-auto">
            <table className="min-w-full text-left text-[var(--text)] border-separate border-spacing-y-2">
              <thead className="sticky top-0 z-10">
                <tr>
                  <th
                    className="px-6 py-3 font-bold text-base bg-[rgba(31,106,74,0.1)] border-b-2 border-[var(--secondaryMain)] rounded-tl-lg cursor-pointer hover:bg-[var(--secondaryMain)] hover:text-[var(--white)] transition-colors select-none"
                    onClick={() => handleSort('customer')}
                  >
                    Customers{getSortIndicator('customer')}
                  </th>
                  <th
                    className="px-6 py-3 font-bold text-base bg-[rgba(31,106,74,0.1)] border-b-2 border-[var(--secondaryMain)] cursor-pointer hover:bg-[var(--secondaryMain)] hover:text-[var(--white)] transition-colors select-none"
                    onClick={() => handleSort('tier0')}
                  >
                    Sum of Tier 0{getSortIndicator('tier0')}
                  </th>
                  <th
                    className="px-6 py-3 font-bold text-base bg-[rgba(31,106,74,0.1)] border-b-2 border-[var(--secondaryMain)] cursor-pointer hover:bg-[var(--secondaryMain)] hover:text-[var(--white)] transition-colors select-none"
                    onClick={() => handleSort('tier1')}
                  >
                    Sum of Tier 1{getSortIndicator('tier1')}
                  </th>
                  <th
                    className="px-6 py-3 font-bold text-base bg-[rgba(31,106,74,0.1)] border-b-2 border-[var(--secondaryMain)] cursor-pointer hover:bg-[var(--secondaryMain)] hover:text-[var(--white)] transition-colors select-none"
                    onClick={() => handleSort('tier2')}
                  >
                    Sum of Tier 2{getSortIndicator('tier2')}
                  </th>
                  <th
                    className="px-6 py-3 font-bold text-base bg-[rgba(31,106,74,0.1)] border-b-2 border-[var(--secondaryMain)] cursor-pointer hover:bg-[var(--secondaryMain)] hover:text-[var(--white)] transition-colors select-none"
                    onClick={() => handleSort('tier3')}
                  >
                    Sum of Tier 3{getSortIndicator('tier3')}
                  </th>
                  <th
                    className="px-6 py-3 font-bold text-base bg-[rgba(31,106,74,0.1)] border-b-2 border-[var(--secondaryMain)] rounded-tr-lg cursor-pointer hover:bg-[var(--secondaryMain)] hover:text-[var(--white)] transition-colors select-none"
                    onClick={() => handleSort('total')}
                  >
                    Sum of Total{getSortIndicator('total')}
                  </th>
                </tr>
              </thead>
              <tbody>
                {revenueData.length === 0 ? (
                  <tr>
                    <td colSpan="6" className="px-6 py-8 text-center text-[var(--textSecondary)]">
                      {files && files.length > 0 ? "No revenue data found" : "Upload a file to view revenue data"}
                    </td>
                  </tr>
                ) : (
                  sortedData.map((row, index) => (
                    <tr key={index} className="bg-[var(--white)] hover:bg-[var(--secondaryMain)] hover:text-[var(--neutral)] transition-colors">
                      <td className="px-6 py-4 text-[var(--text)] font-medium">{row.customer}</td>
                      <td className="px-6 py-4 text-[var(--primaryMain)]">{row.tier0 > 0 ? row.tier0.toLocaleString() : '0'}</td>
                      <td className="px-6 py-4 text-[var(--primaryMain)]">{row.tier1 > 0 ? row.tier1.toLocaleString() : '0'}</td>
                      <td className="px-6 py-4 text-[var(--primaryMain)]">{row.tier2 > 0 ? row.tier2.toLocaleString() : '0'}</td>
                      <td className="px-6 py-4 text-[var(--primaryMain)]">{row.tier3 > 0 ? row.tier3.toLocaleString() : '0'}</td>
                      <td className="px-6 py-4 text-[var(--secondaryMain)] font-bold">{row.total > 0 ? row.total.toLocaleString() : '0'}</td>
                    </tr>
                  ))
                )}
              </tbody>
            </table>
          </div>
        </div>
      );
    }

    // ... existing code ...
    // Place this before the Dashboard function
    function RpsValue({ files }) {
      const [delivered, setDelivered] = React.useState(null);
      const [revenue, setRevenue] = React.useState(null);
      const [loading, setLoading] = React.useState(false);
      const [error, setError] = React.useState("");
      const target = 14.94;
      let rps = null;
      let variance = undefined;
      let varianceColor = undefined;
      if (delivered !== null && revenue !== null && delivered !== 0) {
        rps = revenue / delivered;
        const rawVar = ((rps - target) / target) * 100;
        variance = rawVar.toFixed(1) + '%';
        varianceColor = rawVar >= 0 ? '#1f6a4a' : '#8B0000 ';
      }

      React.useEffect(() => {
        if (!files || files.length === 0) {
          setDelivered(null);
          setRevenue(null);
          setError("");
          return;
        }
        const file = files[0];
        setLoading(true);
        setError("");

        let deliveredVal = null;
        let revenueVal = null;
        let finished = 0;
        function checkDone() {
          finished++;
          if (finished === 2) setLoading(false);
        }
        function sumGFromPapa(results) {
          try {
            let gKey = Object.keys(results.data[0])[7]; // H = 7 (0-indexed)
            for (const key of Object.keys(results.data[0])) {
              if (key.trim().toUpperCase() === 'H') gKey = key;
            }
            let sum = 0;
            for (const row of results.data) {
              const val = row[gKey];
              if (val !== undefined && val !== null && val !== "") {
                const num = Number(val.toString().replace(/,/g, ''));
                if (!isNaN(num)) sum += num;
              }
            }
            deliveredVal = sum;
            setDelivered(sum);
            checkDone();
          } catch (e) {
            setError("Error parsing CSV: " + e.message);
            setDelivered(null);
            checkDone();
          }
        }
        function sumAQFromPapa(results) {
          try {
            let aqKey = Object.keys(results.data[0])[43]; // AQ = 42 (0-indexed)
            for (const key of Object.keys(results.data[0])) {
              if (key.trim().toUpperCase() === 'AR') aqKey = key;
            }
            let sum = 0;
            for (const row of results.data) {
              const val = row[aqKey];
              if (val !== undefined && val !== null && val !== "") {
                const num = Number(val.toString().replace(/,/g, ''));
                if (!isNaN(num)) sum += num;
              }
            }
            revenueVal = sum;
            setRevenue(sum);
            checkDone();
          } catch (e) {
            setError("Error parsing CSV: " + e.message);
            setRevenue(null);
            checkDone();
          }
        }
        if (file.name.endsWith('.csv')) {
          window.Papa.parse(file, {
            header: true,
            skipEmptyLines: true,
            complete: sumGFromPapa,
            error: (err) => {
              setError("Error reading CSV: " + err.message);
              setDelivered(null);
              checkDone();
            }
          });
          window.Papa.parse(file, {
            header: true,
            skipEmptyLines: true,
            complete: sumAQFromPapa,
            error: (err) => {
              setError("Error reading CSV: " + err.message);
              setRevenue(null);
              checkDone();
            }
          });
        } else {
          const reader = new FileReader();
          reader.onload = (evt) => {
            try {
              const data = new Uint8Array(evt.target.result);
              const workbook = window.XLSX.read(data, { type: 'array' });
              const sheet = workbook.Sheets['DSHB'];
              if (!sheet) {
                setError("No 'DSHB' sheet found.");
                setDelivered(null);
                setRevenue(null);
                setLoading(false);
                return;
              }
              const csv = window.XLSX.utils.sheet_to_csv(sheet);
              window.Papa.parse(csv, {
                header: true,
                skipEmptyLines: true,
                complete: sumGFromPapa,
                error: (err) => {
                  setError("Error reading Excel: " + err.message);
                  setDelivered(null);
                  checkDone();
                }
              });
              window.Papa.parse(csv, {
                header: true,
                skipEmptyLines: true,
                complete: sumAQFromPapa,
                error: (err) => {
                  setError("Error reading Excel: " + err.message);
                  setRevenue(null);
                  checkDone();
                }
              });
            } catch (e) {
              setError("Error reading Excel: " + e.message);
              setDelivered(null);
              setRevenue(null);
              setLoading(false);
            }
          };
          reader.readAsArrayBuffer(file);
        }
      }, [files]);

      return (
        <KpiCardTwoTone
          label="RPS"
          icon="fa-gauge"
          value={loading ? '...' : (rps !== null ? rps.toLocaleString(undefined, { maximumFractionDigits: 2 }) : undefined)}
          target={rps !== null ? target.toLocaleString() : ''}
          variance={rps !== null ? <span style={{ color: varianceColor, fontWeight: 800 }}>{variance}</span> : ''}
        />
      );
    }
    // ... existing code ...
    // In the Overview tab, replace the static RPS card with <RpsValue files={files} />
    // ... existing code ...

    function Dashboard() {
      const [selectedTab, setSelectedTab] = React.useState('home');
      // Shared uploaded files state
      const [files, setFiles] = React.useState([]);

      React.useEffect(() => {
        if (selectedTab !== 'overview') return;
        // Clean up previous charts if any
        const chartIds = [
          ...Array(6).fill().map((_, i) => `gauge-stage-${i}`),
          ...Array(6).fill().map((_, i) => `gauge-lastmile-${i}`)
        ];
        chartIds.forEach(id => {
          const el = document.getElementById(id);
          if (el && el._chartInstance) {
            el._chartInstance.destroy();
            el._chartInstance = null;
          }
        });
        // Helper to create a gauge chart
        function createGaugeChart(ctx, value, color, el) {
          const chart = new window.Chart(ctx, {
            type: 'doughnut',
            data: {
              datasets: [{
                data: [value, 100 - value, 100],
                backgroundColor: [color, '#eee', 'transparent'],
                borderWidth: 0,
                cutout: '80%',
                circumference: 180,
                rotation: 270,
              }],
            },
            options: {
              plugins: { legend: { display: false } },
              tooltips: { enabled: false },
              responsive: false,
            },
          });
          el._chartInstance = chart;
        }
        // Stage-specific Costs
        [60, 80, 40, 70, 30, 100].forEach((val, i) => {
          const el = document.getElementById(`gauge-stage-${i}`);
          if (el) {
            const ctx = el.getContext('2d');
            createGaugeChart(ctx, val, '#1f6a4a', el);
          }
        });
        // Last Mile Transportation Costs
        [60, 80, 40, 70, 30, 100].forEach((val, i) => {
          const el = document.getElementById(`gauge-lastmile-${i}`);
          if (el) {
            const ctx = el.getContext('2d');
            createGaugeChart(ctx, val, '#ff9d18', el);
          }
        });
      }, [selectedTab]);

      React.useEffect(() => {
        if (selectedTab !== 'revenue') return;
        // Get computed color values for palette
        const rootStyle = getComputedStyle(document.documentElement);
        const orange = rootStyle.getPropertyValue('--secondaryMain').trim() || '#ff9d18';
        const orangeLight = rootStyle.getPropertyValue('--textSecondary').trim() || '#ffd8a3';
        const fontFamily = `'Euclid Circular B', 'Inter', 'sans-serif'`;
        // Clean up previous charts if any
        const highestCustomersEl = document.getElementById('highest-customers-bar');
        const volumeByCustomerEl = document.getElementById('volume-by-customer-bar');
        if (highestCustomersEl && highestCustomersEl._chartInstance) {
          highestCustomersEl._chartInstance.destroy();
          highestCustomersEl._chartInstance = null;
        }
        if (volumeByCustomerEl && volumeByCustomerEl._chartInstance) {
          volumeByCustomerEl._chartInstance.destroy();
          volumeByCustomerEl._chartInstance = null;
        }
        // Highest 10 Customers (vertical bar)
        if (highestCustomersEl) {
          const ctx = highestCustomersEl.getContext('2d');
          const chart = new window.Chart(ctx, {
            type: 'bar',
            data: {
              labels: ['DKHOON EMIRATES', 'Amazon', 'Amazon XL', 'DHL', 'BRANDS FOR LESS', 'APG', 'LG ELECTRON...', 'SQUAT WOLF', 'SACO', 'ZODE'],
              datasets: [{
                label: 'Sum of Total',
                data: [660000, 630000, 600000, 550000, 390000, 360000, 270000, 180000, 160000, 150000],
                backgroundColor: orange,
                hoverBackgroundColor: orangeLight,
                borderRadius: 8,
                maxBarThickness: 48,
              }],
            },
            options: {
              plugins: {
                legend: { display: false },
                tooltip: {
                  callbacks: {
                    label: ctx => `${(ctx.raw / 1000000).toFixed(2)}M`
                  },
                  titleFont: { family: fontFamily },
                  bodyFont: { family: fontFamily },
                }
              },
              scales: {
                x: {
                  ticks: { color: orange, font: { weight: 'bold', family: fontFamily } },
                  grid: { color: 'rgba(31,106,74,0.15)' },
                  title: { display: true, text: 'Customer Name', color: orange, font: { weight: 'bold', family: fontFamily } }
                },
                y: {
                  ticks: {
                    color: orange,
                    font: { family: fontFamily },
                    callback: v => v >= 1000000 ? (v / 1000000).toFixed(1) + 'M' : v
                  },
                  grid: { color: 'rgba(31,106,74,0.15)' },
                  title: { display: true, text: 'Sum of Total', color: orange, font: { weight: 'bold', family: fontFamily } }
                }
              },
              font: { family: fontFamily }
            }
          });
          highestCustomersEl._chartInstance = chart;
        }
        // Volume by Customer (horizontal bar)
        if (volumeByCustomerEl) {
          const ctx = volumeByCustomerEl.getContext('2d');
          const chart = new window.Chart(ctx, {
            type: 'bar',
            data: {
              labels: ['Al Dhkel Oud', 'Al Ghanem Electronics', 'Al Rajihi First Store', 'Aldo', 'Alesaie Electronics', 'Alesaie Kids'],
              datasets: [{
                label: 'Delivery Count',
                data: [300, 200, 100, 600, 200, 0],
                backgroundColor: orange,
                hoverBackgroundColor: orangeLight,
                borderRadius: 8,
                maxBarThickness: 32,
              }],
            },
            options: {
              indexAxis: 'y',
              plugins: {
                legend: { display: false },
                tooltip: {
                  callbacks: {
                    label: ctx => ctx.raw + 'K'
                  },
                  titleFont: { family: fontFamily },
                  bodyFont: { family: fontFamily },
                }
              },
              scales: {
                x: {
                  ticks: { color: orange, font: { weight: 'bold', family: fontFamily } },
                  grid: { color: 'rgba(31,106,74,0.15)' },
                  title: { display: true, text: 'Delivery Count', color: orange, font: { weight: 'bold', family: fontFamily } }
                },
                y: {
                  ticks: { color: orange, font: { weight: 'bold', family: fontFamily } },
                  grid: { color: 'rgba(31,106,74,0.15)' },
                  title: { display: true, text: 'Customer Names', color: orange, font: { weight: 'bold', family: fontFamily } }
                }
              },
              font: { family: fontFamily }
            }
          });
          volumeByCustomerEl._chartInstance = chart;
        }
        // Clean up on unmount/tab change
        return () => {
          if (highestCustomersEl && highestCustomersEl._chartInstance) highestCustomersEl._chartInstance.destroy();
          if (volumeByCustomerEl && volumeByCustomerEl._chartInstance) volumeByCustomerEl._chartInstance.destroy();
        };
      }, [selectedTab]);

      React.useEffect(() => {
        if (selectedTab !== 'firstmile') return;
        // Get computed color values for palette
        const rootStyle = getComputedStyle(document.documentElement);
        const orange = rootStyle.getPropertyValue('--secondaryMain').trim() || '#ff9d18';
        const orangeFill = 'rgba(255,157,24,0.15)';
        const green = rootStyle.getPropertyValue('--primaryMain').trim() || '#1f6a4a';
        const fontFamily = `'Euclid Circular B', 'Inter', 'sans-serif'`;
        // Clean up previous chart if any
        const costChartEl = document.getElementById('firstmile-cost-chart');
        if (costChartEl && costChartEl._chartInstance) {
          costChartEl._chartInstance.destroy();
          costChartEl._chartInstance = null;
        }
        const cpsChartEl = document.getElementById('firstmile-cps-chart');
        if (cpsChartEl && cpsChartEl._chartInstance) {
          cpsChartEl._chartInstance.destroy();
          cpsChartEl._chartInstance = null;
        }
        const volumeChartEl = document.getElementById('firstmile-volume-chart');
        if (volumeChartEl && volumeChartEl._chartInstance) {
          volumeChartEl._chartInstance.destroy();
          volumeChartEl._chartInstance = null;
        }
        // --- Sample Data for the three charts ---
        const labels = [
          'May 2025', '', '', '', '', '', '', '', '', '', 'Jun 2025', '', '', '', '', '', '', '', '', '', 'Jun 22'
        ];
        const costData = [971, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 971];
        const cpsData = [3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 971, 65];
        const volumeData = [0, 0, 0, 0, 0, 1200, 2300, 400, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1100];
        function makeChart(ctx, label, data, yLabel) {
          return new window.Chart(ctx, {
            type: 'line',
            data: {
              labels,
              datasets: [{
                label,
                data,
                fill: true,
                backgroundColor: orangeFill,
                borderColor: orange,
                borderWidth: 3,
                pointBackgroundColor: green,
                pointBorderColor: orange,
                pointRadius: 4,
                pointHoverRadius: 6,
                tension: 0.3,
              }]
            },
            options: {
              responsive: true,
              plugins: {
                legend: { display: false },
                tooltip: {
                  callbacks: {
                    label: ctx => `${yLabel}: ${ctx.parsed.y}`
                  },
                  backgroundColor: '#222',
                  titleColor: '#fff',
                  bodyColor: '#fff',
                  borderColor: '#fff',
                  borderWidth: 1,
                }
              },
              scales: {
                x: {
                  grid: { color: '#295c47', drawOnChartArea: false },
                  ticks: { color: '#fff', font: { family: fontFamily } }
                },
                y: {
                  beginAtZero: true,
                  grid: { color: '#295c47' },
                  ticks: { color: '#fff', font: { family: fontFamily } }
                }
              }
            }
          });
        }
        // Render the three charts
        if (costChartEl) {
          costChartEl._chartInstance = makeChart(
            costChartEl.getContext('2d'),
            'Total FM Cost',
            costData,
            'Total FM Cost'
          );
        }
        if (cpsChartEl) {
          cpsChartEl._chartInstance = makeChart(
            cpsChartEl.getContext('2d'),
            'FM CPS',
            cpsData,
            'FM CPS'
          );
        }
        if (volumeChartEl) {
          volumeChartEl._chartInstance = makeChart(
            volumeChartEl.getContext('2d'),
            'Sum of First Mile V.',
            volumeData,
            'Sum of First Mile V.'
          );
        }
        // ... existing code ...
      }, [selectedTab]);

      React.useEffect(() => {
        if (selectedTab !== 'firstmile') return;
        // Get computed color values for palette
        const rootStyle = getComputedStyle(document.documentElement);
        const orange = rootStyle.getPropertyValue('--secondaryMain').trim() || '#ff9d18';
        const orangeFill = 'rgba(255,157,24,0.15)';
        const green = rootStyle.getPropertyValue('--primaryMain').trim() || '#1f6a4a';
        const fontFamily = `'Euclid Circular B', 'Inter', 'sans-serif'`;
        // Clean up previous chart if any
        // ... existing code ...
        // --- First Mile Cost per Hub (bar and pie) and Volumes per Hub (bar) ---
        const hubBarEl = document.getElementById('firstmile-cost-hub-bar');
        if (hubBarEl && hubBarEl._chartInstance) {
          hubBarEl._chartInstance.destroy();
          hubBarEl._chartInstance = null;
        }
        const hubPieEl = document.getElementById('firstmile-cost-hub-pie');
        if (hubPieEl && hubPieEl._chartInstance) {
          hubPieEl._chartInstance.destroy();
          hubPieEl._chartInstance = null;
        }
        const hubVolumeBarEl = document.getElementById('firstmile-volume-hub-bar');
        if (hubVolumeBarEl && hubVolumeBarEl._chartInstance) {
          hubVolumeBarEl._chartInstance.destroy();
          hubVolumeBarEl._chartInstance = null;
        }
        // Sample data for hub charts
        const hubLabels = ['RUH', 'JED', 'DMM', 'MED', 'KAM', 'QAS', 'MAK'];
        const hubCostData = [50500, 0, 0, 0, 0, 0, 0];
        const hubPieColors = [orange, green, '#00bcd4', '#616161', '#8bc34a', '#ffd8a3', '#e0e0e0'];
        const hubVolumeData = [16400, 5100, 3600, 1600, 900, 800, 0];
        // First Mile Cost per Hub - Bar
        if (hubBarEl) {
          hubBarEl._chartInstance = new window.Chart(hubBarEl.getContext('2d'), {
            type: 'bar',
            data: {
              labels: hubLabels.map((l, i) => `Sum of ${l}`),
              datasets: [{
                label: 'Sum of Cost',
                data: hubCostData,
                backgroundColor: hubCostData.map(() => orange),
                borderRadius: 6,
                maxBarThickness: 32,
              }],
            },
            options: {
              indexAxis: 'y',
              plugins: {
                legend: { display: false },
                tooltip: {
                  callbacks: {
                    label: ctx => ctx.parsed.x.toLocaleString()
                  },
                  backgroundColor: '#222',
                  titleColor: '#fff',
                  bodyColor: '#fff',
                  borderColor: '#fff',
                  borderWidth: 1,
                }
              },
              scales: {
                x: {
                  ticks: { color: '#fff', font: { family: fontFamily } },
                  grid: { color: '#295c47' },
                  title: { display: true, text: '', color: '#fff', font: { weight: 'bold', family: fontFamily } }
                },
                y: {
                  ticks: { color: '#fff', font: { family: fontFamily } },
                  grid: { color: '#295c47' },
                  title: { display: true, text: '', color: '#fff', font: { weight: 'bold', family: fontFamily } }
                }
              },
              font: { family: fontFamily },
              responsive: true,
              maintainAspectRatio: false,
            }
          });
        }
        // First Mile Cost per Hub - Pie
        if (hubPieEl) {
          hubPieEl._chartInstance = new window.Chart(hubPieEl.getContext('2d'), {
            type: 'pie',
            data: {
              labels: hubLabels.map((l, i) => `Sum of ${l}`),
              datasets: [{
                label: 'Sum of Cost',
                data: hubCostData,
                backgroundColor: hubPieColors,
                borderWidth: 1,
              }],
            },
            options: {
              plugins: {
                legend: { display: true, position: 'right', labels: { color: '#fff', font: { family: fontFamily } } },
                tooltip: {
                  callbacks: {
                    label: ctx => `${ctx.label}: ${ctx.parsed.toLocaleString()} (${ctx.parsed > 0 ? '100%' : '0%'})`
                  },
                  backgroundColor: '#222',
                  titleColor: '#fff',
                  bodyColor: '#fff',
                  borderColor: '#fff',
                  borderWidth: 1,
                }
              },
              font: { family: fontFamily },
              responsive: true,
              maintainAspectRatio: false,
            }
          });
        }
        // First Mile Volumes per Hub - Bar
        if (hubVolumeBarEl) {
          hubVolumeBarEl._chartInstance = new window.Chart(hubVolumeBarEl.getContext('2d'), {
            type: 'bar',
            data: {
              labels: hubLabels,
              datasets: [{
                label: 'First Mile Volume',
                data: hubVolumeData,
                backgroundColor: orange,
                borderRadius: 6,
                maxBarThickness: 32,
              }],
            },
            options: {
              indexAxis: 'y',
              plugins: {
                legend: { display: false },
                tooltip: {
                  callbacks: {
                    label: ctx => ctx.parsed.x.toLocaleString()
                  },
                  backgroundColor: '#222',
                  titleColor: '#fff',
                  bodyColor: '#fff',
                  borderColor: '#fff',
                  borderWidth: 1,
                }
              },
              scales: {
                x: {
                  ticks: { color: '#fff', font: { family: fontFamily } },
                  grid: { color: '#295c47' },
                  title: { display: true, text: 'First Mile Volume', color: '#fff', font: { weight: 'bold', family: fontFamily } }
                },
                y: {
                  ticks: { color: '#fff', font: { family: fontFamily } },
                  grid: { color: '#295c47' },
                  title: { display: true, text: 'Current Hub Code', color: '#fff', font: { weight: 'bold', family: fontFamily } }
                }
              },
              font: { family: fontFamily },
              responsive: true,
              maintainAspectRatio: false,
            }
          });
        }
        // ... existing code ...
      }, [selectedTab]);

      React.useEffect(() => {
        if (selectedTab !== 'sortcenter') return;
        // Get computed color values for palette
        const rootStyle = getComputedStyle(document.documentElement);
        const orange = rootStyle.getPropertyValue('--secondaryMain').trim() || '#ff9d18';
        const orangeFill = 'rgba(255,157,24,0.15)';
        const green = rootStyle.getPropertyValue('--primaryMain').trim() || '#1f6a4a';
        const fontFamily = `'Euclid Circular B', 'Inter', 'sans-serif'`;
        // Clean up previous chart if any
        const costChartEl = document.getElementById('sortcenter-cost-chart');
        if (costChartEl && costChartEl._chartInstance) {
          costChartEl._chartInstance.destroy();
          costChartEl._chartInstance = null;
        }
        const cpsChartEl = document.getElementById('sortcenter-cps-chart');
        if (cpsChartEl && cpsChartEl._chartInstance) {
          cpsChartEl._chartInstance.destroy();
          cpsChartEl._chartInstance = null;
        }
        const volumeChartEl = document.getElementById('sortcenter-volume-chart');
        if (volumeChartEl && volumeChartEl._chartInstance) {
          volumeChartEl._chartInstance.destroy();
          volumeChartEl._chartInstance = null;
        }
        const hubBarEl = document.getElementById('sortcenter-cost-hub-bar');
        if (hubBarEl && hubBarEl._chartInstance) {
          hubBarEl._chartInstance.destroy();
          hubBarEl._chartInstance = null;
        }
        const hubPieEl = document.getElementById('sortcenter-cost-hub-pie');
        if (hubPieEl && hubPieEl._chartInstance) {
          hubPieEl._chartInstance.destroy();
          hubPieEl._chartInstance = null;
        }
        const hubVolumeBarEl = document.getElementById('sortcenter-volume-hub-bar');
        if (hubVolumeBarEl && hubVolumeBarEl._chartInstance) {
          hubVolumeBarEl._chartInstance.destroy();
          hubVolumeBarEl._chartInstance = null;
        }
        // Sample data for charts (reuse First Mile sample data for now)
        const labels = [
          'May 2025', '', '', '', '', '', '', '', '', '', 'Jun 2025', '', '', '', '', '', '', '', '', '', 'Jun 22'
        ];
        const costData = [971, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 971];
        const cpsData = [3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 971, 65];
        const volumeData = [0, 0, 0, 0, 0, 1200, 2300, 400, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1100];
        const hubLabels = ['RUH', 'JED', 'DMM', 'MED', 'KAM', 'QAS', 'MAK'];
        const hubCostData = [50500, 0, 0, 0, 0, 0, 0];
        const hubPieColors = [orange, green, '#00bcd4', '#616161', '#8bc34a', '#ffd8a3', '#e0e0e0'];
        const hubVolumeData = [16400, 5100, 3600, 1600, 900, 800, 0];
        function makeChart(ctx, label, data, yLabel) {
          return new window.Chart(ctx, {
            type: 'line',
            data: {
              labels,
              datasets: [{
                label,
                data,
                fill: true,
                backgroundColor: orangeFill,
                borderColor: orange,
                borderWidth: 3,
                pointBackgroundColor: green,
                pointBorderColor: orange,
                pointRadius: 4,
                pointHoverRadius: 6,
                tension: 0.3,
              }]
            },
            options: {
              responsive: true,
              plugins: {
                legend: { display: false },
                tooltip: {
                  callbacks: {
                    label: ctx => `${yLabel}: ${ctx.parsed.y}`
                  },
                  backgroundColor: '#222',
                  titleColor: '#fff',
                  bodyColor: '#fff',
                  borderColor: '#fff',
                  borderWidth: 1,
                }
              },
              scales: {
                x: {
                  grid: { color: '#295c47', drawOnChartArea: false },
                  ticks: { color: '#fff', font: { family: fontFamily } }
                },
                y: {
                  beginAtZero: true,
                  grid: { color: '#295c47' },
                  ticks: { color: '#fff', font: { family: fontFamily } }
                }
              }
            }
          });
        }
        // Render the three main charts
        if (costChartEl) {
          costChartEl._chartInstance = makeChart(
            costChartEl.getContext('2d'),
            'Total SC Cost',
            costData,
            'Total SC Cost'
          );
        }
        if (cpsChartEl) {
          cpsChartEl._chartInstance = makeChart(
            cpsChartEl.getContext('2d'),
            'SC CPS',
            cpsData,
            'SC CPS'
          );
        }
        if (volumeChartEl) {
          volumeChartEl._chartInstance = makeChart(
            volumeChartEl.getContext('2d'),
            'Sum of SC V.',
            volumeData,
            'Sum of SC V.'
          );
        }
        // Cost per Hub - Bar
        if (hubBarEl) {
          hubBarEl._chartInstance = new window.Chart(hubBarEl.getContext('2d'), {
            type: 'bar',
            data: {
              labels: hubLabels.map((l, i) => `Sum of ${l}`),
              datasets: [{
                label: 'Sum of Cost',
                data: hubCostData,
                backgroundColor: hubCostData.map(() => orange),
                borderRadius: 6,
                maxBarThickness: 32,
              }],
            },
            options: {
              indexAxis: 'y',
              plugins: {
                legend: { display: false },
                tooltip: {
                  callbacks: {
                    label: ctx => ctx.parsed.x.toLocaleString()
                  },
                  backgroundColor: '#222',
                  titleColor: '#fff',
                  bodyColor: '#fff',
                  borderColor: '#fff',
                  borderWidth: 1,
                }
              },
              scales: {
                x: {
                  ticks: { color: '#fff', font: { family: fontFamily } },
                  grid: { color: '#295c47' },
                  title: { display: true, text: '', color: '#fff', font: { weight: 'bold', family: fontFamily } }
                },
                y: {
                  ticks: { color: '#fff', font: { family: fontFamily } },
                  grid: { color: '#295c47' },
                  title: { display: true, text: '', color: '#fff', font: { weight: 'bold', family: fontFamily } }
                }
              },
              font: { family: fontFamily },
              responsive: true,
              maintainAspectRatio: false,
            }
          });
        }
        // Cost per Hub - Pie
        if (hubPieEl) {
          hubPieEl._chartInstance = new window.Chart(hubPieEl.getContext('2d'), {
            type: 'pie',
            data: {
              labels: hubLabels.map((l, i) => `Sum of ${l}`),
              datasets: [{
                label: 'Sum of Cost',
                data: hubCostData,
                backgroundColor: hubPieColors,
                borderWidth: 1,
              }],
            },
            options: {
              plugins: {
                legend: { display: true, position: 'right', labels: { color: '#fff', font: { family: fontFamily } } },
                tooltip: {
                  callbacks: {
                    label: ctx => `${ctx.label}: ${ctx.parsed.toLocaleString()} (${ctx.parsed > 0 ? '100%' : '0%'})`
                  },
                  backgroundColor: '#222',
                  titleColor: '#fff',
                  bodyColor: '#fff',
                  borderColor: '#fff',
                  borderWidth: 1,
                }
              },
              font: { family: fontFamily },
              responsive: true,
              maintainAspectRatio: false,
            }
          });
        }
        // Volumes per Hub - Bar
        if (hubVolumeBarEl) {
          hubVolumeBarEl._chartInstance = new window.Chart(hubVolumeBarEl.getContext('2d'), {
            type: 'bar',
            data: {
              labels: hubLabels,
              datasets: [{
                label: 'Sort Center Volume',
                data: hubVolumeData,
                backgroundColor: orange,
                borderRadius: 6,
                maxBarThickness: 32,
              }],
            },
            options: {
              indexAxis: 'y',
              plugins: {
                legend: { display: false },
                tooltip: {
                  callbacks: {
                    label: ctx => ctx.parsed.x.toLocaleString()
                  },
                  backgroundColor: '#222',
                  titleColor: '#fff',
                  bodyColor: '#fff',
                  borderColor: '#fff',
                  borderWidth: 1,
                }
              },
              scales: {
                x: {
                  ticks: { color: '#fff', font: { family: fontFamily } },
                  grid: { color: '#295c47' },
                  title: { display: true, text: 'Sort Center Volume', color: '#fff', font: { weight: 'bold', family: fontFamily } }
                },
                y: {
                  ticks: { color: '#fff', font: { family: fontFamily } },
                  grid: { color: '#295c47' },
                  title: { display: true, text: 'Current Hub Code', color: '#fff', font: { weight: 'bold', family: fontFamily } }
                }
              },
              font: { family: fontFamily },
              responsive: true,
              maintainAspectRatio: false,
            }
          });
        }
      }, [selectedTab]);

      React.useEffect(() => {
        if (selectedTab !== 'scgap') return;
        // ...existing code...
        // --- SC Gap Analysis Dual-Axis Charts ---
        const green = getComputedStyle(document.documentElement).getPropertyValue('--primaryMain').trim() || '#1f6a4a';
        const orange = getComputedStyle(document.documentElement).getPropertyValue('--secondaryMain').trim() || '#ff9d18';
        const fontFamily = `'Euclid Circular B', 'Inter', 'sans-serif'`;
        // Sample data
        const labels = ['May 2025', '', '', '', '', '', '', '', '', '', 'Jun 2025', '', '', '', '', '', '', '', '', '', 'Jun 22'];
        // CPS
        const opsCPS = [0.39, 0.36, 0.44, 0.56, 0.64, 0.38, 0.65, 0.46, 0.24, 0.34, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0];
        const sysCPS = [0.36, 0.36, 0.36, 0.36, 0.36, 0.36, 0.36, 0.36, 0.36, 0.36, 0.36, 0.36, 0.36, 0.36, 0.36, 0.36, 0.36, 0.36, 0.36, 0.36];
        // Cost
        const opsCost = [4300, 4700, 5100, 4100, 5200, 5900, 5500, 4100, 3700, 5100, 4100, 4100, 4100, 4100, 4100, 4100, 4100, 4100, 4100, 4100];
        const sysCost = [5000, 4700, 5100, 4100, 5200, 5900, 5500, 4100, 3700, 5100, 4100, 4100, 4100, 4100, 4100, 4100, 4100, 4100, 4100, 4100];
        // Volume
        const opsVol = [10000, 11000, 13000, 17000, 16000, 12000, 12000, 12000, 12000, 12000, 12000, 12000, 12000, 12000, 12000, 12000, 12000, 12000, 12000, 12000];
        const sysVol = [5000, 6000, 7000, 8000, 9000, 10000, 11000, 12000, 13000, 14000, 15000, 16000, 17000, 18000, 19000, 20000, 21000, 22000, 23000, 24000];
        // Chart cleanup
        const destroyChart = el => { if (el && el._chartInstance) { el._chartInstance.destroy(); el._chartInstance = null; } };
        destroyChart(document.getElementById('scgap-cps-chart'));
        destroyChart(document.getElementById('scgap-cost-chart'));
        destroyChart(document.getElementById('scgap-volume-chart'));
        // CPS chart
        const cpsEl = document.getElementById('scgap-cps-chart');
        if (cpsEl) {
          cpsEl._chartInstance = new window.Chart(cpsEl.getContext('2d'), {
            type: 'line',
            data: {
              labels,
              datasets: [
                {
                  label: 'Ops SC CPS',
                  data: opsCPS,
                  borderColor: green,
                  backgroundColor: green + '33',
                  fill: true,
                  tension: 0.3,
                  pointRadius: 3,
                  pointBackgroundColor: green,
                  yAxisID: 'y',
                },
                {
                  label: 'SC CPS',
                  data: sysCPS,
                  borderColor: orange,
                  backgroundColor: orange + '33',
                  fill: true,
                  tension: 0.3,
                  pointRadius: 3,
                  pointBackgroundColor: orange,
                  yAxisID: 'y1',
                }
              ]
            },
            options: {
              responsive: true,
              plugins: {
                legend: { labels: { color: '#fff', font: { family: fontFamily } } },
                tooltip: { titleColor: '#fff', bodyColor: '#fff', backgroundColor: '#222' }
              },
              scales: {
                x: { ticks: { color: '#fff', font: { family: fontFamily } }, grid: { color: '#295c47' } },
                y: { type: 'linear', position: 'left', beginAtZero: true, ticks: { color: '#fff', font: { family: fontFamily } }, grid: { color: '#295c47' } },
                y1: { type: 'linear', position: 'right', beginAtZero: true, ticks: { color: '#fff', font: { family: fontFamily } }, grid: { drawOnChartArea: false } }
              }
            }
          });
        }
        // Cost chart
        const costEl = document.getElementById('scgap-cost-chart');
        if (costEl) {
          costEl._chartInstance = new window.Chart(costEl.getContext('2d'), {
            type: 'line',
            data: {
              labels,
              datasets: [
                {
                  label: 'Ops SC Cost',
                  data: opsCost,
                  borderColor: green,
                  backgroundColor: green + '33',
                  fill: true,
                  tension: 0.3,
                  pointRadius: 3,
                  pointBackgroundColor: green,
                  yAxisID: 'y',
                },
                {
                  label: 'Total SC cost',
                  data: sysCost,
                  borderColor: orange,
                  backgroundColor: orange + '33',
                  fill: true,
                  tension: 0.3,
                  pointRadius: 3,
                  pointBackgroundColor: orange,
                  yAxisID: 'y1',
                }
              ]
            },
            options: {
              responsive: true,
              plugins: {
                legend: { labels: { color: '#fff', font: { family: fontFamily } } },
                tooltip: { titleColor: '#fff', bodyColor: '#fff', backgroundColor: '#222' }
              },
              scales: {
                x: { ticks: { color: '#fff', font: { family: fontFamily } }, grid: { color: '#295c47' } },
                y: { type: 'linear', position: 'left', beginAtZero: true, ticks: { color: '#fff', font: { family: fontFamily } }, grid: { color: '#295c47' } },
                y1: { type: 'linear', position: 'right', beginAtZero: true, ticks: { color: '#fff', font: { family: fontFamily } }, grid: { drawOnChartArea: false } }
              }
            }
          });
        }
        // Volume chart
        const volEl = document.getElementById('scgap-volume-chart');
        if (volEl) {
          volEl._chartInstance = new window.Chart(volEl.getContext('2d'), {
            type: 'line',
            data: {
              labels,
              datasets: [
                {
                  label: 'Ops SC Volume',
                  data: opsVol,
                  borderColor: green,
                  backgroundColor: green + '33',
                  fill: true,
                  tension: 0.3,
                  pointRadius: 3,
                  pointBackgroundColor: green,
                  yAxisID: 'y',
                },
                {
                  label: 'System SC Volume',
                  data: sysVol,
                  borderColor: orange,
                  backgroundColor: orange + '33',
                  fill: true,
                  tension: 0.3,
                  pointRadius: 3,
                  pointBackgroundColor: orange,
                  yAxisID: 'y1',
                }
              ]
            },
            options: {
              responsive: true,
              plugins: {
                legend: { labels: { color: '#fff', font: { family: fontFamily } } },
                tooltip: { titleColor: '#fff', bodyColor: '#fff', backgroundColor: '#222' }
              },
              scales: {
                x: { ticks: { color: '#fff', font: { family: fontFamily } }, grid: { color: '#295c47' } },
                y: { type: 'linear', position: 'left', beginAtZero: true, ticks: { color: '#fff', font: { family: fontFamily } }, grid: { color: '#295c47' } },
                y1: { type: 'linear', position: 'right', beginAtZero: true, ticks: { color: '#fff', font: { family: fontFamily } }, grid: { drawOnChartArea: false } }
              }
            }
          });
        }
        // ... existing code ...
      }, [selectedTab]);

      React.useEffect(() => {
        if (selectedTab !== 'settings') return;
        // ...existing code...
        // Add chart rendering logic for the three new charts
        // ...existing code...
      }, [selectedTab]);

      React.useEffect(() => {
        if (selectedTab !== 'linehaul') return;
        // Get computed color values for palette
        const rootStyle = getComputedStyle(document.documentElement);
        const orange = rootStyle.getPropertyValue('--secondaryMain').trim() || '#ff9d18';
        const green = rootStyle.getPropertyValue('--primaryMain').trim() || '#1f6a4a';
        const fontFamily = `'Euclid Circular B', 'Inter', 'sans-serif'`;
        // Clean up previous chart if any
        const costChartEl = document.getElementById('linehaul-cost-chart');
        if (costChartEl && costChartEl._chartInstance) {
          costChartEl._chartInstance.destroy();
          costChartEl._chartInstance = null;
        }
        const cpsChartEl = document.getElementById('linehaul-cps-chart');
        if (cpsChartEl && cpsChartEl._chartInstance) {
          cpsChartEl._chartInstance.destroy();
          cpsChartEl._chartInstance = null;
        }
        const volumeChartEl = document.getElementById('linehaul-volume-chart');
        if (volumeChartEl && volumeChartEl._chartInstance) {
          volumeChartEl._chartInstance.destroy();
          volumeChartEl._chartInstance = null;
        }
        const hubBarEl = document.getElementById('linehaul-cost-hub-bar');
        if (hubBarEl && hubBarEl._chartInstance) {
          hubBarEl._chartInstance.destroy();
          hubBarEl._chartInstance = null;
        }
        const hubPieEl = document.getElementById('linehaul-cost-hub-pie');
        if (hubPieEl && hubPieEl._chartInstance) {
          hubPieEl._chartInstance.destroy();
          hubPieEl._chartInstance = null;
        }
        const hubVolumeBarEl = document.getElementById('linehaul-volume-hub-bar');
        if (hubVolumeBarEl && hubVolumeBarEl._chartInstance) {
          hubVolumeBarEl._chartInstance.destroy();
          hubVolumeBarEl._chartInstance = null;
        }
        // Sample data for hub charts
        const hubLabels = ['RUH', 'JED', 'DMM', 'MED', 'KAM', 'QAS', 'MAK'];
        const hubCostData = [50500, 0, 0, 0, 0, 0, 0];
        const hubPieColors = [orange, green, '#00bcd4', '#616161', '#8bc34a', '#ffd8a3', '#e0e0e0'];
        const hubVolumeData = [16400, 5100, 3600, 1600, 900, 800, 0];
        // Line Haul Cost per Hub - Bar
        if (hubBarEl) {
          hubBarEl._chartInstance = new window.Chart(hubBarEl.getContext('2d'), {
            type: 'bar',
            data: {
              labels: hubLabels.map((l, i) => `Sum of ${l}`),
              datasets: [{
                label: 'Sum of Cost',
                data: hubCostData,
                backgroundColor: hubCostData.map(() => orange),
                borderRadius: 6,
                maxBarThickness: 32,
              }],
            },
            options: {
              indexAxis: 'y',
              plugins: {
                legend: { display: false },
                tooltip: {
                  callbacks: {
                    label: ctx => ctx.parsed.x.toLocaleString()
                  },
                  backgroundColor: '#222',
                  titleColor: '#fff',
                  bodyColor: '#fff',
                  borderColor: '#fff',
                  borderWidth: 1,
                }
              },
              scales: {
                x: {
                  ticks: { color: '#fff', font: { family: fontFamily } },
                  grid: { color: '#295c47' },
                  title: { display: true, text: '', color: '#fff', font: { weight: 'bold', family: fontFamily } }
                },
                y: {
                  ticks: { color: '#fff', font: { family: fontFamily } },
                  grid: { color: '#295c47' },
                  title: { display: true, text: '', color: '#fff', font: { weight: 'bold', family: fontFamily } }
                }
              },
              font: { family: fontFamily },
              responsive: true,
              maintainAspectRatio: false,
            }
          });
        }
        // Line Haul Cost per Hub - Pie
        if (hubPieEl) {
          hubPieEl._chartInstance = new window.Chart(hubPieEl.getContext('2d'), {
            type: 'pie',
            data: {
              labels: hubLabels.map((l, i) => `Sum of ${l}`),
              datasets: [{
                label: 'Sum of Cost',
                data: hubCostData,
                backgroundColor: hubPieColors,
                borderWidth: 1,
              }],
            },
            options: {
              plugins: {
                legend: { display: true, position: 'right', labels: { color: '#fff', font: { family: fontFamily } } },
                tooltip: {
                  callbacks: {
                    label: ctx => `${ctx.label}: ${ctx.parsed.toLocaleString()} (${ctx.parsed > 0 ? '100%' : '0%'})`
                  },
                  backgroundColor: '#222',
                  titleColor: '#fff',
                  bodyColor: '#fff',
                  borderColor: '#fff',
                  borderWidth: 1,
                }
              },
              font: { family: fontFamily },
              responsive: true,
              maintainAspectRatio: false,
            }
          });
        }
        // Line Haul Volumes per Hub - Bar
        if (hubVolumeBarEl) {
          hubVolumeBarEl._chartInstance = new window.Chart(hubVolumeBarEl.getContext('2d'), {
            type: 'bar',
            data: {
              labels: hubLabels,
              datasets: [{
                label: 'Line Haul Volume',
                data: hubVolumeData,
                backgroundColor: orange,
                borderRadius: 6,
                maxBarThickness: 32,
              }],
            },
            options: {
              indexAxis: 'y',
              plugins: {
                legend: { display: false },
                tooltip: {
                  callbacks: {
                    label: ctx => ctx.parsed.x.toLocaleString()
                  },
                  backgroundColor: '#222',
                  titleColor: '#fff',
                  bodyColor: '#fff',
                  borderColor: '#fff',
                  borderWidth: 1,
                }
              },
              scales: {
                x: {
                  ticks: { color: '#fff', font: { family: fontFamily } },
                  grid: { color: '#295c47' },
                  title: { display: true, text: 'Line Haul Volume', color: '#fff', font: { weight: 'bold', family: fontFamily } }
                },
                y: {
                  ticks: { color: '#fff', font: { family: fontFamily } },
                  grid: { color: '#295c47' },
                  title: { display: true, text: 'Current Hub Code', color: '#fff', font: { weight: 'bold', family: fontFamily } }
                }
              },
              font: { family: fontFamily },
              responsive: true,
              maintainAspectRatio: false,
            }
          });
        }
        // --- Line Haul Dual-Axis Charts ---
        const dualLabels = ['May 2025', '', '', '', '', '', '', '', '', '', 'Jun 2025', '', '', '', '', '', '', '', '', '', 'Jun 22'];
        // CPS
        const opsCPS = [0.39, 0.36, 0.44, 0.56, 0.64, 0.38, 0.65, 0.46, 0.24, 0.34, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0];
        const sysCPS = [0.36, 0.36, 0.36, 0.36, 0.36, 0.36, 0.36, 0.36, 0.36, 0.36, 0.36, 0.36, 0.36, 0.36, 0.36, 0.36, 0.36, 0.36, 0.36, 0.36];
        // Cost
        const opsCost = [4300, 4700, 5100, 4100, 5200, 5900, 5500, 4100, 3700, 5100, 4100, 4100, 4100, 4100, 4100, 4100, 4100, 4100, 4100, 4100];
        const sysCost = [5000, 4700, 5100, 4100, 5200, 5900, 5500, 4100, 3700, 5100, 4100, 4100, 4100, 4100, 4100, 4100, 4100, 4100, 4100, 4100];
        // Volume
        const opsVol = [10000, 11000, 13000, 17000, 16000, 12000, 12000, 12000, 12000, 12000, 12000, 12000, 12000, 12000, 12000, 12000, 12000, 12000, 12000, 12000];
        const sysVol = [5000, 6000, 7000, 8000, 9000, 10000, 11000, 12000, 13000, 14000, 15000, 16000, 17000, 18000, 19000, 20000, 21000, 22000, 23000, 24000];
        // Chart cleanup
        const destroyChart = el => { if (el && el._chartInstance) { el._chartInstance.destroy(); el._chartInstance = null; } };
        destroyChart(document.getElementById('linehaul-cps-gap-chart'));
        destroyChart(document.getElementById('linehaul-cost-gap-chart'));
        destroyChart(document.getElementById('linehaul-volume-gap-chart'));
        // CPS chart
        const cpsEl = document.getElementById('linehaul-cps-gap-chart');
        if (cpsEl) {
          cpsEl._chartInstance = new window.Chart(cpsEl.getContext('2d'), {
            type: 'line',
            data: {
              labels: dualLabels,
              datasets: [
                {
                  label: 'Ops LH CPS',
                  data: opsCPS,
                  borderColor: green,
                  backgroundColor: green + '33',
                  fill: true,
                  tension: 0.3,
                  pointRadius: 3,
                  pointBackgroundColor: green,
                  yAxisID: 'y',
                },
                {
                  label: 'LH CPS',
                  data: sysCPS,
                  borderColor: orange,
                  backgroundColor: orange + '33',
                  fill: true,
                  tension: 0.3,
                  pointRadius: 3,
                  pointBackgroundColor: orange,
                  yAxisID: 'y1',
                }
              ]
            },
            options: {
              responsive: true,
              plugins: {
                legend: { labels: { color: '#fff', font: { family: fontFamily } } },
                tooltip: { titleColor: '#fff', bodyColor: '#fff', backgroundColor: '#222' }
              },
              scales: {
                x: { ticks: { color: '#fff', font: { family: fontFamily } }, grid: { color: '#295c47' } },
                y: { type: 'linear', position: 'left', beginAtZero: true, ticks: { color: '#fff', font: { family: fontFamily } }, grid: { color: '#295c47' } },
                y1: { type: 'linear', position: 'right', beginAtZero: true, ticks: { color: '#fff', font: { family: fontFamily } }, grid: { drawOnChartArea: false } }
              }
            }
          });
        }
        // Cost chart
        const costEl = document.getElementById('linehaul-cost-gap-chart');
        if (costEl) {
          costEl._chartInstance = new window.Chart(costEl.getContext('2d'), {
            type: 'line',
            data: {
              labels: dualLabels,
              datasets: [
                {
                  label: 'Ops LH Cost',
                  data: opsCost,
                  borderColor: green,
                  backgroundColor: green + '33',
                  fill: true,
                  tension: 0.3,
                  pointRadius: 3,
                  pointBackgroundColor: green,
                  yAxisID: 'y',
                },
                {
                  label: 'Total LH cost',
                  data: sysCost,
                  borderColor: orange,
                  backgroundColor: orange + '33',
                  fill: true,
                  tension: 0.3,
                  pointRadius: 3,
                  pointBackgroundColor: orange,
                  yAxisID: 'y1',
                }
              ]
            },
            options: {
              responsive: true,
              plugins: {
                legend: { labels: { color: '#fff', font: { family: fontFamily } } },
                tooltip: { titleColor: '#fff', bodyColor: '#fff', backgroundColor: '#222' }
              },
              scales: {
                x: { ticks: { color: '#fff', font: { family: fontFamily } }, grid: { color: '#295c47' } },
                y: { type: 'linear', position: 'left', beginAtZero: true, ticks: { color: '#fff', font: { family: fontFamily } }, grid: { color: '#295c47' } },
                y1: { type: 'linear', position: 'right', beginAtZero: true, ticks: { color: '#fff', font: { family: fontFamily } }, grid: { drawOnChartArea: false } }
              }
            }
          });
        }
        // Volume chart
        const volEl = document.getElementById('linehaul-volume-gap-chart');
        if (volEl) {
          volEl._chartInstance = new window.Chart(volEl.getContext('2d'), {
            type: 'line',
            data: {
              labels: dualLabels,
              datasets: [
                {
                  label: 'Ops LH Volume',
                  data: opsVol,
                  borderColor: green,
                  backgroundColor: green + '33',
                  fill: true,
                  tension: 0.3,
                  pointRadius: 3,
                  pointBackgroundColor: green,
                  yAxisID: 'y',
                },
                {
                  label: 'System LH Volume',
                  data: sysVol,
                  borderColor: orange,
                  backgroundColor: orange + '33',
                  fill: true,
                  tension: 0.3,
                  pointRadius: 3,
                  pointBackgroundColor: orange,
                  yAxisID: 'y1',
                }
              ]
            },
            options: {
              responsive: true,
              plugins: {
                legend: { labels: { color: '#fff', font: { family: fontFamily } } },
                tooltip: { titleColor: '#fff', bodyColor: '#fff', backgroundColor: '#222' }
              },
              scales: {
                x: { ticks: { color: '#fff', font: { family: fontFamily } }, grid: { color: '#295c47' } },
                y: { type: 'linear', position: 'left', beginAtZero: true, ticks: { color: '#fff', font: { family: fontFamily } }, grid: { color: '#295c47' } },
                y1: { type: 'linear', position: 'right', beginAtZero: true, ticks: { color: '#fff', font: { family: fontFamily } }, grid: { drawOnChartArea: false } }
              }
            }
          });
        }
      }, [selectedTab]);

      React.useEffect(() => {
        if (selectedTab !== 'lhgap') return;
        // ... existing code ...
        // --- Line Haul Gap Analysis Dual-Axis Charts ---
        const green = getComputedStyle(document.documentElement).getPropertyValue('--primaryMain').trim() || '#1f6a4a';
        const orange = getComputedStyle(document.documentElement).getPropertyValue('--secondaryMain').trim() || '#ff9d18';
        const fontFamily = `'Euclid Circular B', 'Inter', 'sans-serif'`;
        // Sample data
        const labels = ['May 2025', '', '', '', '', '', '', '', '', '', 'Jun 2025', '', '', '', '', '', '', '', '', '', 'Jun 22'];
        // CPS
        const opsCPS = [0.39, 0.36, 0.44, 0.56, 0.64, 0.38, 0.65, 0.46, 0.24, 0.34, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0];
        const sysCPS = [0.36, 0.36, 0.36, 0.36, 0.36, 0.36, 0.36, 0.36, 0.36, 0.36, 0.36, 0.36, 0.36, 0.36, 0.36, 0.36, 0.36, 0.36, 0.36, 0.36];
        // Cost
        const opsCost = [4300, 4700, 5100, 4100, 5200, 5900, 5500, 4100, 3700, 5100, 4100, 4100, 4100, 4100, 4100, 4100, 4100, 4100, 4100, 4100];
        const sysCost = [5000, 4700, 5100, 4100, 5200, 5900, 5500, 4100, 3700, 5100, 4100, 4100, 4100, 4100, 4100, 4100, 4100, 4100, 4100, 4100];
        // Volume
        const opsVol = [10000, 11000, 13000, 17000, 16000, 12000, 12000, 12000, 12000, 12000, 12000, 12000, 12000, 12000, 12000, 12000, 12000, 12000, 12000, 12000];
        const sysVol = [5000, 6000, 7000, 8000, 9000, 10000, 11000, 12000, 13000, 14000, 15000, 16000, 17000, 18000, 19000, 20000, 21000, 22000, 23000, 24000];
        // Chart cleanup
        const destroyChart = el => { if (el && el._chartInstance) { el._chartInstance.destroy(); el._chartInstance = null; } };
        destroyChart(document.getElementById('linehaul-cps-gap-chart'));
        destroyChart(document.getElementById('linehaul-cost-gap-chart'));
        destroyChart(document.getElementById('linehaul-volume-gap-chart'));
        // CPS chart
        const cpsEl = document.getElementById('linehaul-cps-gap-chart');
        if (cpsEl) {
          cpsEl._chartInstance = new window.Chart(cpsEl.getContext('2d'), {
            type: 'line',
            data: {
              labels,
              datasets: [
                {
                  label: 'Ops LH CPS',
                  data: opsCPS,
                  borderColor: green,
                  backgroundColor: green + '33',
                  fill: true,
                  tension: 0.3,
                  pointRadius: 3,
                  pointBackgroundColor: green,
                  yAxisID: 'y',
                },
                {
                  label: 'LH CPS',
                  data: sysCPS,
                  borderColor: orange,
                  backgroundColor: orange + '33',
                  fill: true,
                  tension: 0.3,
                  pointRadius: 3,
                  pointBackgroundColor: orange,
                  yAxisID: 'y1',
                }
              ]
            },
            options: {
              responsive: true,
              plugins: {
                legend: { labels: { color: '#fff', font: { family: fontFamily } } },
                tooltip: { titleColor: '#fff', bodyColor: '#fff', backgroundColor: '#222' }
              },
              scales: {
                x: { ticks: { color: '#fff', font: { family: fontFamily } }, grid: { color: '#295c47' } },
                y: { type: 'linear', position: 'left', beginAtZero: true, ticks: { color: '#fff', font: { family: fontFamily } }, grid: { color: '#295c47' } },
                y1: { type: 'linear', position: 'right', beginAtZero: true, ticks: { color: '#fff', font: { family: fontFamily } }, grid: { drawOnChartArea: false } }
              }
            }
          });
        }
        // Cost chart
        const costEl = document.getElementById('linehaul-cost-gap-chart');
        if (costEl) {
          costEl._chartInstance = new window.Chart(costEl.getContext('2d'), {
            type: 'line',
            data: {
              labels,
              datasets: [
                {
                  label: 'Ops LH Cost',
                  data: opsCost,
                  borderColor: green,
                  backgroundColor: green + '33',
                  fill: true,
                  tension: 0.3,
                  pointRadius: 3,
                  pointBackgroundColor: green,
                  yAxisID: 'y',
                },
                {
                  label: 'Total LH cost',
                  data: sysCost,
                  borderColor: orange,
                  backgroundColor: orange + '33',
                  fill: true,
                  tension: 0.3,
                  pointRadius: 3,
                  pointBackgroundColor: orange,
                  yAxisID: 'y1',
                }
              ]
            },
            options: {
              responsive: true,
              plugins: {
                legend: { labels: { color: '#fff', font: { family: fontFamily } } },
                tooltip: { titleColor: '#fff', bodyColor: '#fff', backgroundColor: '#222' }
              },
              scales: {
                x: { ticks: { color: '#fff', font: { family: fontFamily } }, grid: { color: '#295c47' } },
                y: { type: 'linear', position: 'left', beginAtZero: true, ticks: { color: '#fff', font: { family: fontFamily } }, grid: { color: '#295c47' } },
                y1: { type: 'linear', position: 'right', beginAtZero: true, ticks: { color: '#fff', font: { family: fontFamily } }, grid: { drawOnChartArea: false } }
              }
            }
          });
        }
        // Volume chart
        const volEl = document.getElementById('linehaul-volume-gap-chart');
        if (volEl) {
          volEl._chartInstance = new window.Chart(volEl.getContext('2d'), {
            type: 'line',
            data: {
              labels,
              datasets: [
                {
                  label: 'Ops LH Volume',
                  data: opsVol,
                  borderColor: green,
                  backgroundColor: green + '33',
                  fill: true,
                  tension: 0.3,
                  pointRadius: 3,
                  pointBackgroundColor: green,
                  yAxisID: 'y',
                },
                {
                  label: 'System LH Volume',
                  data: sysVol,
                  borderColor: orange,
                  backgroundColor: orange + '33',
                  fill: true,
                  tension: 0.3,
                  pointRadius: 3,
                  pointBackgroundColor: orange,
                  yAxisID: 'y1',
                }
              ]
            },
            options: {
              responsive: true,
              plugins: {
                legend: { labels: { color: '#fff', font: { family: fontFamily } } },
                tooltip: { titleColor: '#fff', bodyColor: '#fff', backgroundColor: '#222' }
              },
              scales: {
                x: { ticks: { color: '#fff', font: { family: fontFamily } }, grid: { color: '#295c47' } },
                y: { type: 'linear', position: 'left', beginAtZero: true, ticks: { color: '#fff', font: { family: fontFamily } }, grid: { color: '#295c47' } },
                y1: { type: 'linear', position: 'right', beginAtZero: true, ticks: { color: '#fff', font: { family: fontFamily } }, grid: { drawOnChartArea: false } }
              }
            }
          });
        }
      }, [selectedTab]);

      React.useEffect(() => {
        if (selectedTab !== 'pps') return;
        // ... existing code ...
        // Add chart rendering logic for the three new charts
        // ...existing code...
      }, [selectedTab]);

      React.useEffect(() => {
        if (selectedTab !== 'mv') return;
        // ... existing code ...
        // Add chart rendering logic for the three new charts
        // ...existing code...
      }, [selectedTab]);

      React.useEffect(() => {
        if (selectedTab !== 'volumes') return;
        // ... existing code ...
        // Add chart rendering logic for the three new charts
        // ...existing code...
      }, [selectedTab]);

      React.useEffect(() => {
        if (selectedTab !== 'customersvolumes') return;
        // ... existing code ...
        // Add chart rendering logic for the three new charts
        // ...existing code...
      }, [selectedTab]);

      return (
        <div className="flex min-h-screen">
          {/* Sidebar */}
          <aside id="sidebar" className="w-64 bg-[var(--white)] flex flex-col pt-8 gap-2 shadow-lg px-4 pb-8">
            {tabList.map(tab => (
              <button
                key={tab.key}
                className={`tab-btn flex items-center ${selectedTab === tab.key ? 'selected' : ''}`}
                onClick={() => setSelectedTab(tab.key)}
              >
                {tab.icon}
                {tab.label}
              </button>
            ))}
          </aside>
          {/* Main Content */}
          <main className="flex-1 p-8">
            {selectedTab === 'home' && (
              <section className="flex flex-col justify-center items-center min-h-screen w-full flex-grow p-0 m-0 mt-24">
                <img
                  src="images/starlinks.png"
                  alt="Starlinks Logo"
                  className="mb-6 rounded-xl home-image-shadow"
                  style={{ width: '640px', maxWidth: '100vw', height: 'auto', objectFit: 'contain', boxShadow: '0 8px 32px 0 var(--secondaryMain)' }}
                />
                <h1 className="text-3xl font-bold mb-4 text-[var(--secondaryMain)] text-center">Welcome to Home Delivery KPIs</h1>
                <div className="flex flex-wrap gap-6 mb-8 justify-center items-stretch w-full max-w-5xl">
                  <div className="flex-1 min-w-[200px] max-w-xs card flip-in flex flex-col items-center justify-center text-center p-6 border-2 border-[var(--secondaryMain)] bg-[var(--white)]" style={{ animationDelay: '0.1s' }}>
                    <i className="fa-solid fa-chart-line text-3xl mb-3 text-[var(--secondaryMain)]" />
                    <span className="text-base font-semibold text-[var(--secondaryMain)]">Analyze key performance indicators across the delivery network.</span>
                  </div>
                  <div className="flex-1 min-w-[200px] max-w-xs card flip-in flex flex-col items-center justify-center text-center p-6 border-2 border-[var(--secondaryMain)] bg-[var(--white)]" style={{ animationDelay: '0.25s' }}>
                    <i className="fa-solid fa-coins text-3xl mb-3 text-[var(--secondaryMain)]" />
                    <span className="text-base font-semibold text-[var(--secondaryMain)]">Track revenue, costs, and shipment volumes.</span>
                  </div>
                  <div className="flex-1 min-w-[200px] max-w-xs card flip-in flex flex-col items-center justify-center text-center p-6 border-2 border-[var(--secondaryMain)] bg-[var(--white)]" style={{ animationDelay: '0.4s' }}>
                    <i className="fa-solid fa-magnifying-glass-chart text-3xl mb-3 text-[var(--secondaryMain)]" />
                    <span className="text-base font-semibold text-[var(--secondaryMain)]">Drill down into specific areas like First Mile, Sort Center, Line Haul, and more.</span>
                  </div>
                  <div className="flex-1 min-w-[200px] max-w-xs card flip-in flex flex-col items-center justify-center text-center p-6 border-2 border-[var(--secondaryMain)] bg-[var(--white)]" style={{ animationDelay: '0.55s' }}>
                    <i className="fa-solid fa-upload text-3xl mb-3 text-[var(--secondaryMain)]" />
                    <span className="text-base font-semibold text-[var(--secondaryMain)]">Upload your own data to generate custom reports and visualizations.</span>
                  </div>
                </div>
                <div id="threads-root" style={{ width: '100%', height: '600px', position: 'relative', marginBottom: '2rem' }}></div>
              </section>
            )}
            {selectedTab === 'overview' && (
              <section className="relative">
                <button id="openFiltersBtn" className="btn-primary absolute top-4 right-4">Filters</button>
                <h2 className="text-4xl font-extrabold mb-2 text-[var(--secondaryMain)] text-center">Home Delivery Performance Overview</h2>
                <div className="bg-[var(--white)] border-2 border-[var(--secondaryMain)] rounded-2xl p-8 mb-10 w-full max-w-6xl mx-auto">
                  <div className="text-lg font-bold subtitle-custom text-center mb-4">Volume & Revenue Performance</div>
                  <div className="flex flex-wrap gap-6 justify-center items-stretch w-full">
                    <DeliveredVolumeValue files={files} />
                    <RTOVolumeValue files={files} />
                    <TotalRevenueValue files={files} />
                    <RpsValue files={files} />
                  </div>
                </div>
                {/* Cost Efficiency Subtitle and Cards */}
                <div className="bg-[var(--white)] border-2 border-[var(--secondaryMain)] rounded-2xl p-8 mb-10 w-full max-w-6xl mx-auto">
                  <div className="text-lg font-bold subtitle-custom text-center mb-4">Cost Efficiency</div>
                  <OverviewKpiCards files={files} />
                </div>
                <div className="bg-[var(--white)] border-2 border-[var(--secondaryMain)] rounded-2xl p-8 mb-10 w-full max-w-6xl mx-auto">
                  <div className="text-lg font-bold subtitle-custom text-center mb-4">Last Mile Transportation Costs</div>
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-8 w-full">
                    {['Sort Center Actual CPS VS. Target', 'PPS Actual CPS VS. Target', '3PL Actual Cost VS. Target', 'H&B Actual Cost VS. Target', 'M&V Actual Cost VS. Target', '3PL Actual CPS VS. Target'].map((label, i) => (
                      <div className="card bg-[var(--white)] border-2 border-[var(--secondaryMain)] rounded-xl p-6 shadow flex flex-col items-center justify-center" key={label}>
                        <div className="text-sm font-semibold subtitle-custom mb-2 text-center">{label}</div>
                        <canvas id={`gauge-lastmile-${i}`} width="100" height="60" className="mb-2"></canvas>
                      </div>
                    ))}
                  </div>
                </div>
              </section>
            )}
            {selectedTab === 'pnl' && (
              <section>
                <h2 className="text-4xl font-extrabold mb-2 text-[var(--secondaryMain)] text-center">Profit and Loss Analysis</h2>
                <PnLTable files={files} />
              </section>
            )}
            {selectedTab === 'revenue' && (
              <section>
                <h2 className="text-4xl font-extrabold mb-2 text-[var(--secondaryMain)] text-center">Revenue Breakdown</h2>
                <div className="bg-[var(--white)] border-2 border-[var(--secondaryMain)] rounded-2xl p-8 mb-10 w-full max-w-6xl mx-auto">
                  <div className="text-lg font-bold subtitle-custom text-center mb-6">Key Revenue Metrics</div>
                  <div className="flex flex-wrap gap-6 mb-8 justify-center items-stretch w-full">
                    <TotalRevenueValue files={files} />
                    <RpsValue files={files} />
                    <ParcelRpsValue files={files} />
                    <HnBRpsValue files={files} />
                    <DeliveredVolumeValue files={files} />
                  </div>
                </div>
                {/* Highest 10 Customers - Chart Only */}
                <div className="bg-[var(--white)] border-2 border-[var(--secondaryMain)] rounded-2xl p-8 mb-10 w-full max-w-6xl mx-auto">
                  <div className="text-lg font-bold subtitle-custom text-center mb-6">Highest 10 Customers</div>
                  <Highest10CustomersChart files={files} />
                </div>

                {/* Revenue by Tier - All Customers Table */}
                <div className="bg-[var(--white)] border-2 border-[var(--secondaryMain)] rounded-2xl p-8 mb-10 w-full max-w-6xl mx-auto">
                  <div className="text-lg font-bold subtitle-custom text-center mb-6">Revenue by Tier (All Customers)</div>
                  <RevenuePerTierTable files={files} />
                </div>
                {/* CPS per Tier subtitle and table */}
                <div className="bg-[var(--white)] border-2 border-[var(--secondaryMain)] rounded-2xl p-8 mb-10 w-full max-w-6xl mx-auto">
                  <div className="text-lg font-bold subtitle-custom text-center mb-6">CPS per Tier</div>
                  <div className="overflow-x-auto">
                    <table className="min-w-full text-left text-[var(--text)] border-separate border-spacing-y-2">
                      <thead>
                        <tr>
                          <th className="px-6 py-3 font-bold text-base bg-[var(--white)] border-b-2 border-[var(--secondaryMain)] rounded-tl-lg"></th>
                          <th className="px-6 py-3 font-bold text-base subtitle-custom bg-[var(--white)] border-b-2 border-[var(--secondaryMain)]">Tier 0</th>
                          <th className="px-6 py-3 font-bold text-base subtitle-custom bg-[var(--white)] border-b-2 border-[var(--secondaryMain)]">Tier 1</th>
                          <th className="px-6 py-3 font-bold text-base subtitle-custom bg-[var(--white)] border-b-2 border-[var(--secondaryMain)]">Tier 2</th>
                          <th className="px-6 py-3 font-bold text-base subtitle-custom bg-[var(--white)] border-b-2 border-[var(--secondaryMain)]">Tier 3</th>
                          <th className="px-6 py-3 font-bold text-base subtitle-custom bg-[var(--white)] border-b-2 border-[var(--secondaryMain)] rounded-tr-lg">Total</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr className="bg-[var(--white)]">
                          <td className="px-6 py-4 text-[var(--text)]">Cost Per Shipment</td>
                          <td className="px-6 py-4 text-[var(--white)]"></td>
                          <td className="px-6 py-4 text-[var(--white)]"></td>
                          <td className="px-6 py-4 text-[var(--white)]"></td>
                          <td className="px-6 py-4 text-[var(--white)]"></td>
                          <td className="px-6 py-4 text-[var(--secondaryMain)] font-bold"></td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>

                {/* Volume by Customer bar chart */}
                <div className="bg-[var(--white)] border-2 border-[var(--secondaryMain)] rounded-2xl p-8 mb-10 w-full max-w-6xl mx-auto">
                  <div className="text-lg font-bold subtitle-custom text-center mb-6">Volume by Customer</div>
                  <Top5VolumeByCustomerChart files={files} />
                </div>
              </section>
            )}
            {selectedTab === 'firstmile' && (
              <section>
                <h2 className="text-4xl font-extrabold mb-2 text-[var(--secondaryMain)] text-center">First Mile Breakdown</h2>
                <div className="bg-[var(--white)] border-2 border-[var(--secondaryMain)] rounded-2xl mb-10 w-full max-w-6xl mx-auto flex flex-col items-center justify-center py-12 gap-8">
                  <div className="text-lg font-bold subtitle-custom text-center">Key First Mile Metrics</div>
                  <div className="flex flex-row flex-wrap gap-8 justify-center items-stretch w-full">
                    <KpiCardTwoTone label="Total First Mile Cost" icon="fa-money-bill" />
                    <KpiCardTwoTone label="First Mile CPS" icon="fa-sliders-h" />
                    <FirstMileVolumeValue files={files} />
                  </div>
                </div>
                {/* First Mile Cost chart */}
                <div className="bg-[var(--white)] border-2 border-[var(--secondaryMain)] rounded-2xl p-8 mt-10 mb-8 w-full max-w-6xl mx-auto">
                  <div className="text-lg font-bold subtitle-custom text-[var(--secondaryMain)] text-center mb-4">First Mile Cost</div>
                  <div className="h-72 flex items-center justify-center">
                    <canvas id="firstmile-cost-chart" width="700" height="250"></canvas>
                  </div>
                </div>
                {/* First Mile CPS chart */}
                <div className="bg-[var(--white)] border-2 border-[var(--secondaryMain)] rounded-2xl p-8 mb-8 w-full max-w-6xl mx-auto">
                  <div className="text-lg font-bold subtitle-custom text-[var(--secondaryMain)] text-center mb-4">First Mile CPS</div>
                  <div className="h-72 flex items-center justify-center">
                    <canvas id="firstmile-cps-chart" width="700" height="250"></canvas>
                  </div>
                </div>
                {/* First Mile Volume chart */}
                <div className="bg-[var(--white)] border-2 border-[var(--secondaryMain)] rounded-2xl p-8 mb-8 w-full max-w-6xl mx-auto">
                  <div className="text-lg font-bold subtitle-custom text-[var(--secondaryMain)] text-center mb-4">First Mile Volume</div>
                  <FirstMileVolumeChart files={files} />
                </div>
                {/* First Mile Cost per Hub charts */}
                <div className="bg-[var(--white)] border-2 border-[var(--secondaryMain)] rounded-2xl shadow-lg p-10 w-full max-w-6xl mx-auto mt-10">
                  <div className="text-lg font-bold subtitle-custom text-center mb-8">First Mile Cost per Hub</div>
                  <div className="flex flex-col md:flex-row gap-8 justify-center items-stretch">
                    <div className="flex-1 flex flex-col items-center justify-center min-w-[260px] max-w-lg">
                      <canvas id="firstmile-cost-hub-bar" width="320" height="320"></canvas>
                    </div>
                    <div className="flex-1 flex flex-col items-center justify-center min-w-[260px] max-w-lg">
                      <canvas id="firstmile-cost-hub-pie" width="320" height="320"></canvas>
                    </div>
                  </div>
                </div>
                {/* First Mile Volumes per Hub chart */}
                <div className="bg-[var(--white)] border-2 border-[var(--secondaryMain)] rounded-2xl shadow-lg p-10 w-full max-w-6xl mx-auto mt-10">
                  <div className="text-lg font-bold subtitle-custom text-[var(--secondaryMain)] text-center mb-8">First Mile Volumes per Hub</div>
                  <FirstMileVolumesPerHubChart files={files} />
                </div>
              </section>
            )}
            {selectedTab === 'sortcenter' && (
              <section>
                <h2 className="text-4xl font-extrabold mb-2 text-[var(--secondaryMain)] text-center">Sort Center Breakdown</h2>
                <div className="bg-[var(--white)] border-2 border-[var(--secondaryMain)] rounded-2xl mb-10 w-full max-w-6xl mx-auto flex flex-col items-center justify-center py-12 gap-8">
                  <div className="text-lg font-bold subtitle-custom text-[var(--textSecondary)] text-center">Key Sort Center Metrics</div>
                  <div className="flex flex-row flex-wrap gap-8 justify-center items-stretch w-full">
                    <KpiCardTwoTone label="Total Sort Center Cost" icon="fa-money-bill" />
                    <KpiCardTwoTone label="Sort Center CPS" icon="fa-sliders-h" />
                    <SortCenterVolumeValue files={files} />
                  </div>
                </div>
                {/* Sort Center Cost chart */}
                <div className="bg-[var(--white)] border-2 border-[var(--secondaryMain)] rounded-2xl p-8 mt-10 mb-8 w-full max-w-6xl mx-auto">
                  <div className="text-lg font-bold subtitle-custom text-[var(--secondaryMain)] text-center mb-4">Sort Center Cost</div>
                  <div className="h-72 flex items-center justify-center">
                    <canvas id="sortcenter-cost-chart" width="700" height="250"></canvas>
                  </div>
                </div>
                {/* Sort Center CPS chart */}
                <div className="bg-[var(--white)] border-2 border-[var(--secondaryMain)] rounded-2xl p-8 mb-8 w-full max-w-6xl mx-auto">
                  <div className="text-lg font-bold subtitle-custom text-[var(--secondaryMain)] text-center mb-4">Sort Center CPS</div>
                  <div className="h-72 flex items-center justify-center">
                    <canvas id="sortcenter-cps-chart" width="700" height="250"></canvas>
                  </div>
                </div>
                {/* Sort Center Volume chart */}
                <div className="bg-[var(--white)] border-2 border-[var(--secondaryMain)] rounded-2xl p-8 mb-8 w-full max-w-6xl mx-auto">
                  <div className="text-lg font-bold subtitle-custom text-[var(--secondaryMain)] text-center mb-4">Sort Center Volume</div>
                  <SortCenterVolumeChart files={files} />
                </div>
                {/* Sort Center Cost per Hub charts */}
                <div className="bg-[var(--white)] border-2 border-[var(--secondaryMain)] rounded-2xl shadow-lg p-10 w-full max-w-6xl mx-auto mt-10">
                  <div className="text-lg font-bold subtitle-custom text-[var(--secondaryMain)] text-center mb-8">Sort Center Cost per Hub</div>
                  <div className="flex flex-col md:flex-row gap-8 justify-center items-stretch">
                    <div className="flex-1 flex flex-col items-center justify-center min-w-[260px] max-w-lg">
                      <canvas id="sortcenter-cost-hub-bar" width="320" height="320"></canvas>
                    </div>
                    <div className="flex-1 flex flex-col items-center justify-center min-w-[260px] max-w-lg">
                      <canvas id="sortcenter-cost-hub-pie" width="320" height="320"></canvas>
                    </div>
                  </div>
                </div>
                {/* Sort Center Volumes per Hub chart */}
                <div className="bg-[var(--white)] border-2 border-[var(--secondaryMain)] rounded-2xl shadow-lg p-10 w-full max-w-6xl mx-auto mt-10">
                  <div className="text-lg font-bold subtitle-custom text-[var(--secondaryMain)] text-center mb-8">Sort Center Volumes per Hub</div>
                  <SortCenterVolumesPerHubChart files={files} />
                </div>
              </section>
            )}
            {selectedTab === 'scgap' && (
              <section>
                <h2 className="text-4xl font-extrabold mb-2 text-[var(--secondaryMain)] text-center">Sort Center Gap Analysis</h2>
                {/* SC Gap Analysis Metrics Group */}
                <div className="bg-[var(--white)] border-2 border-[var(--secondaryMain)] rounded-2xl mb-10 w-full max-w-6xl mx-auto flex flex-col items-center justify-center py-12 gap-8">
                  <div className="text-lg font-bold subtitle-custom text-[var(--secondaryMain)] text-center mb-8">SC Gap Analysis Metrics</div>
                  <div className="flex flex-row flex-wrap gap-8 justify-center items-stretch w-full">
                    {/* Card 1: Ops SC Cost & System SC Cost */}
                    <div className="flex-1 min-w-[260px] max-w-xs card flex flex-row items-center justify-center text-center p-10 border-2 border-[var(--secondaryMain)] bg-[var(--white)] rounded-xl shadow-lg">
                      <div className="flex-1 flex flex-col items-center justify-center">
                        <i className="fa-solid fa-money-bill text-4xl mb-2 text-[var(--secondaryMain)]" />
                        <span className="font-semibold subtitle-custom text-[var(--text)]">Ops SC Cost</span>
                      </div>
                      <div className="h-12 w-px bg-[var(--secondaryMain)] mx-4" />
                      <div className="flex-1 flex flex-col items-center justify-center">
                        <i className="fa-solid fa-money-bill text-4xl mb-2 text-[var(--secondaryMain)]" />
                        <span className="font-semibold subtitle-custom text-[var(--text)]">System SC Cost</span>
                      </div>
                    </div>
                    {/* Card 2: Ops SC CPS & System SC CPS */}
                    <div className="flex-1 min-w-[260px] max-w-xs card flex flex-row items-center justify-center text-center p-10 border-2 border-[var(--secondaryMain)] bg-[var(--white)] rounded-xl shadow-lg">
                      <div className="flex-1 flex flex-col items-center justify-center">
                        <i className="fa-solid fa-sliders-h text-4xl mb-2 text-[var(--secondaryMain)]" />
                        <span className="font-semibold subtitle-custom text-[var(--text)]">Ops SC CPS</span>
                      </div>
                      <div className="h-12 w-px bg-[var(--secondaryMain)] mx-4" />
                      <div className="flex-1 flex flex-col items-center justify-center">
                        <i className="fa-solid fa-sliders-h text-4xl mb-2 text-[var(--secondaryMain)]" />
                        <span className="font-semibold subtitle-custom text-[var(--text)]">System SC CPS</span>
                      </div>
                    </div>
                    {/* Card 3: Ops SC Volume & System SC Volume */}
                    <div className="flex-1 min-w-[260px] max-w-xs card flex flex-row items-center justify-center text-center p-10 border-2 border-[var(--secondaryMain)] bg-[var(--white)] rounded-xl shadow-lg">
                      <div className="flex-1 flex flex-col items-center justify-center">
                        <i className="fa-solid fa-truck text-4xl mb-2 text-[var(--secondaryMain)]" />
                        <span className="font-semibold subtitle-custom text-[var(--text)]">Ops SC Volume</span>
                      </div>
                      <div className="h-12 w-px bg-[var(--secondaryMain)] mx-4" />
                      <div className="flex-1 flex flex-col items-center justify-center">
                        <i className="fa-solid fa-truck text-4xl mb-2 text-[var(--secondaryMain)]" />
                        <span className="font-semibold subtitle-custom text-[var(--text)]">System SC Volume</span>
                      </div>
                    </div>
                  </div>
                </div>
                {/* Sort Center CPS Chart */}
                <div className="mb-10 w-full max-w-6xl mx-auto">
                  <div className="bg-[var(--white)] border-2 border-[var(--secondaryMain)] rounded-2xl p-8 flex flex-col items-center justify-center">
                    <div className="text-lg font-bold subtitle-custom text-[var(--secondaryMain)] text-center mb-4">Sort Center CPS</div>
                    <canvas id="scgap-cps-chart" height="160"></canvas>
                  </div>
                </div>
                {/* Sort Center Cost Chart */}
                <div className="mb-10 w-full max-w-6xl mx-auto">
                  <div className="bg-[var(--white)] border-2 border-[var(--secondaryMain)] rounded-2xl p-8 flex flex-col items-center justify-center">
                    <div className="text-lg font-bold subtitle-custom text-[var(--secondaryMain)] text-center mb-4">Sort Center Cost</div>
                    <canvas id="scgap-cost-chart" height="160"></canvas>
                  </div>
                </div>
                {/* Sort Center Volume Chart */}
                <div className="mb-10 w-full max-w-6xl mx-auto">
                  <div className="bg-[var(--white)] border-2 border-[var(--secondaryMain)] rounded-2xl p-8 flex flex-col items-center justify-center">
                    <div className="text-lg font-bold subtitle-custom text-[var(--secondaryMain)] text-center mb-4">Sort Center Volume</div>
                    <canvas id="scgap-volume-chart" height="160"></canvas>
                  </div>
                </div>
              </section>
            )}
            {selectedTab === 'settings' && (
              <section className="flex flex-col items-center justify-center min-h-[60vh] w-full">
                <h2 className="text-4xl font-extrabold mb-2 text-[var(--secondaryMain)] text-center">Settings</h2>
                <SettingsFileUpload files={files} setFiles={setFiles} />
              </section>
            )}
            {selectedTab === 'linehaul' && (
              <section>
                <h2 className="text-4xl font-extrabold mb-2 text-[var(--secondaryMain)] text-center">Line Haul Breakdown</h2>
                <div className="bg-[var(--white)] border-2 border-[var(--secondaryMain)] rounded-2xl mb-10 w-full max-w-6xl mx-auto flex flex-col items-center justify-center py-12 gap-8">
                  <div className="text-lg font-bold subtitle-custom text-[var(--textSecondary)] text-center">Key Line Haul Metrics</div>
                  <div className="flex flex-row flex-wrap gap-8 justify-center items-stretch w-full">
                    <KpiCard label="Total Line Haul Cost" icon="fa-money-bill" />
                    <KpiCard label="Line Haul CPS" icon="fa-sliders-h" />
                    <LineHaulVolumeValue files={files} />
                  </div>
                </div>
                {/* Line Haul Cost chart */}
                <div className="bg-[var(--white)] border-2 border-[var(--secondaryMain)] rounded-2xl p-8 mt-10 mb-8 w-full max-w-6xl mx-auto">
                  <div className="text-lg font-bold subtitle-custom text-[var(--secondaryMain)] text-center mb-4">Line Haul Cost</div>
                  <div className="h-72 flex items-center justify-center">
                    <canvas id="linehaul-cost-chart" width="700" height="250"></canvas>
                  </div>
                </div>
                {/* Line Haul CPS chart */}
                <div className="bg-[var(--white)] border-2 border-[var(--secondaryMain)] rounded-2xl p-8 mb-8 w-full max-w-6xl mx-auto">
                  <div className="text-lg font-bold subtitle-custom text-[var(--secondaryMain)] text-center mb-4">Line Haul CPS</div>
                  <div className="h-72 flex items-center justify-center">
                    <canvas id="linehaul-cps-chart" width="700" height="250"></canvas>
                  </div>
                </div>
                {/* Line Haul Volume chart */}
                <div className="bg-[var(--white)] border-2 border-[var(--secondaryMain)] rounded-2xl p-8 mb-8 w-full max-w-6xl mx-auto">
                  <div className="text-lg font-bold subtitle-custom text-[var(--secondaryMain)] text-center mb-4">Line Haul Volume</div>
                  <div className="h-72 flex items-center justify-center">
                    <canvas id="linehaul-volume-chart" width="700" height="250"></canvas>
                  </div>
                </div>
                {/* Line Haul Cost per Hub charts */}
                <div className="bg-[var(--white)] border-2 border-[var(--secondaryMain)] rounded-2xl shadow-lg p-10 w-full max-w-6xl mx-auto mt-10">
                  <div className="text-lg font-bold subtitle-custom text-[var(--secondaryMain)] text-center mb-8">Line Haul Cost per Hub</div>
                  <div className="flex flex-col md:flex-row gap-8 justify-center items-stretch">
                    <div className="flex-1 flex flex-col items-center justify-center min-w-[260px] max-w-lg">
                      <canvas id="linehaul-cost-hub-bar" width="320" height="320"></canvas>
                    </div>
                    <div className="flex-1 flex flex-col items-center justify-center min-w-[260px] max-w-lg">
                      <canvas id="linehaul-cost-hub-pie" width="320" height="320"></canvas>
                    </div>
                  </div>
                </div>
                {/* Line Haul Volumes per Hub chart */}
                <div className="bg-[var(--white)] border-2 border-[var(--secondaryMain)] rounded-2xl shadow-lg p-10 w-full max-w-6xl mx-auto mt-10">
                  <div className="text-lg font-bold subtitle-custom text-[var(--secondaryMain)] text-center mb-8">Line Haul Volumes per Hub</div>
                  <div className="flex flex-col items-center justify-center w-full">
                    <canvas id="linehaul-volume-hub-bar" width="700" height="320"></canvas>
                  </div>
                </div>
              </section>
            )}
            {selectedTab === 'lhgap' && (
              <section>
                <h2 className="text-4xl font-extrabold mb-2 text-[var(--secondaryMain)] text-center">Line Haul Gap Analysis</h2>
                {/* LH Gap Analysis Metrics Group - now below the title */}
                <div className="bg-[var(--white)] border-2 border-[var(--secondaryMain)] rounded-2xl mb-10 w-full max-w-6xl mx-auto flex flex-col items-center justify-center py-12 gap-8">
                  <div className="text-lg font-bold subtitle-custom text-[var(--secondaryMain)] text-center mb-8">LH Gap Analysis Metrics</div>
                  <div className="flex flex-row flex-wrap gap-8 justify-center items-stretch w-full">
                    {/* Card 1: Ops LH Cost & System LH Cost */}
                    <div className="flex-1 min-w-[260px] max-w-xs card flex flex-row items-center justify-center text-center p-10 border-2 border-[var(--secondaryMain)] bg-[var(--white)] rounded-xl shadow-lg">
                      <div className="flex-1 flex flex-col items-center justify-center">
                        <i className="fa-solid fa-money-bill text-4xl mb-2 text-[var(--secondaryMain)]" />
                        <span className="font-semibold subtitle-custom text-[var(--text)]">Ops LH Cost</span>
                      </div>
                      <div className="h-12 w-px bg-[var(--secondaryMain)] mx-4" />
                      <div className="flex-1 flex flex-col items-center justify-center">
                        <i className="fa-solid fa-money-bill text-4xl mb-2 text-[var(--secondaryMain)]" />
                        <span className="font-semibold subtitle-custom text-[var(--text)]">System LH Cost</span>
                      </div>
                    </div>
                    {/* Card 2: Ops LH CPS & System LH CPS */}
                    <div className="flex-1 min-w-[260px] max-w-xs card flex flex-row items-center justify-center text-center p-10 border-2 border-[var(--secondaryMain)] bg-[var(--white)] rounded-xl shadow-lg">
                      <div className="flex-1 flex flex-col items-center justify-center">
                        <i className="fa-solid fa-sliders-h text-4xl mb-2 text-[var(--secondaryMain)]" />
                        <span className="font-semibold subtitle-custom text-[var(--text)]">Ops LH CPS</span>
                      </div>
                      <div className="h-12 w-px bg-[var(--secondaryMain)] mx-4" />
                      <div className="flex-1 flex flex-col items-center justify-center">
                        <i className="fa-solid fa-sliders-h text-4xl mb-2 text-[var(--secondaryMain)]" />
                        <span className="font-semibold subtitle-custom text-[var(--text)]">System LH CPS</span>
                      </div>
                    </div>
                    {/* Card 3: Ops LH Volume & System LH Volume */}
                    <div className="flex-1 min-w-[260px] max-w-xs card flex flex-row items-center justify-center text-center p-10 border-2 border-[var(--secondaryMain)] bg-[var(--white)] rounded-xl shadow-lg">
                      <div className="flex-1 flex flex-col items-center justify-center">
                        <i className="fa-solid fa-truck text-4xl mb-2 text-[var(--secondaryMain)]" />
                        <span className="font-semibold subtitle-custom text-[var(--text)]">Ops LH Volume</span>
                      </div>
                      <div className="h-12 w-px bg-[var(--secondaryMain)] mx-4" />
                      <div className="flex-1 flex flex-col items-center justify-center">
                        <i className="fa-solid fa-truck text-4xl mb-2 text-[var(--secondaryMain)]" />
                        <span className="font-semibold subtitle-custom text-[var(--text)]">System LH Volume</span>
                      </div>
                    </div>
                  </div>
                </div>
                {/* Line Haul CPS Chart */}
                <div className="mb-10 w-full max-w-6xl mx-auto">
                  <div className="bg-[var(--white)] border-2 border-[var(--secondaryMain)] rounded-2xl p-8 flex flex-col items-center justify-center">
                    <div className="text-lg font-bold subtitle-custom text-[var(--secondaryMain)] text-center mb-4">Line Haul CPS</div>
                    <canvas id="linehaul-cps-gap-chart" height="160"></canvas>
                  </div>
                </div>
                {/* Line Haul Cost Chart */}
                <div className="mb-10 w-full max-w-6xl mx-auto">
                  <div className="bg-[var(--white)] border-2 border-[var(--secondaryMain)] rounded-2xl p-8 flex flex-col items-center justify-center">
                    <div className="text-lg font-bold subtitle-custom text-[var(--secondaryMain)] text-center mb-4">Line Haul Cost</div>
                    <canvas id="linehaul-cost-gap-chart" height="160"></canvas>
                  </div>
                </div>
                {/* Line Haul Volume Chart */}
                <div className="mb-10 w-full max-w-6xl mx-auto">
                  <div className="bg-[var(--white)] border-2 border-[var(--secondaryMain)] rounded-2xl p-8 flex flex-col items-center justify-center">
                    <div className="text-lg font-bold subtitle-custom text-[var(--secondaryMain)] text-center mb-4">Line Haul Volume</div>
                    <canvas id="linehaul-volume-gap-chart" height="160"></canvas>
                  </div>
                </div>
              </section>
            )}
            {selectedTab === 'pps' && (
              <section>
                <h2 className="text-4xl font-extrabold mb-2 text-[var(--secondaryMain)] text-center">PPS Breakdown by Tier and Vendor</h2>
                {/* PPS Metrics Group */}
                <div className="bg-[var(--white)] border-2 border-[var(--secondaryMain)] rounded-2xl mb-10 w-full max-w-6xl mx-auto flex flex-col items-center justify-center py-12 gap-8">
                  <div className="text-lg font-bold subtitle-custom text-[var(--secondaryMain)] text-center mb-8">PPS Metrics</div>
                  <div className="flex flex-row flex-wrap justify-center gap-8 w-full">
                    <PpsKpiCards files={files} />
                  </div>
                </div>
                {/* PPS Cost per Tier Table */}
                <div className="bg-[var(--white)] border-2 border-[var(--secondaryMain)] rounded-2xl p-8 mb-10 w-full max-w-6xl mx-auto">
                  <div className="text-lg font-bold subtitle-custom text-center mb-4">PPS cost per Tier</div>
                  <PpsTierTable files={files} />
                </div>
                {/* PPS Cost per Vendor Table */}
                <div className="bg-[var(--white)] border-2 border-[var(--secondaryMain)] rounded-2xl p-8 mb-10 w-full max-w-6xl mx-auto">
                  <div className="text-lg font-bold subtitle-custom text-center mb-4">PPS Cost per Vendor</div>
                  <div className="overflow-x-auto">
                    <table className="min-w-full text-left text-[var(--text)] border-separate border-spacing-y-2">
                      <thead>
                        <tr>
                          <th className="px-4 py-2">PPS Vendor</th>
                          <th className="px-4 py-2">DMM</th>
                          <th className="px-4 py-2">JED</th>
                          <th className="px-4 py-2">KAM</th>
                          <th className="px-4 py-2">MED</th>
                          <th className="px-4 py-2">QAS</th>
                          <th className="px-4 py-2">RUH</th>
                          <th className="px-4 py-2">Total</th>
                        </tr>
                      </thead>
                      <tbody>
                        {/* Table body intentionally left empty */}
                      </tbody>
                    </table>
                  </div>
                </div>
                {/* Volumes per Vendor Table */}
                <div className="bg-[var(--white)] border-2 border-[var(--secondaryMain)] rounded-2xl p-8 mb-10 w-full max-w-6xl mx-auto">
                  <div className="text-lg font-bold subtitle-custom text-center mb-4">Volumes per Vendor</div>
                  <div className="overflow-x-auto">
                    <table className="min-w-full text-left text-[var(--text)] border-separate border-spacing-y-2">
                      <thead>
                        <tr>
                          <th className="px-4 py-2">PPS Vendor</th>
                          <th className="px-4 py-2">DMM</th>
                          <th className="px-4 py-2">JED</th>
                          <th className="px-4 py-2">KAM</th>
                          <th className="px-4 py-2">MED</th>
                          <th className="px-4 py-2">QAS</th>
                          <th className="px-4 py-2">RUH</th>
                          <th className="px-4 py-2">Total</th>
                        </tr>
                      </thead>
                      <tbody>
                        {/* Table body intentionally left empty */}
                      </tbody>
                    </table>
                  </div>
                </div>
                {/* CPS per Vendor Table */}
                <div className="bg-[var(--white)] border-2 border-[var(--secondaryMain)] rounded-2xl p-8 mb-10 w-full max-w-6xl mx-auto">
                  <div className="text-lg font-bold subtitle-custom text-center mb-4">CPS per Vendor</div>
                  <div className="overflow-y-auto max-h-64">
                    <table className="min-w-full text-left text-[var(--text)] border-separate border-spacing-y-2">
                      <thead>
                        <tr>
                          <th className="px-4 py-2">PPS Vendor</th>
                          <th className="px-4 py-2">PPS CPS</th>
                        </tr>
                      </thead>
                      <tbody>
                        {/* Table body intentionally left empty */}
                      </tbody>
                    </table>
                  </div>
                </div>
                {/* Cost by Vendor Pie Chart */}
                <div className="bg-[var(--white)] border-2 border-[var(--secondaryMain)] rounded-2xl p-8 mb-10 w-full max-w-6xl mx-auto flex flex-col items-center justify-center">
                  <div className="text-lg font-bold subtitle-custom text-center mb-4">Cost by Vendor</div>
                  <canvas id="pps-cost-pie" width="320" height="220"></canvas>
                </div>
                {/* CPS per Hub Row */}
                <div className="bg-[var(--white)] border-2 border-[var(--secondaryMain)] rounded-2xl p-6 mb-10 w-full max-w-6xl mx-auto flex flex-col items-center justify-center">
                  <div className="text-lg font-bold subtitle-custom text-center mb-4">CPS per Hub</div>
                  <div className="bg-[var(--white)] border-2 border-[var(--secondaryMain)] rounded-2xl p-6 mb-10 w-full max-w-6xl mx-auto flex flex-col items-center justify-center">
                    <div className="overflow-x-auto w-full">
                      <table className="min-w-full text-left text-[var(--text)] border-separate border-spacing-y-2">
                        <thead>
                          <tr>
                            <th className="px-4 py-2">DMM</th>
                            <th className="px-4 py-2">JED</th>
                            <th className="px-4 py-2">KAM</th>
                            <th className="px-4 py-2">MED</th>
                            <th className="px-4 py-2">QAS</th>
                            <th className="px-4 py-2">RUH</th>
                            <th className="px-4 py-2">Total</th>
                          </tr>
                        </thead>
                        <tbody>
                          {/* Table body intentionally left empty */}
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </section>
            )}
            {selectedTab === 'tpl' && (
              <section>
                <h2 className="text-4xl font-extrabold mb-2 text-[var(--secondaryMain)] text-center">3PL Breakdown by Courier Partner</h2>
                <div className="bg-[var(--white)] border-2 border-[var(--secondaryMain)] rounded-2xl mb-10 w-full max-w-6xl mx-auto flex flex-col items-center justify-center py-12 gap-8">
                  <div className="text-lg font-bold subtitle-custom text-center mb-8">3PL Metrics</div>
                  <div className="flex flex-row flex-wrap gap-8 justify-center items-stretch w-full">
                    <TplKpiCards files={files} />
                  </div>
                </div>
                {/* 3PL Cost per Tier Table */}
                <div className="bg-[var(--white)] border-2 border-[var(--secondaryMain)] rounded-2xl p-8 mb-10 w-full max-w-6xl mx-auto">
                  <div className="text-lg font-bold subtitle-custom text-center mb-4">3PL cost per Tier</div>
                  <TplTierTable files={files} />
                </div>
                {/* 3PL Cost per Courier Partner Table */}
                <div className="bg-[var(--white)] border-2 border-[var(--secondaryMain)] rounded-2xl mb-10 w-full max-w-6xl mx-auto px-4 py-8">
                  <div className="text-lg font-bold subtitle-custom text-center mb-6">3PL Cost per Courier Partner</div>
                  <div className="overflow-x-auto">
                    <table className="min-w-full text-left text-[var(--text)] border-separate border-spacing-y-2 w-full">
                      <thead>
                        <tr>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">Courier Partner</th>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">DMM</th>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">JED</th>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">KAM</th>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">MED</th>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">QAS</th>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">RUH</th>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">Total</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td className="px-6 py-4 text-[var(--textSecondary)]">[Placeholder]</td>
                          <td className="px-6 py-4 text-[var(--textSecondary)]"></td>
                          <td className="px-6 py-4 text-[var(--textSecondary)]"></td>
                          <td className="px-6 py-4 text-[var(--textSecondary)]"></td>
                          <td className="px-6 py-4 text-[var(--textSecondary)]"></td>
                          <td className="px-6 py-4 text-[var(--textSecondary)]"></td>
                          <td className="px-6 py-4 text-[var(--textSecondary)]"></td>
                          <td className="px-6 py-4 text-[var(--textSecondary)]"></td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
                {/* Volumes per Courier Table */}
                <div className="bg-[var(--white)] border-2 border-[var(--secondaryMain)] rounded-2xl mb-10 w-full max-w-6xl mx-auto px-4 py-8">
                  <div className="text-lg font-bold subtitle-custom text-center mb-6">Volumes per Courier</div>
                  <div className="overflow-x-auto">
                    <table className="min-w-full text-left text-[var(--text)] border-separate border-spacing-y-2 w-full">
                      <thead>
                        <tr>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">Courier Partner</th>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">DMM</th>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">JED</th>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">KAM</th>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">MED</th>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">QAS</th>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">RUH</th>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">Total</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td className="px-6 py-4 text-[var(--textSecondary)]">[Placeholder]</td>
                          <td className="px-6 py-4 text-[var(--textSecondary)]"></td>
                          <td className="px-6 py-4 text-[var(--textSecondary)]"></td>
                          <td className="px-6 py-4 text-[var(--textSecondary)]"></td>
                          <td className="px-6 py-4 text-[var(--textSecondary)]"></td>
                          <td className="px-6 py-4 text-[var(--textSecondary)]"></td>
                          <td className="px-6 py-4 text-[var(--textSecondary)]"></td>
                          <td className="px-6 py-4 text-[var(--textSecondary)]"></td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
                {/* CPS per Courier Partner Table */}
                <div className="bg-[var(--white)] border-2 border-[var(--secondaryMain)] rounded-2xl mb-10 w-full max-w-6xl mx-auto px-4 py-8">
                  <div className="text-lg font-bold subtitle-custom text-center mb-6">CPS per Courier Partner</div>
                  <div className="overflow-x-auto">
                    <table className="min-w-full text-left text-[var(--text)] border-separate border-spacing-y-2 w-full">
                      <thead>
                        <tr>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">Courier Partner</th>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">3PL CPS</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td className="px-6 py-4 text-[var(--textSecondary)]">[Placeholder]</td>
                          <td className="px-6 py-4 text-[var(--textSecondary)]"></td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
                {/* CPS per Hub Table */}
                <div className="bg-[var(--white)] border-2 border-[var(--secondaryMain)] rounded-2xl mb-10 w-full max-w-6xl mx-auto px-4 py-8">
                  <div className="text-lg font-bold subtitle-custom text-center mb-6">CPS per Hub</div>
                  <div className="overflow-x-auto">
                    <table className="min-w-full text-left text-[var(--text)] border-separate border-spacing-y-2 w-full">
                      <thead>
                        <tr>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">DMM</th>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">JED</th>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">KAM</th>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">MED</th>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">QAS</th>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">RUH</th>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">Total</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td className="px-6 py-4 text-[var(--textSecondary)]">[Placeholder]</td>
                          <td className="px-6 py-4 text-[var(--textSecondary)]"></td>
                          <td className="px-6 py-4 text-[var(--textSecondary)]"></td>
                          <td className="px-6 py-4 text-[var(--textSecondary)]"></td>
                          <td className="px-6 py-4 text-[var(--textSecondary)]"></td>
                          <td className="px-6 py-4 text-[var(--textSecondary)]"></td>
                          <td className="px-6 py-4 text-[var(--textSecondary)]"></td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
                {/* Cost by Courier Partner Pie Chart */}
                <div className="bg-[var(--white)] border-2 border-[var(--secondaryMain)] rounded-2xl p-8 mb-10 w-full max-w-3xl mx-auto flex flex-col items-center justify-center">
                  <div className="text-lg font-bold subtitle-custom text-center mb-4">Cost by Courier Partner</div>
                  <div className="text-center text-[var(--textSecondary)] py-8">[Pie Chart Placeholder]</div>
                </div>
              </section>
            )}
            {selectedTab === 'mv' && (
              <section>
                <h2 className="text-4xl font-extrabold mb-2 text-[var(--secondaryMain)] text-center">M&V Breakdown</h2>
                <div className="bg-[var(--white)] border-2 border-[var(--secondaryMain)] rounded-2xl mb-10 w-full max-w-6xl mx-auto flex flex-col items-center justify-center py-12 gap-8">
                  <div className="text-lg font-bold subtitle-custom text-center mb-8">M&V Metrics</div>
                  <div className="flex flex-row flex-wrap gap-8 justify-center items-stretch w-full">
                    <MvKpiCards files={files} />
                  </div>
                </div>
                {/* M&V Cost per Tier Table */}
                <div className="bg-[var(--white)] border-2 border-[var(--secondaryMain)] rounded-2xl p-8 mb-10 w-full max-w-6xl mx-auto">
                  <div className="text-lg font-bold subtitle-custom text-center mb-4">M&V cost per Tier</div>
                  <MvTierTable files={files} />
                </div>
                {/* M&V Cost per Vendor Table */}
                <div className="bg-[var(--white)] border-2 border-[var(--secondaryMain)] rounded-2xl mb-10 w-full max-w-6xl mx-auto px-4 py-8">
                  <div className="text-lg font-bold subtitle-custom text-center mb-6">M&V Cost per Vendor</div>
                  <div className="overflow-x-auto">
                    <table className="min-w-full text-left text-[var(--text)] border-separate border-spacing-y-2 w-full">
                      <thead>
                        <tr>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">Vendor</th>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">DMM</th>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">JED</th>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">KAM</th>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">MED</th>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">QAS</th>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">RUH</th>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">Total</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td className="px-6 py-4 text-[var(--textSecondary)]">[Placeholder]</td>
                          <td className="px-6 py-4 text-[var(--textSecondary)]"></td>
                          <td className="px-6 py-4 text-[var(--textSecondary)]"></td>
                          <td className="px-6 py-4 text-[var(--textSecondary)]"></td>
                          <td className="px-6 py-4 text-[var(--textSecondary)]"></td>
                          <td className="px-6 py-4 text-[var(--textSecondary)]"></td>
                          <td className="px-6 py-4 text-[var(--textSecondary)]"></td>
                          <td className="px-6 py-4 text-[var(--textSecondary)]"></td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
                {/* Volumes per Vendor Table */}
                <div className="bg-[var(--white)] border-2 border-[var(--secondaryMain)] rounded-2xl mb-10 w-full max-w-6xl mx-auto px-4 py-8">
                  <div className="text-lg font-bold subtitle-custom text-center mb-6">Volumes per Vendor</div>
                  <div className="overflow-x-auto">
                    <table className="min-w-full text-left text-[var(--text)] border-separate border-spacing-y-2 w-full">
                      <thead>
                        <tr>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">Vendor</th>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">DMM</th>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">JED</th>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">KAM</th>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">MED</th>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">QAS</th>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">RUH</th>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">Total</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td className="px-6 py-4 text-[var(--textSecondary)]">[Placeholder]</td>
                          <td className="px-6 py-4 text-[var(--textSecondary)]"></td>
                          <td className="px-6 py-4 text-[var(--textSecondary)]"></td>
                          <td className="px-6 py-4 text-[var(--textSecondary)]"></td>
                          <td className="px-6 py-4 text-[var(--textSecondary)]"></td>
                          <td className="px-6 py-4 text-[var(--textSecondary)]"></td>
                          <td className="px-6 py-4 text-[var(--textSecondary)]"></td>
                          <td className="px-6 py-4 text-[var(--textSecondary)]"></td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
                {/* M&V CPS per Vendor Table */}
                <div className="bg-[var(--white)] border-2 border-[var(--secondaryMain)] rounded-2xl mb-10 w-full max-w-6xl mx-auto px-4 py-8">
                  <div className="text-lg font-bold subtitle-custom text-center mb-6">M&V CPS per Vendor</div>
                  <div className="overflow-x-auto">
                    <table className="min-w-full text-left text-[var(--text)] border-separate border-spacing-y-2 w-full">
                      <thead>
                        <tr>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">DMM</th>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">JED</th>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">KAM</th>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">MED</th>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">QAS</th>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">RUH</th>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">Total</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td className="px-6 py-4 text-[var(--textSecondary)]">[Placeholder]</td>
                          <td className="px-6 py-4 text-[var(--textSecondary)]"></td>
                          <td className="px-6 py-4 text-[var(--textSecondary)]"></td>
                          <td className="px-6 py-4 text-[var(--textSecondary)]"></td>
                          <td className="px-6 py-4 text-[var(--textSecondary)]"></td>
                          <td className="px-6 py-4 text-[var(--textSecondary)]"></td>
                          <td className="px-6 py-4 text-[var(--textSecondary)]"></td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
                {/* M&V CPS per Hub Table */}
                <div className="bg-[var(--white)] border-2 border-[var(--secondaryMain)] rounded-2xl mb-10 w-full max-w-6xl mx-auto px-4 py-8">
                  <div className="text-lg font-bold subtitle-custom text-center mb-6">M&V CPS per Hub</div>
                  <div className="overflow-x-auto">
                    <table className="min-w-full text-left text-[var(--text)] border-separate border-spacing-y-2 w-full">
                      <thead>
                        <tr>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">DMM</th>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">JED</th>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">KAM</th>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">MED</th>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">QAS</th>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">RUH</th>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">Total</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td className="px-6 py-4 text-[var(--textSecondary)]">[Placeholder]</td>
                          <td className="px-6 py-4 text-[var(--textSecondary)]"></td>
                          <td className="px-6 py-4 text-[var(--textSecondary)]"></td>
                          <td className="px-6 py-4 text-[var(--textSecondary)]"></td>
                          <td className="px-6 py-4 text-[var(--textSecondary)]"></td>
                          <td className="px-6 py-4 text-[var(--textSecondary)]"></td>
                          <td className="px-6 py-4 text-[var(--textSecondary)]"></td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </section>
            )}
            {selectedTab === 'hb' && (
              <section>
                <h2 className="text-4xl font-extrabold mb-2 text-[var(--secondaryMain)] text-center">Heavy and Bulky Breakdown</h2>
                <div className="bg-[var(--white)] border-2 border-[var(--secondaryMain)] rounded-2xl mb-10 w-full max-w-6xl mx-auto flex flex-col items-center justify-center py-12 gap-8">
                  <div className="text-lg font-bold subtitle-custom text-center mb-8">H&B Metrics</div>
                  <div className="flex flex-row flex-wrap gap-8 justify-center items-stretch w-full">
                    <HbKpiCards files={files} />
                  </div>
                </div>
                {/* H&B Cost per Tier Table */}
                <div className="bg-[var(--white)] border-2 border-[var(--secondaryMain)] rounded-2xl p-8 mb-10 w-full max-w-6xl mx-auto">
                  <div className="text-lg font-bold subtitle-custom text-center mb-4">H&B cost per Tier</div>
                  <HbTierTable files={files} />
                </div>
                {/* H&B Cost per Hub Table */}
                <div className="bg-[var(--white)] border-2 border-[var(--secondaryMain)] rounded-2xl mb-10 w-full max-w-6xl mx-auto px-4 py-8">
                  <div className="text-lg font-bold subtitle-custom text-center mb-6">H&B Cost per Hub</div>
                  <div className="overflow-x-auto">
                    <table className="min-w-full text-left text-[var(--text)] border-separate border-spacing-y-2 w-full">
                      <thead>
                        <tr>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">Actual Courier</th>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">DMM</th>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">JED</th>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">MED</th>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">QAS</th>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">RUH</th>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">Total</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td className="px-6 py-4 text-[var(--textSecondary)]">[Placeholder]</td>
                          <td className="px-6 py-4 text-[var(--textSecondary)]"></td>
                          <td className="px-6 py-4 text-[var(--textSecondary)]"></td>
                          <td className="px-6 py-4 text-[var(--textSecondary)]"></td>
                          <td className="px-6 py-4 text-[var(--textSecondary)]"></td>
                          <td className="px-6 py-4 text-[var(--textSecondary)]"></td>
                          <td className="px-6 py-4 text-[var(--textSecondary)]"></td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
                {/* CPS per Hub Table */}
                <div className="bg-[var(--white)] border-2 border-[var(--secondaryMain)] rounded-2xl mb-10 w-full max-w-6xl mx-auto px-4 py-8">
                  <div className="text-lg font-bold subtitle-custom text-center mb-6">CPS per Hub</div>
                  <div className="overflow-x-auto">
                    <table className="min-w-full text-left text-[var(--text)] border-separate border-spacing-y-2 w-full">
                      <thead>
                        <tr>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">DMM</th>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">JED</th>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">MED</th>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">QAS</th>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">RUH</th>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">Total</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td className="px-6 py-4 text-[var(--textSecondary)]">[Placeholder]</td>
                          <td className="px-6 py-4 text-[var(--textSecondary)]"></td>
                          <td className="px-6 py-4 text-[var(--textSecondary)]"></td>
                          <td className="px-6 py-4 text-[var(--textSecondary)]"></td>
                          <td className="px-6 py-4 text-[var(--textSecondary)]"></td>
                          <td className="px-6 py-4 text-[var(--textSecondary)]"></td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
                {/* Volumes per Vendor Table */}
                <div className="bg-[var(--white)] border-2 border-[var(--secondaryMain)] rounded-2xl mb-10 w-full max-w-6xl mx-auto px-4 py-8">
                  <div className="text-lg font-bold subtitle-custom text-center mb-6">Volumes per Vendor</div>
                  <div className="overflow-x-auto">
                    <table className="min-w-full text-left text-[var(--text)] border-separate border-spacing-y-2 w-full">
                      <thead>
                        <tr>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">Vendor</th>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">DMM</th>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">JED</th>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">KAM</th>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">MED</th>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">QAS</th>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">RUH</th>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">Total</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td className="px-6 py-4 text-[var(--textSecondary)]">[Placeholder]</td>
                          <td className="px-6 py-4 text-[var(--textSecondary)]"></td>
                          <td className="px-6 py-4 text-[var(--textSecondary)]"></td>
                          <td className="px-6 py-4 text-[var(--textSecondary)]"></td>
                          <td className="px-6 py-4 text-[var(--textSecondary)]"></td>
                          <td className="px-6 py-4 text-[var(--textSecondary)]"></td>
                          <td className="px-6 py-4 text-[var(--textSecondary)]"></td>
                          <td className="px-6 py-4 text-[var(--textSecondary)]"></td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </section>
            )}
            {selectedTab === 'volumes' && (
              <section>
                <h2 className="text-4xl font-extrabold mb-2 text-[var(--secondaryMain)] text-center">Volumes Breakdown</h2>
                <div className="bg-[var(--white)] border-2 border-[var(--secondaryMain)] rounded-2xl mb-10 w-full max-w-6xl mx-auto flex flex-col items-center justify-center py-12 gap-8">
                  <div className="text-lg font-bold subtitle-custom text-center mb-8">Volumes Metrics</div>
                  <div className="flex flex-row flex-wrap gap-8 justify-center items-stretch w-full">
                    <VolumesKpiCards files={files} />
                    <KpiCard label="RTO delivered %" icon="fa-rotate-left" />
                    <KpiCard label="FDDS %" icon="fa-percent" />
                  </div>
                </div>
                <DeliveredVolumeChart files={files} />
                {/* Stage-specific Volume per Hub Table */}
                <div className="bg-[var(--white)] border-2 border-[var(--secondaryMain)] rounded-2xl mb-10 w-full max-w-6xl mx-auto px-4 py-8">
                  <div className="text-lg font-bold subtitle-custom text-center mb-6">Stage-specific Volume per Hub</div>
                  <div className="overflow-x-auto">
                    <table className="min-w-full text-left text-[var(--text)] border-separate border-spacing-y-2 w-full">
                      <thead>
                        <tr>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">Hub Code</th>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">First Mile</th>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">Sort Center</th>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">Line Haul</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td className="px-6 py-4 text-[var(--textSecondary)]">[Placeholder]</td>
                          <td className="px-6 py-4 text-[var(--textSecondary)]"></td>
                          <td className="px-6 py-4 text-[var(--textSecondary)]"></td>
                          <td className="px-6 py-4 text-[var(--textSecondary)]"></td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
                {/* PPS Volumes per Vendor Table */}
                <div className="bg-[var(--white)] border-2 border-[var(--secondaryMain)] rounded-2xl mb-10 w-full max-w-6xl mx-auto px-4 py-8">
                  <div className="text-lg font-bold subtitle-custom text-center mb-6">PPS Volumes per Vendor</div>
                  <div className="overflow-x-auto">
                    <table className="min-w-full text-left text-[var(--text)] border-separate border-spacing-y-2 w-full">
                      <thead>
                        <tr>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">PPS Vendor</th>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">DMM</th>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">JED</th>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">KAM</th>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">MED</th>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">QAS</th>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">RUH</th>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">Total</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td className="px-6 py-4 text-[var(--textSecondary)]">[Placeholder]</td>
                          <td className="px-6 py-4 text-[var(--textSecondary)]"></td>
                          <td className="px-6 py-4 text-[var(--textSecondary)]"></td>
                          <td className="px-6 py-4 text-[var(--textSecondary)]"></td>
                          <td className="px-6 py-4 text-[var(--textSecondary)]"></td>
                          <td className="px-6 py-4 text-[var(--textSecondary)]"></td>
                          <td className="px-6 py-4 text-[var(--textSecondary)]"></td>
                          <td className="px-6 py-4 text-[var(--textSecondary)]"></td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
                {/* 3PL Volumes per Courier Partner Table */}
                <div className="bg-[var(--white)] border-2 border-[var(--secondaryMain)] rounded-2xl mb-10 w-full max-w-6xl mx-auto px-4 py-8">
                  <div className="text-lg font-bold subtitle-custom text-center mb-6">3PL Volumes per Courier Partner</div>
                  <div className="overflow-x-auto">
                    <table className="min-w-full text-left text-[var(--text)] border-separate border-spacing-y-2 w-full">
                      <thead>
                        <tr>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">Courier Partner</th>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">Volume</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td className="px-6 py-4 text-[var(--textSecondary)]">[Placeholder]</td>
                          <td className="px-6 py-4 text-[var(--textSecondary)]"></td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
                {/* M&V Volumes per Hub Table */}
                <div className="bg-[var(--white)] border-2 border-[var(--secondaryMain)] rounded-2xl mb-10 w-full max-w-6xl mx-auto px-4 py-8">
                  <div className="text-lg font-bold subtitle-custom text-center mb-6">M&V Volumes per Hub</div>
                  <div className="overflow-x-auto">
                    <table className="min-w-full text-left text-[var(--text)] border-separate border-spacing-y-2 w-full">
                      <thead>
                        <tr>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">Current Hub Code</th>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">Volume</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td className="px-6 py-4 text-[var(--textSecondary)]">[Placeholder]</td>
                          <td className="px-6 py-4 text-[var(--textSecondary)]"></td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </section>
            )}
            {selectedTab === 'customersvolumes' && (
              <section>
                <h2 className="text-4xl font-extrabold mb-2 text-[var(--secondaryMain)] text-center">Customer Volumes Breakdown</h2>

                {/* Volume by Customer bar chart */}
                <div className="bg-[var(--white)] border-2 border-[var(--secondaryMain)] rounded-2xl p-8 mb-10 w-full max-w-6xl mx-auto">
                  <div className="text-lg font-bold subtitle-custom text-center mb-6">Volume by Customer</div>
                  <Top5VolumeByCustomerChart files={files} />
                </div>

                {/* Monthly Actual Delivered Volume by Customer */}
                <div className="bg-[var(--white)] border-2 border-[var(--secondaryMain)] rounded-2xl mb-10 w-full max-w-6xl mx-auto px-4 py-8">
                  <div className="text-lg font-bold subtitle-custom text-center mb-6">Monthly Actual Delivered Volume by Customer</div>
                  <div className="overflow-x-auto">
                    <table className="min-w-full text-left text-[var(--text)] border-separate border-spacing-y-2 w-full">
                      <thead>
                        <tr>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">Customer Names</th>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">Jun</th>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">Total</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td className="px-6 py-4 text-[var(--textSecondary)]">[Placeholder]</td>
                          <td className="px-6 py-4 text-[var(--textSecondary)]"></td>
                          <td className="px-6 py-4 text-[var(--textSecondary)]"></td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
                {/* Monthly Target Volume by Customer */}
                <div className="bg-[var(--white)] border-2 border-[var(--secondaryMain)] rounded-2xl mb-10 w-full max-w-6xl mx-auto px-4 py-8">
                  <div className="text-lg font-bold subtitle-custom text-center mb-6">Monthly Target Volume by Customer</div>
                  <div className="overflow-x-auto">
                    <table className="min-w-full text-left text-[var(--text)] border-separate border-spacing-y-2 w-full">
                      <thead>
                        <tr>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">Customer Name</th>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">Apr</th>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">May</th>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">Jun</th>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">Total</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td className="px-6 py-4 text-[var(--textSecondary)]">[Placeholder]</td>
                          <td className="px-6 py-4 text-[var(--textSecondary)]"></td>
                          <td className="px-6 py-4 text-[var(--textSecondary)]"></td>
                          <td className="px-6 py-4 text-[var(--textSecondary)]"></td>
                          <td className="px-6 py-4 text-[var(--textSecondary)]"></td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
                {/* Daily Actual Delivered Volume by Customer */}
                <div className="bg-[var(--white)] border-2 border-[var(--secondaryMain)] rounded-2xl mb-10 w-full max-w-6xl mx-auto px-4 py-8">
                  <div className="text-lg font-bold subtitle-custom text-center mb-6">Daily Actual Delivered Volume by Customer</div>
                  <div className="overflow-x-auto">
                    <table className="min-w-full text-left text-[var(--text)] border-separate border-spacing-y-2 w-full">
                      <thead>
                        <tr>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">Customer Names</th>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">Jun</th>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">Total</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td className="px-6 py-4 text-[var(--textSecondary)]">[Placeholder]</td>
                          <td className="px-6 py-4 text-[var(--textSecondary)]"></td>
                          <td className="px-6 py-4 text-[var(--textSecondary)]"></td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
                {/* Daily Target Volume by Customer */}
                <div className="bg-[var(--white)] border-2 border-[var(--secondaryMain)] rounded-2xl mb-10 w-full max-w-6xl mx-auto px-4 py-8">
                  <div className="text-lg font-bold subtitle-custom text-center mb-6">Daily Target Volume by Customer</div>
                  <div className="overflow-x-auto">
                    <table className="min-w-full text-left text-[var(--text)] border-separate border-spacing-y-2 w-full">
                      <thead>
                        <tr>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">Customer Name</th>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">Apr</th>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">May</th>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">Jun</th>
                          <th className="px-6 py-3 font-bold text-base text-[var(--secondaryMain)] border-b-2 border-[var(--secondaryMain)]">Total</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td className="px-6 py-4 text-[var(--textSecondary)]">[Placeholder]</td>
                          <td className="px-6 py-4 text-[var(--textSecondary)]"></td>
                          <td className="px-6 py-4 text-[var(--textSecondary)]"></td>
                          <td className="px-6 py-4 text-[var(--textSecondary)]"></td>
                          <td className="px-6 py-4 text-[var(--textSecondary)]"></td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </section>
            )}
          </main>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('dashboard-root')).render(<Dashboard />);

    // Update SettingsFileUpload to accept files and setFiles as props
    function SettingsFileUpload({ files, setFiles }) {
      const handleChange = (e) => {
        setFiles(Array.from(e.target.files));
      };
      const handleRemove = (idx) => {
        setFiles(files => files.filter((_, i) => i !== idx));
      };
      return (
        <div>
          <div className="w-full max-w-lg card bg-[var(--white)] border-2 border-dashed border-[var(--secondaryMain)] rounded-2xl p-8 flex flex-col items-center justify-center shadow-lg">
            <label htmlFor="settings-file-upload" className="flex flex-col items-center justify-center w-full h-48 cursor-pointer">
              <i className="fa-solid fa-cloud-arrow-up text-5xl mb-4 text-[var(--secondaryMain)]" />
              <span className="font-bold text-lg mb-2 text-[var(--secondaryMain)]">Drop Excel files here or click to upload</span>
              <span className="text-[var(--textSecondary)] text-sm mb-2">(Supported: .xlsx, .xls, multiple allowed)</span>
              <input id="settings-file-upload" type="file" accept=".csv,.xlsx,.xls" className="hidden" multiple onChange={handleChange} />
            </label>
          </div>
          {files.length > 0 && (
            <div className="w-full max-w-lg mt-4 card bg-[var(--white)] border-2 border-[var(--secondaryMain)] rounded-xl p-4 shadow flex flex-col" style={{ background: 'rgba(255,255,255,0.04)' }}>
              <span className="font-bold text-[var(--secondaryMain)] mb-3">Selected files:</span>
              <ul className="text-[var(--textSecondary)] space-y-2">
                {files.map((file, idx) => (
                  <li key={idx} className="flex items-center gap-3 px-2 py-1 rounded hover:bg-[var(--white)] transition-all" style={{ minWidth: 0 }}>
                    <i className="fa-regular fa-file-excel text-xl text-[var(--secondaryMain)] flex-shrink-0" />
                    <span className="truncate font-medium" style={{ maxWidth: '180px' }} title={file.name}>{file.name}</span>
                    <span className="ml-auto text-xs text-[var(--textSecondary)] opacity-80 flex-shrink-0">{(file.size / 1024).toFixed(1)} KB</span>
                    <button
                      className="ml-3 px-2 py-1 rounded-full bg-[var(--secondaryMain)] text-[var(--neutral)] text-xs font-bold hover:bg-[var(--secondaryHover)] transition-colors"
                      title="Remove file"
                      onClick={() => handleRemove(idx)}
                      type="button"
                    >
                      
                    </button>
                  </li>
                ))}
              </ul>
            </div>
          )}
        </div>
      );
    }

    // Update PnLTable to accept files as prop and let user select which file to use
    function PnLTable({ files }) {
      const [columns] = React.useState([
        'Date', 'Delivered Volume', 'RTO Delivered Volume', 'Un-Delivered Volume', 'Total Revenue',
        'FM cost', 'LH Cost', 'SC cost', 'PPS Cost', '3PL Cost', 'M&V Cost', 'H&B Cost',
        'Total Cost', 'Gross Margin', 'Gross Margin %', 'RPS', 'CPS'
      ]);
      const [selectedFileIdx, setSelectedFileIdx] = React.useState(0);
      const [data, setData] = React.useState([]);
      const [error, setError] = React.useState("");

      React.useEffect(() => {
        setData([]);
        setError("");
        if (!files || files.length === 0) return;
        const file = files[selectedFileIdx] || files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = (evt) => {
          const data = new Uint8Array(evt.target.result);
          const workbook = window.XLSX.read(data, { type: 'array' });
          // Try to find a sheet with the most matching columns
          let bestSheet = null;
          let bestMatch = 0;
          workbook.SheetNames.forEach(sheetName => {
            const ws = workbook.Sheets[sheetName];
            const json = window.XLSX.utils.sheet_to_json(ws, { header: 1 });
            if (json.length > 0) {
              const sheetCols = json[0].map(c => (c || '').toString().trim());
              const match = columns.filter(col => sheetCols.includes(col)).length;
              if (match > bestMatch) {
                bestMatch = match;
                bestSheet = ws;
              }
            }
          });
          if (!bestSheet) {
            setError("No matching sheet found with the required columns.");
            setData([]);
            return;
          }
          // Parse the best sheet
          const json = window.XLSX.utils.sheet_to_json(bestSheet, { defval: '', raw: false });
          // Only keep the desired columns
          const filtered = json.map(row => {
            const obj = {};
            columns.forEach(col => { obj[col] = row[col] || ''; });
            return obj;
          });
          setData(filtered);
        };
        reader.readAsArrayBuffer(file);
      }, [files, selectedFileIdx]);

      return (
        <div>
          <div className="mb-6 w-full max-w-lg mx-auto">
            {(!files || files.length === 0) ? (
              <div className="text-center text-[var(--textSecondary)]">No files uploaded. Please upload files in Settings.</div>
            ) : (
              <div className="mb-4">
                <label className="font-bold text-[var(--secondaryMain)] mr-2">Select file:</label>
                <select
                  className="bg-[var(--white)] border-2 border-[var(--secondaryMain)] rounded px-3 py-1 text-[var(--textSecondary)]"
                  value={selectedFileIdx}
                  onChange={e => setSelectedFileIdx(Number(e.target.value))}
                >
                  {files.map((file, idx) => (
                    <option value={idx} key={file.name}>{file.name}</option>
                  ))}
                </select>
              </div>
            )}
            {error && <div className="text-red-400 mt-2 text-center">{error}</div>}
          </div>
          <div className="table-container bg-[var(--white)] rounded-xl shadow p-4 border-2 border-[var(--secondaryMain)] overflow-x-auto">
            <table className="min-w-full text-sm rounded-xl">
              <thead>
                <tr>
                  {columns.map(col => <th key={col}>{col}</th>)}
                </tr>
              </thead>
              <tbody>
                {data.length === 0 ? (
                  <tr><td colSpan={columns.length} className="text-center text-[var(--textSecondary)]">No data loaded. Please select a file.</td></tr>
                ) : (
                  data.map((row, i) => (
                    <tr key={i}>
                      {columns.map(col => <td key={col}>{row[col]}</td>)}
                    </tr>
                  ))
                )}
              </tbody>
            </table>
          </div>
        </div>
      );
    }

    // --- Add this new component before the Dashboard function ---
    function KpiCard({ label, icon, value, desc }) {
      return (
        <div className="relative flex-1 min-w-[180px] max-w-[340px] card flip-in flex flex-col items-center justify-center text-center p-8 border-2 border-[var(--secondaryMain)] bg-[var(--white)] overflow-hidden">
          <div className="text-base font-bold subtitle-custom mb-2 z-10">{label}</div>
          {value !== undefined ? (
            <span className="text-4xl font-extrabold text-[var(--primaryMain)] z-10 mb-1">{value}</span>
          ) : null}
          {desc ? <div className="kpi-desc z-10 mt-1">{desc}</div> : null}
          <i className={`fa-solid ${icon} absolute opacity-10 text-[7rem] left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 pointer-events-none`} />
        </div>
      );
    }

    // ... existing code ...
    // Helper to sum G column from PapaParse results
    function sumGFromPapa(results) {
      try {
        let gKey = Object.keys(results.data[0])[7];
        for (const key of Object.keys(results.data[0])) {
          if (key.trim().toUpperCase() === 'H') gKey = key;
        }
        let sum = 0;
        for (const row of results.data) {
          const val = row[gKey];
          if (val !== undefined && val !== null && val !== "") {
            const num = Number(val.toString().replace(/,/g, ''));
            if (!isNaN(num)) sum += num;
          }
        }
        setVolume(sum);
      } catch (e) {
        setError("Error parsing CSV: " + e.message);
        setVolume(null);
      }
      setLoading(false);
    }

    if (file.name.endsWith('.csv')) {
      // Handle CSV with PapaParse
      window.Papa.parse(file, {
        header: true,
        skipEmptyLines: true,
        complete: sumGFromPapa,
        error: (err) => {
          setError("Error reading CSV: " + err.message);
          setVolume(null);
          setLoading(false);
        }
      });
    } else {
      // Handle Excel: convert DSHB sheet to CSV, then parse with PapaParse
      const reader = new FileReader();
      reader.onload = (evt) => {
        try {
          const data = new Uint8Array(evt.target.result);
          const workbook = window.XLSX.read(data, { type: 'array' });
          const sheet = workbook.Sheets['DSHB'];
          if (!sheet) {
            setError("No 'DSHB' sheet found.");
            setVolume(null);
            setLoading(false);
            return;
          }
          // Convert DSHB sheet to CSV string
          const csv = window.XLSX.utils.sheet_to_csv(sheet);
          // Parse CSV string with PapaParse
          window.Papa.parse(csv, {
            header: true,
            skipEmptyLines: true,
            complete: sumGFromPapa,
            error: (err) => {
              setError("Error reading Excel: " + err.message);
              setVolume(null);
              setLoading(false);
            }
          });
        } catch (e) {
          setError("Error reading Excel: " + e.message);
          setVolume(null);
          setLoading(false);
        }
      };
      reader.readAsArrayBuffer(file);
    }
    // ... existing code ...

    // --- Add this new component before the Dashboard function ---
    function PpsKpiCards({ files }) {
      const [cost, setCost] = React.useState(null);
      const [volume, setVolume] = React.useState(null);
      const [cps, setCps] = React.useState(null);
      const [loading, setLoading] = React.useState(false);
      const [error, setError] = React.useState("");

      React.useEffect(() => {
        if (!files || files.length === 0) {
          setCost(null);
          setVolume(null);
          setCps(null);
          setError("");
          return;
        }
        const file = files[0];
        setLoading(true);
        setError("");

        function parsePpsFromPapa(results) {
          try {
            let vKey = Object.keys(results.data[0])[22]; // W = 22
            let mKey = Object.keys(results.data[0])[13]; // N = 13
            for (const key of Object.keys(results.data[0])) {
              if (key.trim().toUpperCase() === 'W') vKey = key;
              if (key.trim().toUpperCase() === 'N') mKey = key;
            }
            let costSum = 0, volSum = 0;
            for (const row of results.data) {
              const vVal = row[vKey];
              const mVal = row[mKey];
              if (vVal !== undefined && vVal !== null && vVal !== "") {
                const num = Number(vVal.toString().replace(/,/g, ''));
                if (!isNaN(num)) costSum += num;
              }
              if (mVal !== undefined && mVal !== null && mVal !== "") {
                const num = Number(mVal.toString().replace(/,/g, ''));
                if (!isNaN(num)) volSum += num;
              }
            }
            setCost(costSum);
            setVolume(volSum);
            setCps(volSum !== 0 ? costSum / volSum : null);
          } catch (e) {
            setError("Error parsing CSV: " + e.message);
            setCost(null);
            setVolume(null);
            setCps(null);
          }
          setLoading(false);
        }

        if (file.name.endsWith('.csv')) {
          window.Papa.parse(file, {
            header: true,
            skipEmptyLines: true,
            complete: parsePpsFromPapa,
            error: (err) => {
              setError("Error reading CSV: " + err.message);
              setCost(null);
              setVolume(null);
              setCps(null);
              setLoading(false);
            }
          });
        } else {
          const reader = new FileReader();
          reader.onload = (evt) => {
            try {
              const data = new Uint8Array(evt.target.result);
              const workbook = window.XLSX.read(data, { type: 'array' });
              const sheet = workbook.Sheets['DSHB'];
              if (!sheet) {
                setError("No 'DSHB' sheet found.");
                setCost(null);
                setVolume(null);
                setCps(null);
                setLoading(false);
                return;
              }
              const csv = window.XLSX.utils.sheet_to_csv(sheet);
              window.Papa.parse(csv, {
                header: true,
                skipEmptyLines: true,
                complete: parsePpsFromPapa,
                error: (err) => {
                  setError("Error reading CSV: " + err.message);
                  setCost(null);
                  setVolume(null);
                  setCps(null);
                  setLoading(false);
                }
              });
            } catch (e) {
              setError("Error reading file: " + e.message);
              setCost(null);
              setVolume(null);
              setCps(null);
              setLoading(false);
            }
          };
          reader.readAsArrayBuffer(file);
        }
      }, [files]);

      return (
        <div className="flex flex-row flex-wrap justify-center gap-8 w-full">
          <KpiCard label="Total PPS Cost" icon="fa-money-bill" value={loading ? '...' : (cost !== null ? <span style={{ color: 'var(--secondaryMain)' }}>{cost.toLocaleString()}</span> : undefined)} />
          <KpiCard label="PPS CPS" icon="fa-sliders-h" value={loading ? '...' : (cps !== null ? <span style={{ color: 'var(--secondaryMain)' }}>{cps.toLocaleString(undefined, { maximumFractionDigits: 2 })}</span> : undefined)} />
          <KpiCard label="PPS Volume" icon="fa-truck" value={loading ? '...' : (volume !== null ? <span style={{ color: 'var(--secondaryMain)' }}>{volume.toLocaleString()}</span> : undefined)} />
        </div>
      );
    }
    // ... existing code ...
    // In the 3PL tab, replace the static metric cards with <TplKpiCards files={files} />
    // ... existing code ...

    // --- Add this new component before the Dashboard function ---
    function TplKpiCards({ files }) {
      const [cost, setCost] = React.useState(null);
      const [volume, setVolume] = React.useState(null);
      const [cps, setCps] = React.useState(null);
      const [loading, setLoading] = React.useState(false);
      const [error, setError] = React.useState("");

      React.useEffect(() => {
        if (!files || files.length === 0) {
          setCost(null);
          setVolume(null);
          setCps(null);
          setError("");
          return;
        }
        const file = files[0];
        setLoading(true);
        setError("");

        function sumColsFromPapa(results) {
          try {
            let costKey = Object.keys(results.data[0])[32]; // AG
            let volKey = Object.keys(results.data[0])[15]; // P
            for (const key of Object.keys(results.data[0])) {
              if (key.trim().toUpperCase() === 'AG') costKey = key;
              if (key.trim().toUpperCase() === 'P') volKey = key;
            }
            let costSum = 0, volSum = 0;
            for (const row of results.data) {
              const costVal = row[costKey];
              const volVal = row[volKey];
              if (costVal !== undefined && costVal !== null && costVal !== "") {
                const num = Number(costVal.toString().replace(/,/g, ''));
                if (!isNaN(num)) costSum += num;
              }
              if (volVal !== undefined && volVal !== null && volVal !== "") {
                const num = Number(volVal.toString().replace(/,/g, ''));
                if (!isNaN(num)) volSum += num;
              }
            }
            setCost(costSum);
            setVolume(volSum);
            setCps(volSum !== 0 ? costSum / volSum : null);
          } catch (e) {
            setError("Error parsing CSV: " + e.message);
            setCost(null);
            setVolume(null);
            setCps(null);
          }
          setLoading(false);
        }

        if (file.name.endsWith('.csv')) {
          window.Papa.parse(file, {
            header: true,
            skipEmptyLines: true,
            complete: sumColsFromPapa,
            error: (err) => {
              setError("Error reading CSV: " + err.message);
              setCost(null);
              setVolume(null);
              setCps(null);
              setLoading(false);
            }
          });
        } else {
          const reader = new FileReader();
          reader.onload = (evt) => {
            try {
              const data = new Uint8Array(evt.target.result);
              const workbook = window.XLSX.read(data, { type: 'array' });
              const sheet = workbook.Sheets['DSHB'];
              if (!sheet) {
                setError("No 'DSHB' sheet found.");
                setCost(null);
                setVolume(null);
                setCps(null);
                setLoading(false);
                return;
              }
              const csv = window.XLSX.utils.sheet_to_csv(sheet);
              window.Papa.parse(csv, {
                header: true,
                skipEmptyLines: true,
                complete: sumColsFromPapa,
                error: (err) => {
                  setError("Error reading Excel: " + err.message);
                  setCost(null);
                  setVolume(null);
                  setCps(null);
                  setLoading(false);
                }
              });
            } catch (e) {
              setError("Error reading Excel: " + e.message);
              setCost(null);
              setVolume(null);
              setCps(null);
              setLoading(false);
            }
          };
          reader.readAsArrayBuffer(file);
        }
      }, [files]);

      return (
        <div className="flex flex-row flex-wrap justify-center gap-8 w-full">
          <KpiCard label="Total 3PL Cost" icon="fa-dolly" value={loading ? '...' : (cost !== null ? <span style={{ color: 'var(--secondaryMain)' }}>{cost.toLocaleString()}</span> : undefined)} />
          <KpiCard label="3PL CPS" icon="fa-sliders-h" value={loading ? '...' : (cps !== null ? <span style={{ color: 'var(--secondaryMain)' }}>{cps.toLocaleString(undefined, { maximumFractionDigits: 2 })}</span> : undefined)} />
          <KpiCard label="3PL Volume" icon="fa-box" value={loading ? '...' : (volume !== null ? <span style={{ color: 'var(--secondaryMain)' }}>{volume.toLocaleString()}</span> : undefined)} />
          {error && <div className="text-red-400 text-sm font-semibold z-10 w-full text-center">{error}</div>}
        </div>
      );
    }
    // ... existing code ...
    // In the 3PL tab, replace the static metric cards with <TplKpiCards files={files} />
    // ... existing code ...

    // --- Add this new component before the Dashboard function ---
    function MvKpiCards({ files }) {
      const [cost, setCost] = React.useState(null);
      const [volume, setVolume] = React.useState(null);
      const [cps, setCps] = React.useState(null);
      const [loading, setLoading] = React.useState(false);
      const [error, setError] = React.useState("");

      React.useEffect(() => {
        if (!files || files.length === 0) {
          setCost(null);
          setVolume(null);
          setCps(null);
          setError("");
          return;
        }
        const file = files[0];
        setLoading(true);
        setError("");

        function sumColsFromPapa(results) {
          try {
            let costKey = Object.keys(results.data[0])[27]; // AB
            let volKey = Object.keys(results.data[0])[14]; // O
            for (const key of Object.keys(results.data[0])) {
              if (key.trim().toUpperCase() === 'AB') costKey = key;
              if (key.trim().toUpperCase() === 'O') volKey = key;
            }
            let costSum = 0, volSum = 0;
            for (const row of results.data) {
              const costVal = row[costKey];
              const volVal = row[volKey];
              if (costVal !== undefined && costVal !== null && costVal !== "") {
                const num = Number(costVal.toString().replace(/,/g, ''));
                if (!isNaN(num)) costSum += num;
              }
              if (volVal !== undefined && volVal !== null && volVal !== "") {
                const num = Number(volVal.toString().replace(/,/g, ''));
                if (!isNaN(num)) volSum += num;
              }
            }
            setCost(costSum);
            setVolume(volSum);
            setCps(volSum !== 0 ? costSum / volSum : null);
          } catch (e) {
            setError("Error parsing CSV: " + e.message);
            setCost(null);
            setVolume(null);
            setCps(null);
          }
          setLoading(false);
        }

        if (file.name.endsWith('.csv')) {
          window.Papa.parse(file, {
            header: true,
            skipEmptyLines: true,
            complete: sumColsFromPapa,
            error: (err) => {
              setError("Error reading CSV: " + err.message);
              setCost(null);
              setVolume(null);
              setCps(null);
              setLoading(false);
            }
          });
        } else {
          const reader = new FileReader();
          reader.onload = (evt) => {
            try {
              const data = new Uint8Array(evt.target.result);
              const workbook = window.XLSX.read(data, { type: 'array' });
              const sheet = workbook.Sheets['DSHB'];
              if (!sheet) {
                setError("No 'DSHB' sheet found.");
                setCost(null);
                setVolume(null);
                setCps(null);
                setLoading(false);
                return;
              }
              const csv = window.XLSX.utils.sheet_to_csv(sheet);
              window.Papa.parse(csv, {
                header: true,
                skipEmptyLines: true,
                complete: sumColsFromPapa,
                error: (err) => {
                  setError("Error reading Excel: " + err.message);
                  setCost(null);
                  setVolume(null);
                  setCps(null);
                  setLoading(false);
                }
              });
            } catch (e) {
              setError("Error reading Excel: " + e.message);
              setCost(null);
              setVolume(null);
              setCps(null);
              setLoading(false);
            }
          };
          reader.readAsArrayBuffer(file);
        }
      }, [files]);

      return (
        <div className="flex flex-row flex-wrap justify-center gap-8 w-full">
          <KpiCard label="M&V Cost" icon="fa-money-bill" value={loading ? '...' : (cost !== null ? <span style={{ color: 'var(--secondaryMain)' }}>{cost.toLocaleString()}</span> : undefined)} />
          <KpiCard label="M&V CPS" icon="fa-sliders-h" value={loading ? '...' : (cps !== null ? <span style={{ color: 'var(--secondaryMain)' }}>{cps.toLocaleString(undefined, { maximumFractionDigits: 2 })}</span> : undefined)} />
          <KpiCard label="M&V Volume" icon="fa-cubes" value={loading ? '...' : (volume !== null ? <span style={{ color: 'var(--secondaryMain)' }}>{volume.toLocaleString()}</span> : undefined)} />
          {error && <div className="text-red-400 text-sm font-semibold z-10 w-full text-center">{error}</div>}
        </div>
      );
    }
    // ... existing code ...
    // In the M&V tab, replace the static metric cards with <MvKpiCards files={files} />
    // ... existing code ...

    // --- Add this new component before the Dashboard function ---
    function HbKpiCards({ files }) {
      const [cost, setCost] = React.useState(null);
      const [volume, setVolume] = React.useState(null);
      const [cps, setCps] = React.useState(null);
      const [loading, setLoading] = React.useState(false);
      const [error, setError] = React.useState("");

      React.useEffect(() => {
        if (!files || files.length === 0) {
          setCost(null);
          setVolume(null);
          setCps(null);
          setError("");
          return;
        }
        const file = files[0];
        setLoading(true);
        setError("");

        function sumColsFromPapa(results) {
          try {
            let costKey = Object.keys(results.data[0])[37]; // AL
            let volKey = Object.keys(results.data[0])[16]; // Q
            for (const key of Object.keys(results.data[0])) {
              if (key.trim().toUpperCase() === 'AL') costKey = key;
              if (key.trim().toUpperCase() === 'Q') volKey = key;
            }
            let costSum = 0, volSum = 0;
            for (const row of results.data) {
              const costVal = row[costKey];
              const volVal = row[volKey];
              if (costVal !== undefined && costVal !== null && costVal !== "") {
                const num = Number(costVal.toString().replace(/,/g, ''));
                if (!isNaN(num)) costSum += num;
              }
              if (volVal !== undefined && volVal !== null && volVal !== "") {
                const num = Number(volVal.toString().replace(/,/g, ''));
                if (!isNaN(num)) volSum += num;
              }
            }
            setCost(costSum);
            setVolume(volSum);
            setCps(volSum !== 0 ? costSum / volSum : null);
          } catch (e) {
            setError("Error parsing CSV: " + e.message);
            setCost(null);
            setVolume(null);
            setCps(null);
          }
          setLoading(false);
        }

        if (file.name.endsWith('.csv')) {
          window.Papa.parse(file, {
            header: true,
            skipEmptyLines: true,
            complete: sumColsFromPapa,
            error: (err) => {
              setError("Error reading CSV: " + err.message);
              setCost(null);
              setVolume(null);
              setCps(null);
              setLoading(false);
            }
          });
        } else {
          const reader = new FileReader();
          reader.onload = (evt) => {
            try {
              const data = new Uint8Array(evt.target.result);
              const workbook = window.XLSX.read(data, { type: 'array' });
              const sheet = workbook.Sheets['DSHB'];
              if (!sheet) {
                setError("No 'DSHB' sheet found.");
                setCost(null);
                setVolume(null);
                setCps(null);
                setLoading(false);
                return;
              }
              const csv = window.XLSX.utils.sheet_to_csv(sheet);
              window.Papa.parse(csv, {
                header: true,
                skipEmptyLines: true,
                complete: sumColsFromPapa,
                error: (err) => {
                  setError("Error reading CSV: " + err.message);
                  setCost(null);
                  setVolume(null);
                  setCps(null);
                  setLoading(false);
                }
              });
            } catch (e) {
              setError("Error reading file: " + e.message);
              setCost(null);
              setVolume(null);
              setCps(null);
              setLoading(false);
            }
          };
          reader.readAsArrayBuffer(file);
        }
      }, [files]);

      return (
        <div className="flex flex-row flex-wrap justify-center gap-8 w-full">
          <KpiCard label="H&B Cost" icon="fa-money-bill" value={loading ? '...' : (cost !== null ? <span style={{ color: 'var(--secondaryMain)' }}>{cost.toLocaleString()}</span> : undefined)} />
          <KpiCard label="H&B CPS" icon="fa-sliders-h" value={loading ? '...' : (cps !== null ? <span style={{ color: 'var(--secondaryMain)' }}>{cps.toLocaleString(undefined, { maximumFractionDigits: 2 })}</span> : undefined)} />
          <KpiCard label="H&B Volume" icon="fa-box" value={loading ? '...' : (volume !== null ? <span style={{ color: 'var(--secondaryMain)' }}>{volume.toLocaleString()}</span> : undefined)} />
          {error && <div className="text-red-400 text-sm font-semibold z-10 w-full text-center">{error}</div>}
        </div>
      );
    }
    // ... existing code ...
    // In the H&B tab, replace the static metric cards with <HbKpiCards files={files} />
    // ... existing code ...

    // --- Add this new component before the Dashboard function ---
    function VolumesKpiCards({ files }) {
      const [delivered, setDelivered] = React.useState(null);
      const [loading, setLoading] = React.useState(false);
      const [error, setError] = React.useState("");

      React.useEffect(() => {
        if (!files || files.length === 0) {
          setDelivered(null);
          setError("");
          return;
        }
        const file = files[0];
        setLoading(true);
        setError("");

        function sumGFromPapa(results) {
          try {
            let gKey = Object.keys(results.data[0])[6]; // G = 6 (0-indexed)
            for (const key of Object.keys(results.data[0])) {
              if (key.trim().toUpperCase() === 'G') gKey = key;
            }
            let sum = 0;
            for (const row of results.data) {
              const val = row[gKey];
              if (val !== undefined && val !== null && val !== "") {
                const num = Number(val.toString().replace(/,/g, ''));
                if (!isNaN(num)) sum += num;
              }
            }
            setDelivered(sum);
          } catch (e) {
            setError("Error parsing CSV: " + e.message);
            setDelivered(null);
          }
          setLoading(false);
        }

        if (file.name.endsWith('.csv')) {
          window.Papa.parse(file, {
            header: true,
            skipEmptyLines: true,
            complete: sumGFromPapa,
            error: (err) => {
              setError("Error reading CSV: " + err.message);
              setDelivered(null);
              setLoading(false);
            }
          });
        } else {
          const reader = new FileReader();
          reader.onload = (evt) => {
            try {
              const data = new Uint8Array(evt.target.result);
              const workbook = window.XLSX.read(data, { type: 'array' });
              const sheet = workbook.Sheets['DSHB'];
              if (!sheet) {
                setError("No 'DSHB' sheet found.");
                setDelivered(null);
                setLoading(false);
                return;
              }
              const csv = window.XLSX.utils.sheet_to_csv(sheet);
              window.Papa.parse(csv, {
                header: true,
                skipEmptyLines: true,
                complete: sumGFromPapa,
                error: (err) => {
                  setError("Error reading Excel: " + err.message);
                  setDelivered(null);
                  setLoading(false);
                }
              });
            } catch (e) {
              setError("Error reading Excel: " + e.message);
              setDelivered(null);
              setLoading(false);
            }
          };
          reader.readAsArrayBuffer(file);
        }
      }, [files]);

      return (
        <div>
          <KpiCard label="Total Delivered Volume" icon="fa-truck" value={loading ? '...' : (delivered !== null ? <span style={{ color: 'var(--secondaryMain)' }}>{delivered.toLocaleString()}</span> : undefined)} />
          {error && <div className="text-red-400 text-sm font-semibold z-10 w-full text-center">{error}</div>}
        </div>
      );
    }
    // ... existing code ...
    // In the Volumes tab, replace the static 'Total Delivered Volume' card with <VolumesKpiCards files={files} />
    // ... existing code ...

    // --- Add this new component before the Dashboard function ---
    function DeliveredVolumeChart({ files }) {
      const chartRef = React.useRef(null);
      const [error, setError] = React.useState("");

      React.useEffect(() => {
        let chartInstance = null;
        // Helper to render the chart (with or without data)
        function renderChart(dataByDate) {
          const ctx = chartRef.current.getContext('2d');
          if (chartRef.current._chartInstance) {
            chartRef.current._chartInstance.destroy();
            chartRef.current._chartInstance = null;
          }
          const labels = dataByDate ? Object.keys(dataByDate) : [];
          const values = dataByDate ? Object.values(dataByDate) : [];
          chartRef.current._chartInstance = new window.Chart(ctx, {
            type: 'line',
            data: {
              labels,
              datasets: [{
                label: '', // No legend label
                data: values,
                fill: true,
                backgroundColor: 'rgba(255, 157, 24, 0.15)',
                borderColor: '#ff9d18',
                borderWidth: 3,
                pointRadius: 4,
                pointBackgroundColor: '#ff9d18',
                tension: 0.3,
              }],
            },
            options: {
              plugins: {
                legend: { display: false },
                tooltip: {
                  enabled: true,
                  titleFont: { family: 'Euclid Circular B', size: 14, weight: 'bold' },
                  bodyFont: { family: 'Euclid Circular B', size: 13 },
                  backgroundColor: '#222',
                  titleColor: '#ff9d18',
                  bodyColor: '#fff',
                },
                title: { display: false }, // Remove Chart.js title
              },
              layout: { padding: { top: 0, bottom: 0, left: 10, right: 10 } },
              scales: {
                x: {
                  title: { display: true, text: 'Date', color: '#fff', font: { family: 'Euclid Circular B', weight: 'bold', size: 16 } },
                  ticks: {
                    color: '#fff',
                    font: { family: 'Euclid Circular B', weight: 'bold', size: 13 },
                    callback: function (value, index, ticks) {
                      const raw = this.getLabelForValue(value);
                      let d = raw;
                      if (/^\d{5,}$/.test(raw)) {
                        const excelEpoch = new Date(Date.UTC(1899, 11, 30));
                        d = new Date(excelEpoch.getTime() + (parseInt(raw, 10) * 86400000));
                      } else if (!isNaN(Date.parse(raw))) {
                        d = new Date(raw);
                      }
                      if (d instanceof Date && !isNaN(d)) {
                        return d.toLocaleDateString('en-US', { month: 'short', day: '2-digit' });
                      }
                      return raw;
                    }
                  },
                  grid: { color: 'rgba(255,255,255,0.08)' },
                },
                y: {
                  title: { display: true, text: 'Sum of Delivery Count', color: '#fff', font: { family: 'Euclid Circular B', weight: 'bold', size: 16 } },
                  beginAtZero: true,
                  ticks: { color: '#fff', font: { family: 'Euclid Circular B', weight: 'bold', size: 13 } },
                  grid: { color: 'rgba(255,255,255,0.08)' },
                },
              },
            },
          });
        }

        if (!files || files.length === 0) {
          // Render empty chart with axes and grid
          renderChart(null);
          setError("");
          return;
        }
        const file = files[0];
        setError("");

        function processRows(rows) {
          const header = rows[0];
          let dateIdx = 0, volIdx = 6;
          for (let i = 0; i < header.length; ++i) {
            const col = (header[i] || '').toString().trim().toUpperCase();
            if (col === 'A' || col === 'DATE') dateIdx = i;
            if (col === 'G' || col === 'DELIVERED VOLUME') volIdx = i;
          }
          const dataByDate = {};
          for (let i = 1; i < rows.length; ++i) {
            const row = rows[i];
            const date = row[dateIdx];
            const val = row[volIdx];
            if (!date || val === undefined || val === null || val === "") continue;
            const num = Number(val.toString().replace(/,/g, ''));
            if (isNaN(num)) continue;
            let dateStr = date;
            if (typeof date === 'number' && date > 40000) {
              const excelEpoch = new Date(Date.UTC(1899, 11, 30));
              const jsDate = new Date(excelEpoch.getTime() + (date * 86400000));
              dateStr = jsDate.toISOString().slice(0, 10);
            } else if (typeof date === 'string' && /^\d{5,}$/.test(date)) {
              const excelEpoch = new Date(Date.UTC(1899, 11, 30));
              const jsDate = new Date(excelEpoch.getTime() + (parseInt(date, 10) * 86400000));
              dateStr = jsDate.toISOString().slice(0, 10);
            } else if (!isNaN(Date.parse(date))) {
              dateStr = new Date(date).toISOString().slice(0, 10);
            }
            dataByDate[dateStr] = (dataByDate[dateStr] || 0) + num;
          }
          // Filter out dates with zero volume
          const filteredDataByDate = Object.fromEntries(Object.entries(dataByDate).filter(([date, vol]) => vol > 0));
          renderChart(filteredDataByDate);
        }

        if (file.name.endsWith('.csv')) {
          window.Papa.parse(file, {
            header: false,
            skipEmptyLines: true,
            complete: (results) => processRows(results.data),
            error: (err) => setError("Error reading CSV: " + err.message),
          });
        } else {
          const reader = new FileReader();
          reader.onload = (evt) => {
            try {
              const data = new Uint8Array(evt.target.result);
              const workbook = window.XLSX.read(data, { type: 'array' });
              const sheet = workbook.Sheets['DSHB'];
              if (!sheet) {
                setError("No 'DSHB' sheet found.");
                return;
              }
              const rows = window.XLSX.utils.sheet_to_json(sheet, { header: 1 });
              processRows(rows);
            } catch (e) {
              setError("Error reading Excel: " + e.message);
            }
          };
          reader.readAsArrayBuffer(file);
        }
        // Cleanup on unmount
        return () => {
          if (chartRef.current && chartRef.current._chartInstance) {
            chartRef.current._chartInstance.destroy();
            chartRef.current._chartInstance = null;
          }
        };
      }, [files]);

      return (
        <div className="bg-[var(--white)] border-2 border-[var(--secondaryMain)] rounded-2xl mb-10 w-full max-w-6xl mx-auto flex flex-col items-center justify-center py-6 gap-4 mt-10">
          <div className="text-2xl font-extrabold subtitle-custom text-[#ff9d18] text-center mb-2" style={{ fontFamily: 'Euclid Circular B' }}>Delivered Volume</div>
          <canvas ref={chartRef} height="260" style={{ width: '100%', maxWidth: '900px', fontFamily: 'Euclid Circular B' }}></canvas>
          {error && <div className="text-red-400 text-sm font-semibold z-10 w-full text-center mt-2">{error}</div>}
        </div>
      );
    }
    // ... existing code ...
    // In the Volumes tab, render <DeliveredVolumeChart files={files} /> below the KPI cards
    // ... existing code ...

    // --- Add this new component before the Dashboard function ---
    function OverviewKpiCards({ files }) {
      const [totalCost, setTotalCost] = React.useState(null);
      const [totalRevenue, setTotalRevenue] = React.useState(null);
      const [loading, setLoading] = React.useState(false);
      const [error, setError] = React.useState("");
      const target = 500000; // Total Cost target
      const cashMarginTarget = 100000; // Cash Margin target

      // Variance for Total Cost
      let variance = undefined;
      let varianceColor = undefined;
      if (totalCost !== null && target) {
        const rawVar = ((totalCost - target) / target) * 100;
        variance = rawVar.toFixed(1) + '%';
        varianceColor = rawVar >= 0 ? '#1f6a4a' : '#8B0000';
      }

      // Calculate cashMargin
      const cashMargin = (totalRevenue !== null && totalCost !== null)
        ? (totalRevenue - totalCost)
        : null;

      // Variance for Cash Margin
      let cashMarginVariance = undefined;
      let cashMarginVarianceColor = undefined;
      if (cashMargin !== null && cashMarginTarget) {
        const rawVar = ((cashMargin - cashMarginTarget) / cashMarginTarget) * 100;
        cashMarginVariance = rawVar.toFixed(1) + '%';
        cashMarginVarianceColor = rawVar >= 0 ? '#1f6a4a' : '#8B0000';
      }

      React.useEffect(() => {
        if (!files || files.length === 0) {
          setTotalCost(null);
          setTotalRevenue(null);
          setError("");
          return;
        }
        const file = files[0];
        setLoading(true);
        setError("");

        function sumALFromPapa(results) {
          try {
            let alKey = Object.keys(results.data[0])[38]; // AM = 38 (0-indexed)
            for (const key of Object.keys(results.data[0])) {
              if (key.trim().toUpperCase() === 'AM') alKey = key;
            }
            let sum = 0;
            for (const row of results.data) {
              const val = row[alKey];
              if (val !== undefined && val !== null && val !== "") {
                const num = Number(val.toString().replace(/,/g, ''));
                if (!isNaN(num)) sum += num;
              }
            }
            setTotalCost(sum);
          } catch (e) {
            setError("Error parsing CSV: " + e.message);
            setTotalCost(null);
          }
          setLoading(false);
        }

        function sumAQFromPapa(results) {
          try {
            let aqKey = Object.keys(results.data[0])[43]; // AR = 43 (0-indexed)
            for (const key of Object.keys(results.data[0])) {
              if (key.trim().toUpperCase() === 'AR') aqKey = key;
            }
            let sum = 0;
            for (const row of results.data) {
              const val = row[aqKey];
              if (val !== undefined && val !== null && val !== "") {
                const num = Number(val.toString().replace(/,/g, ''));
                if (!isNaN(num)) sum += num;
              }
            }
            setTotalRevenue(sum);
          } catch (e) {
            setError("Error parsing CSV: " + e.message);
            setTotalRevenue(null);
          }
        }

        if (file.name.endsWith('.csv')) {
          window.Papa.parse(file, {
            header: true,
            skipEmptyLines: true,
            complete: (results) => {
              sumALFromPapa(results);
              sumAQFromPapa(results);
            },
            error: (err) => {
              setError("Error reading CSV: " + err.message);
              setTotalCost(null);
              setTotalRevenue(null);
              setLoading(false);
            }
          });
        } else {
          const reader = new FileReader();
          reader.onload = (evt) => {
            try {
              const data = new Uint8Array(evt.target.result);
              const workbook = window.XLSX.read(data, { type: 'array' });
              const sheet = workbook.Sheets['DSHB'];
              if (!sheet) {
                setError("No 'DSHB' sheet found.");
                setTotalCost(null);
                setTotalRevenue(null);
                setLoading(false);
                return;
              }
              const csv = window.XLSX.utils.sheet_to_csv(sheet);
              window.Papa.parse(csv, {
                header: true,
                skipEmptyLines: true,
                complete: (results) => {
                  sumALFromPapa(results);
                  sumAQFromPapa(results);
                },
                error: (err) => {
                  setError("Error reading Excel: " + err.message);
                  setTotalCost(null);
                  setTotalRevenue(null);
                  setLoading(false);
                }
              });
            } catch (e) {
              setError("Error reading Excel: " + e.message);
              setTotalCost(null);
              setTotalRevenue(null);
              setLoading(false);
            }
          };
          reader.readAsArrayBuffer(file);
        }
      }, [files]);

      return (
        <div className="flex flex-row flex-wrap gap-6 justify-center items-stretch w-full">
          <KpiCardTwoTone
            label="Total Cost"
            icon="fa-coins"
            value={loading ? '...' : (totalCost !== null ? totalCost.toLocaleString() : undefined)}
            target={totalCost !== null ? target.toLocaleString() : ''}
            variance={totalCost !== null ? <span style={{ color: varianceColor, fontWeight: 800 }}>{variance}</span> : ''}
          />
          <KpiCardTwoTone label="Variable CPS" icon="fa-chart-line" />
          <KpiCardTwoTone label="Gross Margin %" icon="fa-percent" />
          <KpiCardTwoTone
            label="Cash Margin"
            icon="fa-money-bill"
            value={loading ? '...' : (cashMargin !== null ? cashMargin.toLocaleString() : undefined)}
            target={cashMargin !== null ? cashMarginTarget.toLocaleString() : ''}
            variance={cashMargin !== null ? <span style={{ color: cashMarginVarianceColor, fontWeight: 800 }}>{cashMarginVariance}</span> : ''}
          />
          {error && <div className="text-red-400 text-sm font-semibold z-10 w-full text-center">{error}</div>}
        </div>
      );
    }
    // ... existing code ...
    // In the Overview tab, replace the static Cost Efficiency cards with <OverviewKpiCards files={files} />
    // ... existing code ...

    // --- Add this new component before the Dashboard function ---
    function PpsTierTable({ files }) {
      const [totals, setTotals] = React.useState([null, null, null, null]);
      const [loading, setLoading] = React.useState(false);
      const [error, setError] = React.useState("");

      React.useEffect(() => {
        if (!files || files.length === 0) {
          setTotals([null, null, null, null]);
          setError("");
          return;
        }
        const file = files[0];
        setLoading(true);
        setError("");

        function sumTiersFromPapa(results) {
          try {
            const tierHeaders = ['PPS Tier 0', 'PPS Tier 1', 'PPS Tier 2', 'PPS Tier 3'];
            let sums = [0, 0, 0, 0];
            for (const row of results.data) {
              for (let i = 0; i < 4; i++) {
                const val = row[tierHeaders[i]];
                if (val !== undefined && val !== null && val !== "" && val !== "-") {
                  const num = Number(val.toString().replace(/,/g, ''));
                  if (!isNaN(num)) sums[i] += num;
                }
              }
            }
            setTotals(sums);
          } catch (e) {
            setError("Error parsing CSV: " + e.message);
            setTotals([null, null, null, null]);
          }
          setLoading(false);
        }

        if (file.name.endsWith('.csv')) {
          window.Papa.parse(file, {
            header: true,
            skipEmptyLines: true,
            complete: sumTiersFromPapa,
            error: (err) => {
              setError("Error reading CSV: " + err.message);
              setTotals([null, null, null, null]);
              setLoading(false);
            }
          });
        } else {
          const reader = new FileReader();
          reader.onload = (evt) => {
            try {
              const data = new Uint8Array(evt.target.result);
              const workbook = window.XLSX.read(data, { type: 'array' });
              const sheet = workbook.Sheets['DSHB'];
              if (!sheet) {
                setError("No 'DSHB' sheet found.");
                setTotals([null, null, null, null]);
                setLoading(false);
                return;
              }
              const csv = window.XLSX.utils.sheet_to_csv(sheet);
              window.Papa.parse(csv, {
                header: true,
                skipEmptyLines: true,
                complete: sumTiersFromPapa,
                error: (err) => {
                  setError("Error reading CSV: " + err.message);
                  setTotals([null, null, null, null]);
                  setLoading(false);
                }
              });
            } catch (e) {
              setError("Error reading file: " + e.message);
              setTotals([null, null, null, null]);
              setLoading(false);
            }
          };
          reader.readAsArrayBuffer(file);
        }
      }, [files]);

      return (
        <div className="overflow-x-auto">
          <table className="min-w-full text-left text-[var(--text)] border-separate border-spacing-y-2">
            <thead>
              <tr>
                <th className="px-4 py-2">PPS Tier 0</th>
                <th className="px-4 py-2">PPS Tier 1</th>
                <th className="px-4 py-2">PPS Tier 2</th>
                <th className="px-4 py-2">PPS Tier 3</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                {totals.map((val, i) => (
                  <td key={i} className="px-4 py-2 text-[var(--secondaryMain)] font-bold text-lg">{loading ? '...' : (val !== null ? val.toLocaleString() : '')}</td>
                ))}
              </tr>
            </tbody>
          </table>
          {error && <div className="text-red-400 text-sm font-semibold mt-2">{error}</div>}
        </div>
      );
    }
    // ... existing code ...
    // --- Add this new component before the Dashboard function ---
    function TplTierTable({ files }) {
      const [totals, setTotals] = React.useState([null, null, null, null]);
      const [loading, setLoading] = React.useState(false);
      const [error, setError] = React.useState("");

      React.useEffect(() => {
        if (!files || files.length === 0) {
          setTotals([null, null, null, null]);
          setError("");
          return;
        }
        const file = files[0];
        setLoading(true);
        setError("");

        function sumTiersFromPapa(results) {
          try {
            // Try to match by header name first
            const tierHeaders = ['3PL Tier 0', '3PL Tier 1', '3PL Tier 2', '3PL Tier 3'];
            let sums = [0, 0, 0, 0];
            for (const row of results.data) {
              for (let i = 0; i < 4; i++) {
                const val = row[tierHeaders[i]];
                if (val !== undefined && val !== null && val !== "" && val !== "-") {
                  const num = Number(val.toString().replace(/,/g, ''));
                  if (!isNaN(num)) sums[i] += num;
                }
              }
            }
            setTotals(sums);
          } catch (e) {
            setError("Error parsing CSV: " + e.message);
            setTotals([null, null, null, null]);
          }
          setLoading(false);
        }

        if (file.name.endsWith('.csv')) {
          window.Papa.parse(file, {
            header: true,
            skipEmptyLines: true,
            complete: sumTiersFromPapa,
            error: (err) => {
              setError("Error reading CSV: " + err.message);
              setTotals([null, null, null, null]);
              setLoading(false);
            }
          });
        } else {
          const reader = new FileReader();
          reader.onload = (evt) => {
            try {
              const data = new Uint8Array(evt.target.result);
              const workbook = window.XLSX.read(data, { type: 'array' });
              const sheet = workbook.Sheets['DSHB'];
              if (!sheet) {
                setError("No 'DSHB' sheet found.");
                setTotals([null, null, null, null]);
                setLoading(false);
                return;
              }
              const csv = window.XLSX.utils.sheet_to_csv(sheet);
              window.Papa.parse(csv, {
                header: true,
                skipEmptyLines: true,
                complete: sumTiersFromPapa,
                error: (err) => {
                  setError("Error reading CSV: " + err.message);
                  setTotals([null, null, null, null]);
                  setLoading(false);
                }
              });
            } catch (e) {
              setError("Error reading file: " + e.message);
              setTotals([null, null, null, null]);
              setLoading(false);
            }
          };
          reader.readAsArrayBuffer(file);
        }
      }, [files]);

      return (
        <div className="overflow-x-auto">
          <table className="min-w-full text-left text-[var(--text)] border-separate border-spacing-y-2">
            <thead>
              <tr>
                <th className="px-4 py-2">3PL Tier 0</th>
                <th className="px-4 py-2">3PL Tier 1</th>
                <th className="px-4 py-2">3PL Tier 2</th>
                <th className="px-4 py-2">3PL Tier 3</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                {totals.map((val, i) => (
                  <td key={i} className="px-4 py-2 text-[var(--secondaryMain)] font-bold text-lg">{loading ? '...' : (val !== null ? val.toLocaleString() : '')}</td>
                ))}
              </tr>
            </tbody>
          </table>
          {error && <div className="text-red-400 text-sm font-semibold mt-2">{error}</div>}
        </div>
      );
    }
    // ... existing code ...
    // --- Add this new component before the Dashboard function ---
    function MvTierTable({ files }) {
      const [totals, setTotals] = React.useState([null, null]);
      const [loading, setLoading] = React.useState(false);
      const [error, setError] = React.useState("");

      React.useEffect(() => {
        if (!files || files.length === 0) {
          setTotals([null, null]);
          setError("");
          return;
        }
        const file = files[0];
        setLoading(true);
        setError("");

        function sumTiersFromPapa(results) {
          try {
            // Try to match by header name first
            const tierHeaders = ['M&V Tier 0', 'M&V Tier 1'];
            let sums = [0, 0];
            for (const row of results.data) {
              for (let i = 0; i < 2; i++) {
                const val = row[tierHeaders[i]];
                if (val !== undefined && val !== null && val !== "" && val !== "-") {
                  const num = Number(val.toString().replace(/,/g, ''));
                  if (!isNaN(num)) sums[i] += num;
                }
              }
            }
            setTotals(sums);
          } catch (e) {
            setError("Error parsing CSV: " + e.message);
            setTotals([null, null]);
          }
          setLoading(false);
        }

        if (file.name.endsWith('.csv')) {
          window.Papa.parse(file, {
            header: true,
            skipEmptyLines: true,
            complete: sumTiersFromPapa,
            error: (err) => {
              setError("Error reading CSV: " + err.message);
              setTotals([null, null]);
              setLoading(false);
            }
          });
        } else {
          const reader = new FileReader();
          reader.onload = (evt) => {
            try {
              const data = new Uint8Array(evt.target.result);
              const workbook = window.XLSX.read(data, { type: 'array' });
              const sheet = workbook.Sheets['DSHB'];
              if (!sheet) {
                setError("No 'DSHB' sheet found.");
                setTotals([null, null]);
                setLoading(false);
                return;
              }
              const csv = window.XLSX.utils.sheet_to_csv(sheet);
              window.Papa.parse(csv, {
                header: true,
                skipEmptyLines: true,
                complete: sumTiersFromPapa,
                error: (err) => {
                  setError("Error reading CSV: " + err.message);
                  setTotals([null, null]);
                  setLoading(false);
                }
              });
            } catch (e) {
              setError("Error reading file: " + e.message);
              setTotals([null, null]);
              setLoading(false);
            }
          };
          reader.readAsArrayBuffer(file);
        }
      }, [files]);

      return (
        <div className="overflow-x-auto">
          <table className="min-w-full text-left text-[var(--text)] border-separate border-spacing-y-2">
            <thead>
              <tr>
                <th className="px-4 py-2">M&V Tier 0</th>
                <th className="px-4 py-2">M&V Tier 1</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                {totals.map((val, i) => (
                  <td key={i} className="px-4 py-2 text-[var(--secondaryMain)] font-bold text-lg">{loading ? '...' : (val !== null ? val.toLocaleString() : '')}</td>
                ))}
              </tr>
            </tbody>
          </table>
          {error && <div className="text-red-400 text-sm font-semibold mt-2">{error}</div>}
        </div>
      );
    }
    // ... existing code ...
    // --- Add this new component before the Dashboard function ---
    function HbTierTable({ files }) {
      const [totals, setTotals] = React.useState([null, null]);
      const [loading, setLoading] = React.useState(false);
      const [error, setError] = React.useState("");

      React.useEffect(() => {
        if (!files || files.length === 0) {
          setTotals([null, null]);
          setError("");
          return;
        }
        const file = files[0];
        setLoading(true);
        setError("");

        function sumTiersFromPapa(results) {
          try {
            // Try to match by header name first
            const tierHeaders = ['H&B Tier 0', 'H&B Tier 1'];
            let sums = [0, 0];
            for (const row of results.data) {
              for (let i = 0; i < 2; i++) {
                const val = row[tierHeaders[i]];
                if (val !== undefined && val !== null && val !== "" && val !== "-") {
                  const num = Number(val.toString().replace(/,/g, ''));
                  if (!isNaN(num)) sums[i] += num;
                }
              }
            }
            setTotals(sums);
          } catch (e) {
            setError("Error parsing CSV: " + e.message);
            setTotals([null, null]);
          }
          setLoading(false);
        }

        if (file.name.endsWith('.csv')) {
          window.Papa.parse(file, {
            header: true,
            skipEmptyLines: true,
            complete: sumTiersFromPapa,
            error: (err) => {
              setError("Error reading CSV: " + err.message);
              setTotals([null, null]);
              setLoading(false);
            }
          });
        } else {
          const reader = new FileReader();
          reader.onload = (evt) => {
            try {
              const data = new Uint8Array(evt.target.result);
              const workbook = window.XLSX.read(data, { type: 'array' });
              const sheet = workbook.Sheets['DSHB'];
              if (!sheet) {
                setError("No 'DSHB' sheet found.");
                setTotals([null, null]);
                setLoading(false);
                return;
              }
              const csv = window.XLSX.utils.sheet_to_csv(sheet);
              window.Papa.parse(csv, {
                header: true,
                skipEmptyLines: true,
                complete: sumTiersFromPapa,
                error: (err) => {
                  setError("Error reading CSV: " + err.message);
                  setTotals([null, null]);
                  setLoading(false);
                }
              });
            } catch (e) {
              setError("Error reading file: " + e.message);
              setTotals([null, null]);
              setLoading(false);
            }
          };
          reader.readAsArrayBuffer(file);
        }
      }, [files]);

      return (
        <div className="overflow-x-auto">
          <table className="min-w-full text-left text-[var(--text)] border-separate border-spacing-y-2">
            <thead>
              <tr>
                <th className="px-4 py-2">H&B Tier 0</th>
                <th className="px-4 py-2">H&B Tier 1</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                {totals.map((val, i) => (
                  <td key={i} className="px-4 py-2 text-[var(--secondaryMain)] font-bold text-lg">{loading ? '...' : (val !== null ? val.toLocaleString() : '')}</td>
                ))}
              </tr>
            </tbody>
          </table>
          {error && <div className="text-red-400 text-sm font-semibold mt-2">{error}</div>}
        </div>
      );
    }
    // ... existing code ...
    // In the H&B tab, replace the static metric cards with <HbKpiCards files={files} />
    // ... existing code ...

    // ... existing code ...
    // Place this before the Dashboard function and before any usage
    function KpiCardTwoTone({ label, icon, value, target, variance }) {
      // Only show target/variance if they are not undefined/null/empty string
      const showTarget = target !== undefined && target !== null && target !== '';
      const showVariance = variance !== undefined && variance !== null && variance !== '';
      return (
        <div
          className="flex flex-col rounded-[2.5rem] overflow-hidden shadow-lg border-2 border-[#ff9d18]"
          style={{ width: '340px', minWidth: '260px', maxWidth: '340px', height: '100%' }}
        >          {/* Top section */}
          <div className="relative bg-[var(--white)] flex flex-col items-center justify-center flex-grow p-8" style={{ borderTopLeftRadius: '2.5rem', borderTopRightRadius: '2.5rem' }}>
            <div className="text-2xl font-extrabold subtitle-custom mb-2 text-[var(--secondaryMain)]" style={{ fontFamily: 'Euclid Circular B', position: 'relative', zIndex: 1 }}>{label}</div>
            {value !== undefined ? (
              <span className="text-5xl font-extrabold text-[var(--secondaryMain)] mb-2" style={{ position: 'relative', zIndex: 1 }}>{value}</span>
            ) : null}
            <i className={`fa-solid ${icon} absolute opacity-10 text-[8rem] left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 pointer-events-none`} style={{ zIndex: 0 }} />
          </div>
          {/* Bottom section */}
          <div className="flex flex-row bg-[var(--secondaryMain)] text-[var(--primarySurface)] border-2 border-[var(--secondaryMain)] rounded-b-[2.5rem]">
            <div className="flex-1 flex flex-col items-center justify-center py-1 border-r border-[var(--primarySurface)]">
              <div className="font-semibold mb-0" style={{ color: '#184c36', fontSize: '0.85rem' }}>Target</div>
              <div className="font-extrabold text-white" style={{ fontSize: '1.8rem', lineHeight: '1.1' }}>{showTarget ? target : ''}</div>
            </div>
            <div className="flex-1 flex flex-col items-center justify-center py-1">
              <div className="font-semibold mb-0" style={{ color: '#184c36', fontSize: '0.85rem' }}>Variance %</div>
              <div className="font-extrabold text-white" style={{ fontSize: '1.8rem', lineHeight: '1.1' }}>{showVariance ? variance : ''}</div>
            </div>
          </div>
        </div>
      );
    }

    // Single-tone KPI Card component - same dimensions as KpiCardTwoTone but without target/variance section
    function KpiCardSingleTone({ label, icon, value }) {
      return (
        <div
          className="flex flex-col rounded-[2.5rem] overflow-hidden shadow-lg border-2 border-[#ff9d18]"
          style={{ width: '340px', minWidth: '260px', maxWidth: '340px', height: '100%' }}
        >
          {/* Single section taking full height */}
          <div className="relative bg-[var(--white)] flex flex-col items-center justify-center flex-grow p-8" style={{ borderRadius: '2.5rem' }}>
            <div className="text-2xl font-extrabold subtitle-custom mb-4 text-[var(--secondaryMain)]" style={{ fontFamily: 'Euclid Circular B', position: 'relative', zIndex: 1 }}>{label}</div>
            {value !== undefined ? (
              <span className="text-6xl font-extrabold text-[var(--secondaryMain)]" style={{ position: 'relative', zIndex: 1 }}>{value}</span>
            ) : null}
            <i className={`fa-solid ${icon} absolute opacity-10 text-[8rem] left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 pointer-events-none`} style={{ zIndex: 0 }} />
          </div>
        </div>
      );
    }
    // ... existing code ...
